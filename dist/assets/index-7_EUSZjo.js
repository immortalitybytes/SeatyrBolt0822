var e=Object.defineProperty,t=(t,s,r)=>((t,s,r)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[s]=r)(t,"symbol"!=typeof s?s+"":s,r);import{r as s,a as r,g as n,c as a,u as i,N as o,R as l,b as c,B as d,d as u,e as h}from"./vendor-DUTkdBDW.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var m={exports:{}},p={},g=s,f=Symbol.for("react.element"),x=Symbol.for("react.fragment"),y=Object.prototype.hasOwnProperty,b=g.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,v={key:!0,ref:!0,__self:!0,__source:!0};function w(e,t,s){var r,n={},a=null,i=null;for(r in void 0!==s&&(a=""+s),void 0!==t.key&&(a=""+t.key),void 0!==t.ref&&(i=t.ref),t)y.call(t,r)&&!v.hasOwnProperty(r)&&(n[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===n[r]&&(n[r]=t[r]);return{$$typeof:f,type:e,key:a,ref:i,props:n,_owner:b.current}}p.Fragment=x,p.jsx=w,p.jsxs=w,m.exports=p;var j=m.exports,_={},N=r;_.createRoot=N.createRoot,_.hydrateRoot=N.hydrateRoot;
/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */
var S={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};
/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const k=(e,t)=>{const r=s.forwardRef(({color:r="currentColor",size:n=24,strokeWidth:a=2,absoluteStrokeWidth:i,className:o="",children:l,...c},d)=>{return s.createElement("svg",{ref:d,...S,width:n,height:n,stroke:r,strokeWidth:i?24*Number(a)/Number(n):a,className:["lucide",`lucide-${u=e,u.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim()}`,o].join(" "),...c},[...t.map(([e,t])=>s.createElement(e,t)),...Array.isArray(l)?l:[l]]);var u});return r.displayName=`${e}`,r},E=k("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),T=k("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),C=k("Armchair",[["path",{d:"M19 9V6a2 2 0 0 0-2-2H7a2 2 0 0 0-2 2v3",key:"irtipd"}],["path",{d:"M3 16a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-5a2 2 0 0 0-4 0v2H7v-2a2 2 0 0 0-4 0Z",key:"1e01m0"}],["path",{d:"M5 18v2",key:"ppbyun"}],["path",{d:"M19 18v2",key:"gy7782"}]]),P=k("ArrowDownAZ",[["path",{d:"m3 16 4 4 4-4",key:"1co6wj"}],["path",{d:"M7 20V4",key:"1yoxec"}],["path",{d:"M20 8h-5",key:"1vsyxs"}],["path",{d:"M15 10V6.5a2.5 2.5 0 0 1 5 0V10",key:"ag13bf"}],["path",{d:"M15 14h5l-5 6h5",key:"ur5jdg"}]]),A=k("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]),I=k("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]),D=k("ArrowUpRight",[["path",{d:"M7 7h10v10",key:"1tivn9"}],["path",{d:"M7 17 17 7",key:"1vkiza"}]]),O=k("BarChart3",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]),$=k("CheckSquare",[["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}],["path",{d:"M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11",key:"1jnkn4"}]]),R=k("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]),U=k("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]),L=k("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]),M=k("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]),F=k("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]),B=k("CircleUser",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}],["path",{d:"M7 20.662V19a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v1.662",key:"154egf"}]]),q=k("ClipboardCopy",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M8 4H6a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-2",key:"4jdomd"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v4",key:"3hqy98"}],["path",{d:"M21 14H11",key:"1bme5i"}],["path",{d:"m15 10-4 4 4 4",key:"5dvupr"}]]),z=k("ClipboardList",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]]),G=k("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]),W=k("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]),K=k("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]),V=k("Crown",[["path",{d:"m2 4 3 12h14l3-12-6 7-4-7-4 7-6-7zm3 16h14",key:"zkxr6b"}]]),H=k("EyeOff",[["path",{d:"M9.88 9.88a3 3 0 1 0 4.24 4.24",key:"1jxqfv"}],["path",{d:"M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68",key:"9wicm4"}],["path",{d:"M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61",key:"1jreej"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]),Y=k("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),J=k("FolderOpen",[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]]),X=k("Github",[["path",{d:"M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4",key:"tonef"}],["path",{d:"M9 18c-4.51 2-5-2-7-2",key:"9comsn"}]]),Z=k("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]),Q=k("Key",[["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["path",{d:"m15.5 7.5 3 3L22 7l-3-3",key:"1rn1fs"}]]),ee=k("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]),te=k("Pen",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}]]),se=k("Play",[["polygon",{points:"5 3 19 12 5 21 5 3",key:"191637"}]]),re=k("PlusCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]]),ne=k("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),ae=k("Receipt",[["path",{d:"M4 2v20l2-1 2 1 2-1 2 1 2-1 2 1 2-1 2 1V2l-2 1-2-1-2 1-2-1-2 1-2-1-2 1Z",key:"q3az6g"}],["path",{d:"M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8",key:"1h4pet"}],["path",{d:"M12 17.5v-11",key:"1jc1ny"}]]),ie=k("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),oe=k("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]),le=k("Scale",[["path",{d:"m16 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z",key:"7g6ntu"}],["path",{d:"m2 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z",key:"ijws7r"}],["path",{d:"M7 21h10",key:"1b0cd5"}],["path",{d:"M12 3v18",key:"108xh3"}],["path",{d:"M3 7h2c2 0 5-1 7-2 2 1 5 2 7 2h2",key:"3gwbw2"}]]),ce=k("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]),de=k("Table",[["path",{d:"M12 3v18",key:"108xh3"}],["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}]]),ue=k("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),he=k("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]),me=k("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]),pe=k("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]),ge=k("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),fe={},xe=function(e,t,s){let r=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const e=document.querySelector("meta[property=csp-nonce]"),s=(null==e?void 0:e.nonce)||(null==e?void 0:e.getAttribute("nonce"));r=Promise.allSettled(t.map(e=>{if((e=function(e){return"/"+e}(e))in fe)return;fe[e]=!0;const t=e.endsWith(".css"),r=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${r}`))return;const n=document.createElement("link");return n.rel=t?"stylesheet":"modulepreload",t||(n.as="script"),n.crossOrigin="",n.href=e,s&&n.setAttribute("nonce",s),document.head.appendChild(n),t?new Promise((t,s)=>{n.addEventListener("load",t),n.addEventListener("error",()=>s(new Error(`Unable to preload CSS for ${e}`)))}):void 0}))}function n(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return r.then(t=>{for(const e of t||[])"rejected"===e.status&&n(e.reason);return e().catch(n)})};class ye extends Error{constructor(e,t="FunctionsError",s){super(e),this.name=t,this.context=s}}class be extends ye{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class ve extends ye{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class we extends ye{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var je,_e;(_e=je||(je={})).Any="any",_e.ApNortheast1="ap-northeast-1",_e.ApNortheast2="ap-northeast-2",_e.ApSouth1="ap-south-1",_e.ApSoutheast1="ap-southeast-1",_e.ApSoutheast2="ap-southeast-2",_e.CaCentral1="ca-central-1",_e.EuCentral1="eu-central-1",_e.EuWest1="eu-west-1",_e.EuWest2="eu-west-2",_e.EuWest3="eu-west-3",_e.SaEast1="sa-east-1",_e.UsEast1="us-east-1",_e.UsWest1="us-west-1",_e.UsWest2="us-west-2";var Ne=function(e,t,s,r){return new(s||(s=Promise))(function(n,a){function i(e){try{l(r.next(e))}catch(t){a(t)}}function o(e){try{l(r.throw(e))}catch(t){a(t)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s(function(e){e(t)})).then(i,o)}l((r=r.apply(e,t||[])).next())})};class Se{constructor(e,{headers:t={},customFetch:s,region:r=je.Any}={}){this.url=e,this.headers=t,this.region=r,this.fetch=(e=>{let t;return t=e||("undefined"==typeof fetch?(...e)=>xe(async()=>{const{default:e}=await Promise.resolve().then(()=>Le);return{default:e}},void 0).then(({default:t})=>t(...e)):fetch),(...e)=>t(...e)})(s)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var s;return Ne(this,void 0,void 0,function*(){try{const{headers:r,method:n,body:a}=t;let i={},{region:o}=t;o||(o=this.region);const l=new URL(`${this.url}/${e}`);let c;o&&"any"!==o&&(i["x-region"]=o,l.searchParams.set("forceFunctionRegion",o)),a&&(r&&!Object.prototype.hasOwnProperty.call(r,"Content-Type")||!r)&&("undefined"!=typeof Blob&&a instanceof Blob||a instanceof ArrayBuffer?(i["Content-Type"]="application/octet-stream",c=a):"string"==typeof a?(i["Content-Type"]="text/plain",c=a):"undefined"!=typeof FormData&&a instanceof FormData?c=a:(i["Content-Type"]="application/json",c=JSON.stringify(a)));const d=yield this.fetch(l.toString(),{method:n||"POST",headers:Object.assign(Object.assign(Object.assign({},i),this.headers),r),body:c}).catch(e=>{throw new be(e)}),u=d.headers.get("x-relay-error");if(u&&"true"===u)throw new ve(d);if(!d.ok)throw new we(d);let h,m=(null!==(s=d.headers.get("Content-Type"))&&void 0!==s?s:"text/plain").split(";")[0].trim();return h="application/json"===m?yield d.json():"application/octet-stream"===m?yield d.blob():"text/event-stream"===m?d:"multipart/form-data"===m?yield d.formData():yield d.text(),{data:h,error:null,response:d}}catch(r){return{data:null,error:r,response:r instanceof we||r instanceof ve?r.context:void 0}}})}}var ke={},Ee={},Te={},Ce={},Pe={},Ae={},Ie=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw new Error("unable to locate global object")}();const De=Ie.fetch,Oe=Ie.fetch.bind(Ie),$e=Ie.Headers,Re=Ie.Request,Ue=Ie.Response,Le=Object.freeze(Object.defineProperty({__proto__:null,Headers:$e,Request:Re,Response:Ue,default:Oe,fetch:De},Symbol.toStringTag,{value:"Module"})),Me=n(Le);var Fe={};Object.defineProperty(Fe,"__esModule",{value:!0});let Be=class extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}};Fe.default=Be;var qe=a&&a.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Ae,"__esModule",{value:!0});const ze=qe(Me),Ge=qe(Fe);Ae.default=class{constructor(e){var t,s;this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=new Headers(e.headers),this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=null!==(t=e.shouldThrowOnError)&&void 0!==t&&t,this.signal=e.signal,this.isMaybeSingle=null!==(s=e.isMaybeSingle)&&void 0!==s&&s,e.fetch?this.fetch=e.fetch:"undefined"==typeof fetch?this.fetch=ze.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,t){return this.headers=new Headers(this.headers),this.headers.set(e,t),this}then(e,t){void 0===this.schema||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),"GET"!==this.method&&"HEAD"!==this.method&&this.headers.set("Content-Type","application/json");let s=(0,this.fetch)(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async e=>{var t,s,r,n;let a=null,i=null,o=null,l=e.status,c=e.statusText;if(e.ok){if("HEAD"!==this.method){const s=await e.text();""===s||(i="text/csv"===this.headers.get("Accept")||this.headers.get("Accept")&&(null===(t=this.headers.get("Accept"))||void 0===t?void 0:t.includes("application/vnd.pgrst.plan+text"))?s:JSON.parse(s))}const n=null===(s=this.headers.get("Prefer"))||void 0===s?void 0:s.match(/count=(exact|planned|estimated)/),d=null===(r=e.headers.get("content-range"))||void 0===r?void 0:r.split("/");n&&d&&d.length>1&&(o=parseInt(d[1])),this.isMaybeSingle&&"GET"===this.method&&Array.isArray(i)&&(i.length>1?(a={code:"PGRST116",details:`Results contain ${i.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},i=null,o=null,l=406,c="Not Acceptable"):i=1===i.length?i[0]:null)}else{const t=await e.text();try{a=JSON.parse(t),Array.isArray(a)&&404===e.status&&(i=[],a=null,l=200,c="OK")}catch(d){404===e.status&&""===t?(l=204,c="No Content"):a={message:t}}if(a&&this.isMaybeSingle&&(null===(n=null==a?void 0:a.details)||void 0===n?void 0:n.includes("0 rows"))&&(a=null,l=200,c="OK"),a&&this.shouldThrowOnError)throw new Ge.default(a)}return{error:a,data:i,count:o,status:l,statusText:c}});return this.shouldThrowOnError||(s=s.catch(e=>{var t,s,r;return{error:{message:`${null!==(t=null==e?void 0:e.name)&&void 0!==t?t:"FetchError"}: ${null==e?void 0:e.message}`,details:`${null!==(s=null==e?void 0:e.stack)&&void 0!==s?s:""}`,hint:"",code:`${null!==(r=null==e?void 0:e.code)&&void 0!==r?r:""}`},data:null,count:null,status:0,statusText:""}})),s.then(e,t)}returns(){return this}overrideTypes(){return this}};var We=a&&a.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Pe,"__esModule",{value:!0});const Ke=We(Ae);let Ve=class extends Ke.default{select(e){let t=!1;const s=(null!=e?e:"*").split("").map(e=>/\s/.test(e)&&!t?"":('"'===e&&(t=!t),e)).join("");return this.url.searchParams.set("select",s),this.headers.append("Prefer","return=representation"),this}order(e,{ascending:t=!0,nullsFirst:s,foreignTable:r,referencedTable:n=r}={}){const a=n?`${n}.order`:"order",i=this.url.searchParams.get(a);return this.url.searchParams.set(a,`${i?`${i},`:""}${e}.${t?"asc":"desc"}${void 0===s?"":s?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t,referencedTable:s=t}={}){const r=void 0===s?"limit":`${s}.limit`;return this.url.searchParams.set(r,`${e}`),this}range(e,t,{foreignTable:s,referencedTable:r=s}={}){const n=void 0===r?"offset":`${r}.offset`,a=void 0===r?"limit":`${r}.limit`;return this.url.searchParams.set(n,`${e}`),this.url.searchParams.set(a,""+(t-e+1)),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return"GET"===this.method?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:e=!1,verbose:t=!1,settings:s=!1,buffers:r=!1,wal:n=!1,format:a="text"}={}){var i;const o=[e?"analyze":null,t?"verbose":null,s?"settings":null,r?"buffers":null,n?"wal":null].filter(Boolean).join("|"),l=null!==(i=this.headers.get("Accept"))&&void 0!==i?i:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${a}; for="${l}"; options=${o};`),this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(e){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${e}`),this}};Pe.default=Ve;var He=a&&a.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Ce,"__esModule",{value:!0});const Ye=He(Pe);let Je=class extends Ye.default{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}in(e,t){const s=Array.from(new Set(t)).map(e=>"string"==typeof e&&new RegExp("[,()]").test(e)?`"${e}"`:`${e}`).join(",");return this.url.searchParams.append(e,`in.(${s})`),this}contains(e,t){return"string"==typeof t?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return"string"==typeof t?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return"string"==typeof t?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:s,type:r}={}){let n="";"plain"===r?n="pl":"phrase"===r?n="ph":"websearch"===r&&(n="w");const a=void 0===s?"":`(${s})`;return this.url.searchParams.append(e,`${n}fts${a}.${t}`),this}match(e){return Object.entries(e).forEach(([e,t])=>{this.url.searchParams.append(e,`eq.${t}`)}),this}not(e,t,s){return this.url.searchParams.append(e,`not.${t}.${s}`),this}or(e,{foreignTable:t,referencedTable:s=t}={}){const r=s?`${s}.or`:"or";return this.url.searchParams.append(r,`(${e})`),this}filter(e,t,s){return this.url.searchParams.append(e,`${t}.${s}`),this}};Ce.default=Je;var Xe=a&&a.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Te,"__esModule",{value:!0});const Ze=Xe(Ce);Te.default=class{constructor(e,{headers:t={},schema:s,fetch:r}){this.url=e,this.headers=new Headers(t),this.schema=s,this.fetch=r}select(e,{head:t=!1,count:s}={}){const r=t?"HEAD":"GET";let n=!1;const a=(null!=e?e:"*").split("").map(e=>/\s/.test(e)&&!n?"":('"'===e&&(n=!n),e)).join("");return this.url.searchParams.set("select",a),s&&this.headers.append("Prefer",`count=${s}`),new Ze.default({method:r,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(e,{count:t,defaultToNull:s=!0}={}){var r;if(t&&this.headers.append("Prefer",`count=${t}`),s||this.headers.append("Prefer","missing=default"),Array.isArray(e)){const t=e.reduce((e,t)=>e.concat(Object.keys(t)),[]);if(t.length>0){const e=[...new Set(t)].map(e=>`"${e}"`);this.url.searchParams.set("columns",e.join(","))}}return new Ze.default({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:null!==(r=this.fetch)&&void 0!==r?r:fetch})}upsert(e,{onConflict:t,ignoreDuplicates:s=!1,count:r,defaultToNull:n=!0}={}){var a;if(this.headers.append("Prefer",`resolution=${s?"ignore":"merge"}-duplicates`),void 0!==t&&this.url.searchParams.set("on_conflict",t),r&&this.headers.append("Prefer",`count=${r}`),n||this.headers.append("Prefer","missing=default"),Array.isArray(e)){const t=e.reduce((e,t)=>e.concat(Object.keys(t)),[]);if(t.length>0){const e=[...new Set(t)].map(e=>`"${e}"`);this.url.searchParams.set("columns",e.join(","))}}return new Ze.default({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:null!==(a=this.fetch)&&void 0!==a?a:fetch})}update(e,{count:t}={}){var s;return t&&this.headers.append("Prefer",`count=${t}`),new Ze.default({method:"PATCH",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:null!==(s=this.fetch)&&void 0!==s?s:fetch})}delete({count:e}={}){var t;return e&&this.headers.append("Prefer",`count=${e}`),new Ze.default({method:"DELETE",url:this.url,headers:this.headers,schema:this.schema,fetch:null!==(t=this.fetch)&&void 0!==t?t:fetch})}};var Qe=a&&a.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Ee,"__esModule",{value:!0});const et=Qe(Te),tt=Qe(Ce);Ee.default=class e{constructor(e,{headers:t={},schema:s,fetch:r}={}){this.url=e,this.headers=new Headers(t),this.schemaName=s,this.fetch=r}from(e){const t=new URL(`${this.url}/${e}`);return new et.default(t,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(t){return new e(this.url,{headers:this.headers,schema:t,fetch:this.fetch})}rpc(e,t={},{head:s=!1,get:r=!1,count:n}={}){var a;let i;const o=new URL(`${this.url}/rpc/${e}`);let l;s||r?(i=s?"HEAD":"GET",Object.entries(t).filter(([e,t])=>void 0!==t).map(([e,t])=>[e,Array.isArray(t)?`{${t.join(",")}}`:`${t}`]).forEach(([e,t])=>{o.searchParams.append(e,t)})):(i="POST",l=t);const c=new Headers(this.headers);return n&&c.set("Prefer",`count=${n}`),new tt.default({method:i,url:o,headers:c,schema:this.schemaName,body:l,fetch:null!==(a=this.fetch)&&void 0!==a?a:fetch})}};var st=a&&a.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(ke,"__esModule",{value:!0}),ke.PostgrestError=ke.PostgrestBuilder=ke.PostgrestTransformBuilder=ke.PostgrestFilterBuilder=ke.PostgrestQueryBuilder=ke.PostgrestClient=void 0;const rt=st(Ee);ke.PostgrestClient=rt.default;const nt=st(Te);ke.PostgrestQueryBuilder=nt.default;const at=st(Ce);ke.PostgrestFilterBuilder=at.default;const it=st(Pe);ke.PostgrestTransformBuilder=it.default;const ot=st(Ae);ke.PostgrestBuilder=ot.default;const lt=st(Fe);ke.PostgrestError=lt.default;var ct=ke.default={PostgrestClient:rt.default,PostgrestQueryBuilder:nt.default,PostgrestFilterBuilder:at.default,PostgrestTransformBuilder:it.default,PostgrestBuilder:ot.default,PostgrestError:lt.default};const{PostgrestClient:dt,PostgrestQueryBuilder:ut,PostgrestFilterBuilder:ht,PostgrestTransformBuilder:mt,PostgrestBuilder:pt,PostgrestError:gt}=ct;class ft{static detectEnvironment(){var e;if("undefined"!=typeof WebSocket)return{type:"native",constructor:WebSocket};if("undefined"!=typeof globalThis&&void 0!==globalThis.WebSocket)return{type:"native",constructor:globalThis.WebSocket};if("undefined"!=typeof global&&void 0!==global.WebSocket)return{type:"native",constructor:global.WebSocket};if("undefined"!=typeof globalThis&&void 0!==globalThis.WebSocketPair&&void 0===globalThis.WebSocket)return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if("undefined"!=typeof globalThis&&globalThis.EdgeRuntime||"undefined"!=typeof navigator&&(null===(e=navigator.userAgent)||void 0===e?void 0:e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if("undefined"!=typeof process&&process.versions&&process.versions.node){const e=parseInt(process.versions.node.split(".")[0]);return e>=22?void 0!==globalThis.WebSocket?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${e} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${e} detected without native WebSocket support.`,workaround:'For Node.js < 22, install "ws" package and provide it via the transport option:\nimport ws from "ws"\nnew RealtimeClient(url, { transport: ws })'}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let t=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(t+=`\n\nSuggested solution: ${e.workaround}`),new Error(t)}static createWebSocket(e,t){return new(this.getWebSocketConstructor())(e,t)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return"native"===e.type||"ws"===e.type}catch(e){return!1}}}const xt=1e4;var yt,bt,vt,wt,jt,_t,Nt,St,kt,Et,Tt;(bt=yt||(yt={}))[bt.connecting=0]="connecting",bt[bt.open=1]="open",bt[bt.closing=2]="closing",bt[bt.closed=3]="closed",(wt=vt||(vt={})).closed="closed",wt.errored="errored",wt.joined="joined",wt.joining="joining",wt.leaving="leaving",(_t=jt||(jt={})).close="phx_close",_t.error="phx_error",_t.join="phx_join",_t.reply="phx_reply",_t.leave="phx_leave",_t.access_token="access_token",(Nt||(Nt={})).websocket="websocket",(kt=St||(St={})).Connecting="connecting",kt.Open="open",kt.Closing="closing",kt.Closed="closed";class Ct{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t("string"==typeof e?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),s=new TextDecoder;return this._decodeBroadcast(e,t,s)}_decodeBroadcast(e,t,s){const r=t.getUint8(1),n=t.getUint8(2);let a=this.HEADER_LENGTH+2;const i=s.decode(e.slice(a,a+r));a+=r;const o=s.decode(e.slice(a,a+n));a+=n;return{ref:null,topic:i,event:o,payload:JSON.parse(s.decode(e.slice(a,e.byteLength)))}}}class Pt{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}(Tt=Et||(Et={})).abstime="abstime",Tt.bool="bool",Tt.date="date",Tt.daterange="daterange",Tt.float4="float4",Tt.float8="float8",Tt.int2="int2",Tt.int4="int4",Tt.int4range="int4range",Tt.int8="int8",Tt.int8range="int8range",Tt.json="json",Tt.jsonb="jsonb",Tt.money="money",Tt.numeric="numeric",Tt.oid="oid",Tt.reltime="reltime",Tt.text="text",Tt.time="time",Tt.timestamp="timestamp",Tt.timestamptz="timestamptz",Tt.timetz="timetz",Tt.tsrange="tsrange",Tt.tstzrange="tstzrange";const At=(e,t,s={})=>{var r;const n=null!==(r=s.skipTypes)&&void 0!==r?r:[];return Object.keys(t).reduce((s,r)=>(s[r]=It(r,e,t,n),s),{})},It=(e,t,s,r)=>{const n=t.find(t=>t.name===e),a=null==n?void 0:n.type,i=s[e];return a&&!r.includes(a)?Dt(a,i):Ot(i)},Dt=(e,t)=>{if("_"===e.charAt(0)){const s=e.slice(1,e.length);return Lt(t,s)}switch(e){case Et.bool:return $t(t);case Et.float4:case Et.float8:case Et.int2:case Et.int4:case Et.int8:case Et.numeric:case Et.oid:return Rt(t);case Et.json:case Et.jsonb:return Ut(t);case Et.timestamp:return Mt(t);case Et.abstime:case Et.date:case Et.daterange:case Et.int4range:case Et.int8range:case Et.money:case Et.reltime:case Et.text:case Et.time:case Et.timestamptz:case Et.timetz:case Et.tsrange:case Et.tstzrange:default:return Ot(t)}},Ot=e=>e,$t=e=>{switch(e){case"t":return!0;case"f":return!1;default:return e}},Rt=e=>{if("string"==typeof e){const t=parseFloat(e);if(!Number.isNaN(t))return t}return e},Ut=e=>{if("string"==typeof e)try{return JSON.parse(e)}catch(t){return console.log(`JSON parse error: ${t}`),e}return e},Lt=(e,t)=>{if("string"!=typeof e)return e;const s=e.length-1,r=e[s];if("{"===e[0]&&"}"===r){let r;const a=e.slice(1,s);try{r=JSON.parse("["+a+"]")}catch(n){r=a?a.split(","):[]}return r.map(e=>Dt(t,e))}return e},Mt=e=>"string"==typeof e?e.replace(" ","T"):e,Ft=e=>{let t=e;return t=t.replace(/^ws/i,"http"),t=t.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),t.replace(/\/+$/,"")+"/api/broadcast"};class Bt{constructor(e,t,s={},r=1e4){this.channel=e,this.event=t,this.payload=s,this.timeout=r,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var s;return this._hasReceived(e)&&t(null===(s=this.receivedResp)||void 0===s?void 0:s.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);this.channel._on(this.refEvent,{},e=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=e,this._matchReceive(e)}),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(t=>t.status===e).forEach(e=>e.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var qt,zt,Gt,Wt,Kt,Vt,Ht,Yt;(zt=qt||(qt={})).SYNC="sync",zt.JOIN="join",zt.LEAVE="leave";class Jt{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const s=(null==t?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(s.state,{},e=>{const{onJoin:t,onLeave:s,onSync:r}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Jt.syncState(this.state,e,t,s),this.pendingDiffs.forEach(e=>{this.state=Jt.syncDiff(this.state,e,t,s)}),this.pendingDiffs=[],r()}),this.channel._on(s.diff,{},e=>{const{onJoin:t,onLeave:s,onSync:r}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(e):(this.state=Jt.syncDiff(this.state,e,t,s),r())}),this.onJoin((e,t,s)=>{this.channel._trigger("presence",{event:"join",key:e,currentPresences:t,newPresences:s})}),this.onLeave((e,t,s)=>{this.channel._trigger("presence",{event:"leave",key:e,currentPresences:t,leftPresences:s})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,s,r){const n=this.cloneDeep(e),a=this.transformState(t),i={},o={};return this.map(n,(e,t)=>{a[e]||(o[e]=t)}),this.map(a,(e,t)=>{const s=n[e];if(s){const r=t.map(e=>e.presence_ref),n=s.map(e=>e.presence_ref),a=t.filter(e=>n.indexOf(e.presence_ref)<0),l=s.filter(e=>r.indexOf(e.presence_ref)<0);a.length>0&&(i[e]=a),l.length>0&&(o[e]=l)}else i[e]=t}),this.syncDiff(n,{joins:i,leaves:o},s,r)}static syncDiff(e,t,s,r){const{joins:n,leaves:a}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return s||(s=()=>{}),r||(r=()=>{}),this.map(n,(t,r)=>{var n;const a=null!==(n=e[t])&&void 0!==n?n:[];if(e[t]=this.cloneDeep(r),a.length>0){const s=e[t].map(e=>e.presence_ref),r=a.filter(e=>s.indexOf(e.presence_ref)<0);e[t].unshift(...r)}s(t,a,r)}),this.map(a,(t,s)=>{let n=e[t];if(!n)return;const a=s.map(e=>e.presence_ref);n=n.filter(e=>a.indexOf(e.presence_ref)<0),e[t]=n,r(t,n,s),0===n.length&&delete e[t]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(s=>t(s,e[s]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,s)=>{const r=e[s];return t[s]="metas"in r?r.metas.map(e=>(e.presence_ref=e.phx_ref,delete e.phx_ref,delete e.phx_ref_prev,e)):r,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}(Wt=Gt||(Gt={})).ALL="*",Wt.INSERT="INSERT",Wt.UPDATE="UPDATE",Wt.DELETE="DELETE",(Vt=Kt||(Kt={})).BROADCAST="broadcast",Vt.PRESENCE="presence",Vt.POSTGRES_CHANGES="postgres_changes",Vt.SYSTEM="system",(Yt=Ht||(Ht={})).SUBSCRIBED="SUBSCRIBED",Yt.TIMED_OUT="TIMED_OUT",Yt.CLOSED="CLOSED",Yt.CHANNEL_ERROR="CHANNEL_ERROR";class Xt{constructor(e,t={config:{}},s){this.topic=e,this.params=t,this.socket=s,this.bindings={},this.state=vt.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new Bt(this,jt.join,this.params,this.timeout),this.rejoinTimer=new Pt(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=vt.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(e=>e.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=vt.closed,this.socket._remove(this)}),this._onError(e=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,e),this.state=vt.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=vt.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",e=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,e),this.state=vt.errored,this.rejoinTimer.scheduleTimeout())}),this._on(jt.reply,{},(e,t)=>{this._trigger(this._replyEventName(t),e)}),this.presence=new Jt(this),this.broadcastEndpointURL=Ft(this.socket.endPoint),this.private=this.params.config.private||!1}subscribe(e,t=this.timeout){var s,r;if(this.socket.isConnected()||this.socket.connect(),this.state==vt.closed){const{config:{broadcast:n,presence:a,private:i}}=this.params,o=null!==(r=null===(s=this.bindings.postgres_changes)||void 0===s?void 0:s.map(e=>e.filter))&&void 0!==r?r:[],l=!!this.bindings[Kt.PRESENCE]&&this.bindings[Kt.PRESENCE].length>0,c={},d={broadcast:n,presence:Object.assign(Object.assign({},a),{enabled:l}),postgres_changes:o,private:i};this.socket.accessTokenValue&&(c.access_token=this.socket.accessTokenValue),this._onError(t=>null==e?void 0:e(Ht.CHANNEL_ERROR,t)),this._onClose(()=>null==e?void 0:e(Ht.CLOSED)),this.updateJoinPayload(Object.assign({config:d},c)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:t})=>{var s;if(this.socket.setAuth(),void 0!==t){const r=this.bindings.postgres_changes,n=null!==(s=null==r?void 0:r.length)&&void 0!==s?s:0,a=[];for(let s=0;s<n;s++){const n=r[s],{filter:{event:i,schema:o,table:l,filter:c}}=n,d=t&&t[s];if(!d||d.event!==i||d.schema!==o||d.table!==l||d.filter!==c)return this.unsubscribe(),this.state=vt.errored,void(null==e||e(Ht.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes")));a.push(Object.assign(Object.assign({},n),{id:d.id}))}return this.bindings.postgres_changes=a,void(e&&e(Ht.SUBSCRIBED))}null==e||e(Ht.SUBSCRIBED)}).receive("error",t=>{this.state=vt.errored,null==e||e(Ht.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(t).join(", ")||"error")))}).receive("timeout",()=>{null==e||e(Ht.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,s){return this.state===vt.joined&&e===Kt.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(e,t,s)}async send(e,t={}){var s,r;if(this._canPush()||"broadcast"!==e.type)return new Promise(s=>{var r,n,a;const i=this._push(e.type,e,t.timeout||this.timeout);"broadcast"!==e.type||(null===(a=null===(n=null===(r=this.params)||void 0===r?void 0:r.config)||void 0===n?void 0:n.broadcast)||void 0===a?void 0:a.ack)||s("ok"),i.receive("ok",()=>s("ok")),i.receive("error",()=>s("error")),i.receive("timeout",()=>s("timed out"))});{const{event:a,payload:i}=e,o={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:a,payload:i,private:this.private}]})};try{const e=await this._fetchWithTimeout(this.broadcastEndpointURL,o,null!==(s=t.timeout)&&void 0!==s?s:this.timeout);return await(null===(r=e.body)||void 0===r?void 0:r.cancel()),e.ok?"ok":"error"}catch(n){return"AbortError"===n.name?"timed out":"error"}}}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=vt.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(jt.close,"leave",this._joinRef())};this.joinPush.destroy();let s=null;return new Promise(r=>{s=new Bt(this,jt.leave,{},e),s.receive("ok",()=>{t(),r("ok")}).receive("timeout",()=>{t(),r("timed out")}).receive("error",()=>{r("error")}),s.send(),this._canPush()||s.trigger("ok",{})}).finally(()=>{null==s||s.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=vt.closed,this.bindings={}}async _fetchWithTimeout(e,t,s){const r=new AbortController,n=setTimeout(()=>r.abort(),s),a=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:r.signal}));return clearTimeout(n),a}_push(e,t,s=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let r=new Bt(this,e,t,s);return this._canPush()?r.send():this._addToPushBuffer(r),r}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>100){const e=this.pushBuffer.shift();e&&(e.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${e.event}`,e.payload))}}_onMessage(e,t,s){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,s){var r,n;const a=e.toLocaleLowerCase(),{close:i,error:o,leave:l,join:c}=jt;if(s&&[i,o,l,c].indexOf(a)>=0&&s!==this._joinRef())return;let d=this._onMessage(a,t,s);if(t&&!d)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(a)?null===(r=this.bindings.postgres_changes)||void 0===r||r.filter(e=>{var t,s,r;return"*"===(null===(t=e.filter)||void 0===t?void 0:t.event)||(null===(r=null===(s=e.filter)||void 0===s?void 0:s.event)||void 0===r?void 0:r.toLocaleLowerCase())===a}).map(e=>e.callback(d,s)):null===(n=this.bindings[a])||void 0===n||n.filter(e=>{var s,r,n,i,o,l;if(["broadcast","presence","postgres_changes"].includes(a)){if("id"in e){const a=e.id,i=null===(s=e.filter)||void 0===s?void 0:s.event;return a&&(null===(r=t.ids)||void 0===r?void 0:r.includes(a))&&("*"===i||(null==i?void 0:i.toLocaleLowerCase())===(null===(n=t.data)||void 0===n?void 0:n.type.toLocaleLowerCase()))}{const s=null===(o=null===(i=null==e?void 0:e.filter)||void 0===i?void 0:i.event)||void 0===o?void 0:o.toLocaleLowerCase();return"*"===s||s===(null===(l=null==t?void 0:t.event)||void 0===l?void 0:l.toLocaleLowerCase())}}return e.type.toLocaleLowerCase()===a}).map(e=>{if("object"==typeof d&&"ids"in d){const e=d.data,{schema:t,table:s,commit_timestamp:r,type:n,errors:a}=e,i={schema:t,table:s,commit_timestamp:r,eventType:n,new:{},old:{},errors:a};d=Object.assign(Object.assign({},i),this._getPayloadRecords(e))}e.callback(d,s)})}_isClosed(){return this.state===vt.closed}_isJoined(){return this.state===vt.joined}_isJoining(){return this.state===vt.joining}_isLeaving(){return this.state===vt.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,s){const r=e.toLocaleLowerCase(),n={type:r,filter:t,callback:s};return this.bindings[r]?this.bindings[r].push(n):this.bindings[r]=[n],this}_off(e,t){const s=e.toLocaleLowerCase();return this.bindings[s]&&(this.bindings[s]=this.bindings[s].filter(e=>{var r;return!((null===(r=e.type)||void 0===r?void 0:r.toLocaleLowerCase())===s&&Xt.isEqual(e.filter,t))})),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const s in e)if(e[s]!==t[s])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(jt.close,{},e)}_onError(e){this._on(jt.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=vt.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return"INSERT"!==e.type&&"UPDATE"!==e.type||(t.new=At(e.columns,e.record)),"UPDATE"!==e.type&&"DELETE"!==e.type||(t.old=At(e.columns,e.old_record)),t}}const Zt=()=>{},Qt=25e3,es=10,ts=100,ss=[1e3,2e3,5e3,1e4];class rs{constructor(e,t){var s;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=xt,this.transport=null,this.heartbeatIntervalMs=Qt,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=Zt,this.ref=0,this.reconnectTimer=null,this.logger=Zt,this.conn=null,this.sendBuffer=[],this.serializer=new Ct,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=e=>{let t;return t=e||("undefined"==typeof fetch?(...e)=>xe(async()=>{const{default:e}=await Promise.resolve().then(()=>Le);return{default:e}},void 0).then(({default:t})=>t(...e)).catch(e=>{throw new Error(`Failed to load @supabase/node-fetch: ${e.message}. This is required for HTTP requests in Node.js environments without native fetch.`)}):fetch),(...e)=>t(...e)},!(null===(s=null==t?void 0:t.params)||void 0===s?void 0:s.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=t.params.apikey,this.endPoint=`${e}/${Nt.websocket}`,this.httpEndpoint=Ft(e),this._initializeOptions(t),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(null==t?void 0:t.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||null!==this.conn&&this.isConnected())){if(this._setConnectionState("connecting"),this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=ft.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const t=e.message;if(t.includes("Node.js"))throw new Error(`${t}\n\nTo use Realtime in Node.js, you need to provide a WebSocket implementation:\n\nOption 1: Use Node.js 22+ which has native WebSocket support\nOption 2: Install and provide the "ws" package:\n\n  npm install ws\n\n  import ws from "ws"\n  const client = new RealtimeClient(url, {\n    ...options,\n    transport: ws\n  })`);throw new Error(`WebSocket not available: ${t}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:"1.0.0"}))}disconnect(e,t){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const s=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(s),this._setConnectionState("disconnected")},e?this.conn.close(e,null!=t?t:""):this.conn.close(),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return 0===this.channels.length&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(e=>e.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,t,s){this.logger(e,t,s)}connectionState(){switch(this.conn&&this.conn.readyState){case yt.connecting:return St.Connecting;case yt.open:return St.Open;case yt.closing:return St.Closing;default:return St.Closed}}isConnected(){return this.connectionState()===St.Open}isConnecting(){return"connecting"===this._connectionState}isDisconnecting(){return"disconnecting"===this._connectionState}channel(e,t={config:{}}){const s=`realtime:${e}`,r=this.getChannels().find(e=>e.topic===s);if(r)return r;{const s=new Xt(`realtime:${e}`,t,this);return this.channels.push(s),s}}push(e){const{topic:t,event:s,payload:r,ref:n}=e,a=()=>{this.encode(e,e=>{var t;null===(t=this.conn)||void 0===t||t.send(e)})};this.log("push",`${t} ${s} (${n})`,r),this.isConnected()?a():this.sendBuffer.push(a)}async setAuth(e=null){this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}async sendHeartbeat(){var e;if(this.isConnected()){if(this.pendingHeartbeatRef)return this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),this.heartbeatCallback("timeout"),this._wasManualDisconnect=!1,null===(e=this.conn)||void 0===e||e.close(1e3,"heartbeat timeout"),void setTimeout(()=>{var e;this.isConnected()||null===(e=this.reconnectTimer)||void 0===e||e.scheduleTimeout()},ts);this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.heartbeatCallback("sent"),this._setAuthSafely("heartbeat")}else this.heartbeatCallback("disconnected")}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(t=>t.topic===e&&(t._isJoined()||t._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,e=>{"phoenix"===e.topic&&"phx_reply"===e.event&&this.heartbeatCallback("ok"===e.payload.status?"ok":"error"),e.ref&&e.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:t,event:s,payload:r,ref:n}=e,a=n?`(${n})`:"",i=r.status||"";this.log("receive",`${i} ${t} ${s} ${a}`.trim(),r),this.channels.filter(e=>e._isMember(t)).forEach(e=>e._trigger(s,r,n)),this._triggerStateCallbacks("message",e)})}_clearTimer(e){var t;"heartbeat"===e&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):"reconnect"===e&&(null===(t=this.reconnectTimer)||void 0===t||t.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_teardownConnection(){this.conn&&(this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null),this._clearAllTimers(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=e=>{this.log("worker","worker error",e.message),this.workerRef.terminate()},this.workerRef.onmessage=e=>{"keepAlive"===e.data.event&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){var t;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||null===(t=this.reconnectTimer)||void 0===t||t.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e)}_triggerChanError(){this.channels.forEach(e=>e._trigger(jt.error))}_appendParams(e,t){if(0===Object.keys(t).length)return e;const s=e.match(/\?/)?"&":"?";return`${e}${s}${new URLSearchParams(t)}`}_workerObjectUrl(e){let t;if(e)t=e;else{const e=new Blob(['\n  addEventListener("message", (e) => {\n    if (e.data.event === "start") {\n      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);\n    }\n  });'],{type:"application/javascript"});t=URL.createObjectURL(e)}return t}_setConnectionState(e,t=!1){this._connectionState=e,"connecting"===e?this._wasManualDisconnect=!1:"disconnecting"===e&&(this._wasManualDisconnect=t)}async _performAuth(e=null){let t;t=e||(this.accessToken?await this.accessToken():this.accessTokenValue),this.accessTokenValue!=t&&(this.accessTokenValue=t,this.channels.forEach(e=>{const s={access_token:t,version:"realtime-js/2.15.1"};t&&e.updateJoinPayload(s),e.joinedOnce&&e._isJoined()&&e._push(jt.access_token,{access_token:t})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(e="general"){this.setAuth().catch(t=>{this.log("error",`error setting auth in ${e}`,t)})}_triggerStateCallbacks(e,t){try{this.stateChangeCallbacks[e].forEach(s=>{try{s(t)}catch(r){this.log("error",`error in ${e} callback`,r)}})}catch(s){this.log("error",`error triggering ${e} callbacks`,s)}}_setupReconnectionTimer(){this.reconnectTimer=new Pt(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},es)},this.reconnectAfterMs)}_initializeOptions(e){var t,s,r,n,a,i,o,l;if(this.transport=null!==(t=null==e?void 0:e.transport)&&void 0!==t?t:null,this.timeout=null!==(s=null==e?void 0:e.timeout)&&void 0!==s?s:xt,this.heartbeatIntervalMs=null!==(r=null==e?void 0:e.heartbeatIntervalMs)&&void 0!==r?r:Qt,this.worker=null!==(n=null==e?void 0:e.worker)&&void 0!==n&&n,this.accessToken=null!==(a=null==e?void 0:e.accessToken)&&void 0!==a?a:null,(null==e?void 0:e.params)&&(this.params=e.params),(null==e?void 0:e.logger)&&(this.logger=e.logger),((null==e?void 0:e.logLevel)||(null==e?void 0:e.log_level))&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=null!==(i=null==e?void 0:e.reconnectAfterMs)&&void 0!==i?i:e=>ss[e-1]||1e4,this.encode=null!==(o=null==e?void 0:e.encode)&&void 0!==o?o:(e,t)=>t(JSON.stringify(e)),this.decode=null!==(l=null==e?void 0:e.decode)&&void 0!==l?l:this.serializer.decode.bind(this.serializer),this.worker){if("undefined"!=typeof window&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=null==e?void 0:e.workerUrl}}}class ns extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function as(e){return"object"==typeof e&&null!==e&&"__isStorageError"in e}class is extends ns{constructor(e,t,s){super(e),this.name="StorageApiError",this.status=t,this.statusCode=s}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class os extends ns{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var ls=function(e,t,s,r){return new(s||(s=Promise))(function(n,a){function i(e){try{l(r.next(e))}catch(t){a(t)}}function o(e){try{l(r.throw(e))}catch(t){a(t)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s(function(e){e(t)})).then(i,o)}l((r=r.apply(e,t||[])).next())})};const cs=e=>{let t;return t=e||("undefined"==typeof fetch?(...e)=>xe(async()=>{const{default:e}=await Promise.resolve().then(()=>Le);return{default:e}},void 0).then(({default:t})=>t(...e)):fetch),(...e)=>t(...e)},ds=e=>{if(Array.isArray(e))return e.map(e=>ds(e));if("function"==typeof e||e!==Object(e))return e;const t={};return Object.entries(e).forEach(([e,s])=>{const r=e.replace(/([-_][a-z])/gi,e=>e.toUpperCase().replace(/[-_]/g,""));t[r]=ds(s)}),t};var us=function(e,t,s,r){return new(s||(s=Promise))(function(n,a){function i(e){try{l(r.next(e))}catch(t){a(t)}}function o(e){try{l(r.throw(e))}catch(t){a(t)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s(function(e){e(t)})).then(i,o)}l((r=r.apply(e,t||[])).next())})};const hs=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),ms=(e,t,s)=>us(void 0,void 0,void 0,function*(){const r=yield ls(void 0,void 0,void 0,function*(){return"undefined"==typeof Response?(yield xe(()=>Promise.resolve().then(()=>Le),void 0)).Response:Response});e instanceof r&&!(null==s?void 0:s.noResolveJson)?e.json().then(s=>{const r=e.status||500,n=(null==s?void 0:s.statusCode)||r+"";t(new is(hs(s),r,n))}).catch(e=>{t(new os(hs(e),e))}):t(new os(hs(e),e))}),ps=(e,t,s,r)=>{const n={method:e,headers:(null==t?void 0:t.headers)||{}};return"GET"!==e&&r?((e=>{if("object"!=typeof e||null===e)return!1;const t=Object.getPrototypeOf(e);return!(null!==t&&t!==Object.prototype&&null!==Object.getPrototypeOf(t)||Symbol.toStringTag in e||Symbol.iterator in e)})(r)?(n.headers=Object.assign({"Content-Type":"application/json"},null==t?void 0:t.headers),n.body=JSON.stringify(r)):n.body=r,(null==t?void 0:t.duplex)&&(n.duplex=t.duplex),Object.assign(Object.assign({},n),s)):n};function gs(e,t,s,r,n,a){return us(this,void 0,void 0,function*(){return new Promise((i,o)=>{e(s,ps(t,r,n,a)).then(e=>{if(!e.ok)throw e;return(null==r?void 0:r.noResolveJson)?e:e.json()}).then(e=>i(e)).catch(e=>ms(e,o,r))})})}function fs(e,t,s,r){return us(this,void 0,void 0,function*(){return gs(e,"GET",t,s,r)})}function xs(e,t,s,r,n){return us(this,void 0,void 0,function*(){return gs(e,"POST",t,r,n,s)})}function ys(e,t,s,r,n){return us(this,void 0,void 0,function*(){return gs(e,"PUT",t,r,n,s)})}function bs(e,t,s,r,n){return us(this,void 0,void 0,function*(){return gs(e,"DELETE",t,r,n,s)})}var vs=function(e,t,s,r){return new(s||(s=Promise))(function(n,a){function i(e){try{l(r.next(e))}catch(t){a(t)}}function o(e){try{l(r.throw(e))}catch(t){a(t)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s(function(e){e(t)})).then(i,o)}l((r=r.apply(e,t||[])).next())})};const ws={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},js={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class _s{constructor(e,t={},s,r){this.url=e,this.headers=t,this.bucketId=s,this.fetch=cs(r)}uploadOrUpdate(e,t,s,r){return vs(this,void 0,void 0,function*(){try{let n;const a=Object.assign(Object.assign({},js),r);let i=Object.assign(Object.assign({},this.headers),"POST"===e&&{"x-upsert":String(a.upsert)});const o=a.metadata;"undefined"!=typeof Blob&&s instanceof Blob?(n=new FormData,n.append("cacheControl",a.cacheControl),o&&n.append("metadata",this.encodeMetadata(o)),n.append("",s)):"undefined"!=typeof FormData&&s instanceof FormData?(n=s,n.append("cacheControl",a.cacheControl),o&&n.append("metadata",this.encodeMetadata(o))):(n=s,i["cache-control"]=`max-age=${a.cacheControl}`,i["content-type"]=a.contentType,o&&(i["x-metadata"]=this.toBase64(this.encodeMetadata(o)))),(null==r?void 0:r.headers)&&(i=Object.assign(Object.assign({},i),r.headers));const l=this._removeEmptyFolders(t),c=this._getFinalPath(l),d=yield("PUT"==e?ys:xs)(this.fetch,`${this.url}/object/${c}`,n,Object.assign({headers:i},(null==a?void 0:a.duplex)?{duplex:a.duplex}:{}));return{data:{path:l,id:d.Id,fullPath:d.Key},error:null}}catch(n){if(as(n))return{data:null,error:n};throw n}})}upload(e,t,s){return vs(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,s)})}uploadToSignedUrl(e,t,s,r){return vs(this,void 0,void 0,function*(){const n=this._removeEmptyFolders(e),a=this._getFinalPath(n),i=new URL(this.url+`/object/upload/sign/${a}`);i.searchParams.set("token",t);try{let e;const t=Object.assign({upsert:js.upsert},r),a=Object.assign(Object.assign({},this.headers),{"x-upsert":String(t.upsert)});"undefined"!=typeof Blob&&s instanceof Blob?(e=new FormData,e.append("cacheControl",t.cacheControl),e.append("",s)):"undefined"!=typeof FormData&&s instanceof FormData?(e=s,e.append("cacheControl",t.cacheControl)):(e=s,a["cache-control"]=`max-age=${t.cacheControl}`,a["content-type"]=t.contentType);return{data:{path:n,fullPath:(yield ys(this.fetch,i.toString(),e,{headers:a})).Key},error:null}}catch(o){if(as(o))return{data:null,error:o};throw o}})}createSignedUploadUrl(e,t){return vs(this,void 0,void 0,function*(){try{let s=this._getFinalPath(e);const r=Object.assign({},this.headers);(null==t?void 0:t.upsert)&&(r["x-upsert"]="true");const n=yield xs(this.fetch,`${this.url}/object/upload/sign/${s}`,{},{headers:r}),a=new URL(this.url+n.url),i=a.searchParams.get("token");if(!i)throw new ns("No token returned by API");return{data:{signedUrl:a.toString(),path:e,token:i},error:null}}catch(s){if(as(s))return{data:null,error:s};throw s}})}update(e,t,s){return vs(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,s)})}move(e,t,s){return vs(this,void 0,void 0,function*(){try{return{data:yield xs(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:null==s?void 0:s.destinationBucket},{headers:this.headers}),error:null}}catch(r){if(as(r))return{data:null,error:r};throw r}})}copy(e,t,s){return vs(this,void 0,void 0,function*(){try{return{data:{path:(yield xs(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:null==s?void 0:s.destinationBucket},{headers:this.headers})).Key},error:null}}catch(r){if(as(r))return{data:null,error:r};throw r}})}createSignedUrl(e,t,s){return vs(this,void 0,void 0,function*(){try{let r=this._getFinalPath(e),n=yield xs(this.fetch,`${this.url}/object/sign/${r}`,Object.assign({expiresIn:t},(null==s?void 0:s.transform)?{transform:s.transform}:{}),{headers:this.headers});const a=(null==s?void 0:s.download)?`&download=${!0===s.download?"":s.download}`:"";return n={signedUrl:encodeURI(`${this.url}${n.signedURL}${a}`)},{data:n,error:null}}catch(r){if(as(r))return{data:null,error:r};throw r}})}createSignedUrls(e,t,s){return vs(this,void 0,void 0,function*(){try{const r=yield xs(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),n=(null==s?void 0:s.download)?`&download=${!0===s.download?"":s.download}`:"";return{data:r.map(e=>Object.assign(Object.assign({},e),{signedUrl:e.signedURL?encodeURI(`${this.url}${e.signedURL}${n}`):null})),error:null}}catch(r){if(as(r))return{data:null,error:r};throw r}})}download(e,t){return vs(this,void 0,void 0,function*(){const s=void 0!==(null==t?void 0:t.transform)?"render/image/authenticated":"object",r=this.transformOptsToQueryString((null==t?void 0:t.transform)||{}),n=r?`?${r}`:"";try{const t=this._getFinalPath(e),r=yield fs(this.fetch,`${this.url}/${s}/${t}${n}`,{headers:this.headers,noResolveJson:!0});return{data:yield r.blob(),error:null}}catch(a){if(as(a))return{data:null,error:a};throw a}})}info(e){return vs(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const e=yield fs(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:ds(e),error:null}}catch(s){if(as(s))return{data:null,error:s};throw s}})}exists(e){return vs(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield function(e,t,s,r){return us(this,void 0,void 0,function*(){return gs(e,"HEAD",t,Object.assign(Object.assign({},s),{noResolveJson:!0}),r)})}(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(s){if(as(s)&&s instanceof os){const e=s.originalError;if([400,404].includes(null==e?void 0:e.status))return{data:!1,error:s}}throw s}})}getPublicUrl(e,t){const s=this._getFinalPath(e),r=[],n=(null==t?void 0:t.download)?`download=${!0===t.download?"":t.download}`:"";""!==n&&r.push(n);const a=void 0!==(null==t?void 0:t.transform)?"render/image":"object",i=this.transformOptsToQueryString((null==t?void 0:t.transform)||{});""!==i&&r.push(i);let o=r.join("&");return""!==o&&(o=`?${o}`),{data:{publicUrl:encodeURI(`${this.url}/${a}/public/${s}${o}`)}}}remove(e){return vs(this,void 0,void 0,function*(){try{return{data:yield bs(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(as(t))return{data:null,error:t};throw t}})}list(e,t,s){return vs(this,void 0,void 0,function*(){try{const r=Object.assign(Object.assign(Object.assign({},ws),t),{prefix:e||""});return{data:yield xs(this.fetch,`${this.url}/object/list/${this.bucketId}`,r,{headers:this.headers},s),error:null}}catch(r){if(as(r))return{data:null,error:r};throw r}})}listV2(e,t){return vs(this,void 0,void 0,function*(){try{const s=Object.assign({},e);return{data:yield xs(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,s,{headers:this.headers},t),error:null}}catch(s){if(as(s))return{data:null,error:s};throw s}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return"undefined"!=typeof Buffer?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e.replace(/^\/+/,"")}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const Ns={"X-Client-Info":"storage-js/2.11.0"};var Ss=function(e,t,s,r){return new(s||(s=Promise))(function(n,a){function i(e){try{l(r.next(e))}catch(t){a(t)}}function o(e){try{l(r.throw(e))}catch(t){a(t)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s(function(e){e(t)})).then(i,o)}l((r=r.apply(e,t||[])).next())})};class ks{constructor(e,t={},s,r){const n=new URL(e);if(null==r?void 0:r.useNewHostname){/supabase\.(co|in|red)$/.test(n.hostname)&&!n.hostname.includes("storage.supabase.")&&(n.hostname=n.hostname.replace("supabase.","storage.supabase."))}this.url=n.href,this.headers=Object.assign(Object.assign({},Ns),t),this.fetch=cs(s)}listBuckets(){return Ss(this,void 0,void 0,function*(){try{return{data:yield fs(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(as(e))return{data:null,error:e};throw e}})}getBucket(e){return Ss(this,void 0,void 0,function*(){try{return{data:yield fs(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(as(t))return{data:null,error:t};throw t}})}createBucket(e,t={public:!1}){return Ss(this,void 0,void 0,function*(){try{return{data:yield xs(this.fetch,`${this.url}/bucket`,{id:e,name:e,type:t.type,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(s){if(as(s))return{data:null,error:s};throw s}})}updateBucket(e,t){return Ss(this,void 0,void 0,function*(){try{return{data:yield ys(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(s){if(as(s))return{data:null,error:s};throw s}})}emptyBucket(e){return Ss(this,void 0,void 0,function*(){try{return{data:yield xs(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(as(t))return{data:null,error:t};throw t}})}deleteBucket(e){return Ss(this,void 0,void 0,function*(){try{return{data:yield bs(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(as(t))return{data:null,error:t};throw t}})}}class Es extends ks{constructor(e,t={},s,r){super(e,t,s,r)}from(e){return new _s(this.url,this.headers,e,this.fetch)}}let Ts="";Ts="undefined"!=typeof Deno?"deno":"undefined"!=typeof document?"web":"undefined"!=typeof navigator&&"ReactNative"===navigator.product?"react-native":"node";const Cs={headers:{"X-Client-Info":`supabase-js-${Ts}/2.56.0`}},Ps={schema:"public"},As={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},Is={};var Ds=function(e,t,s,r){return new(s||(s=Promise))(function(n,a){function i(e){try{l(r.next(e))}catch(t){a(t)}}function o(e){try{l(r.throw(e))}catch(t){a(t)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s(function(e){e(t)})).then(i,o)}l((r=r.apply(e,t||[])).next())})};const Os=(e,t,s)=>{const r=(e=>{let t;return t=e||("undefined"==typeof fetch?Oe:fetch),(...e)=>t(...e)})(s),n="undefined"==typeof Headers?$e:Headers;return(s,a)=>Ds(void 0,void 0,void 0,function*(){var i;const o=null!==(i=yield t())&&void 0!==i?i:e;let l=new n(null==a?void 0:a.headers);return l.has("apikey")||l.set("apikey",e),l.has("Authorization")||l.set("Authorization",`Bearer ${o}`),r(s,Object.assign(Object.assign({},a),{headers:l}))})};var $s=function(e,t,s,r){return new(s||(s=Promise))(function(n,a){function i(e){try{l(r.next(e))}catch(t){a(t)}}function o(e){try{l(r.throw(e))}catch(t){a(t)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s(function(e){e(t)})).then(i,o)}l((r=r.apply(e,t||[])).next())})};const Rs="2.71.1",Us=3e4,Ls=9e4,Ms={"X-Client-Info":`gotrue-js/${Rs}`},Fs="X-Supabase-Api-Version",Bs={timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"},qs=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i;class zs extends Error{constructor(e,t,s){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=s}}function Gs(e){return"object"==typeof e&&null!==e&&"__isAuthError"in e}class Ws extends zs{constructor(e,t,s){super(e,t,s),this.name="AuthApiError",this.status=t,this.code=s}}class Ks extends zs{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class Vs extends zs{constructor(e,t,s,r){super(e,s,r),this.name=t,this.status=s}}class Hs extends Vs{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}class Ys extends Vs{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Js extends Vs{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class Xs extends Vs{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Zs extends Vs{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Qs extends Vs{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function er(e){return Gs(e)&&"AuthRetryableFetchError"===e.name}class tr extends Vs{constructor(e,t,s){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=s}}class sr extends Vs{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const rr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),nr=" \t\n\r=".split(""),ar=(()=>{const e=new Array(128);for(let t=0;t<e.length;t+=1)e[t]=-1;for(let t=0;t<nr.length;t+=1)e[nr[t].charCodeAt(0)]=-2;for(let t=0;t<rr.length;t+=1)e[rr[t].charCodeAt(0)]=t;return e})();function ir(e,t,s){if(null!==e)for(t.queue=t.queue<<8|e,t.queuedBits+=8;t.queuedBits>=6;){const e=t.queue>>t.queuedBits-6&63;s(rr[e]),t.queuedBits-=6}else if(t.queuedBits>0)for(t.queue=t.queue<<6-t.queuedBits,t.queuedBits=6;t.queuedBits>=6;){const e=t.queue>>t.queuedBits-6&63;s(rr[e]),t.queuedBits-=6}}function or(e,t,s){const r=ar[e];if(!(r>-1)){if(-2===r)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(e)}"`)}for(t.queue=t.queue<<6|r,t.queuedBits+=6;t.queuedBits>=8;)s(t.queue>>t.queuedBits-8&255),t.queuedBits-=8}function lr(e){const t=[],s=e=>{t.push(String.fromCodePoint(e))},r={utf8seq:0,codepoint:0},n={queue:0,queuedBits:0},a=e=>{!function(e,t,s){if(0===t.utf8seq){if(e<=127)return void s(e);for(let s=1;s<6;s+=1)if(!(e>>7-s&1)){t.utf8seq=s;break}if(2===t.utf8seq)t.codepoint=31&e;else if(3===t.utf8seq)t.codepoint=15&e;else{if(4!==t.utf8seq)throw new Error("Invalid UTF-8 sequence");t.codepoint=7&e}t.utf8seq-=1}else if(t.utf8seq>0){if(e<=127)throw new Error("Invalid UTF-8 sequence");t.codepoint=t.codepoint<<6|63&e,t.utf8seq-=1,0===t.utf8seq&&s(t.codepoint)}}(e,r,s)};for(let i=0;i<e.length;i+=1)or(e.charCodeAt(i),n,a);return t.join("")}function cr(e,t){if(!(e<=127)){if(e<=2047)return t(192|e>>6),void t(128|63&e);if(e<=65535)return t(224|e>>12),t(128|e>>6&63),void t(128|63&e);if(e<=1114111)return t(240|e>>18),t(128|e>>12&63),t(128|e>>6&63),void t(128|63&e);throw new Error(`Unrecognized Unicode codepoint: ${e.toString(16)}`)}t(e)}function dr(e){const t=[],s={queue:0,queuedBits:0},r=e=>{t.push(e)};for(let n=0;n<e.length;n+=1)or(e.charCodeAt(n),s,r);return new Uint8Array(t)}function ur(e){const t=[];return function(e,t){for(let s=0;s<e.length;s+=1){let r=e.charCodeAt(s);if(r>55295&&r<=56319){const t=1024*(r-55296)&65535;r=65536+(e.charCodeAt(s+1)-56320&65535|t),s+=1}cr(r,t)}}(e,e=>t.push(e)),new Uint8Array(t)}function hr(e){const t=[],s={queue:0,queuedBits:0},r=e=>{t.push(e)};return e.forEach(e=>ir(e,s,r)),ir(null,s,r),t.join("")}const mr=()=>"undefined"!=typeof window&&"undefined"!=typeof document,pr={tested:!1,writable:!1},gr=()=>{if(!mr())return!1;try{if("object"!=typeof globalThis.localStorage)return!1}catch(t){return!1}if(pr.tested)return pr.writable;const e=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(e,e),globalThis.localStorage.removeItem(e),pr.tested=!0,pr.writable=!0}catch(t){pr.tested=!0,pr.writable=!1}return pr.writable};const fr=e=>{let t;return t=e||("undefined"==typeof fetch?(...e)=>xe(async()=>{const{default:e}=await Promise.resolve().then(()=>Le);return{default:e}},void 0).then(({default:t})=>t(...e)):fetch),(...e)=>t(...e)},xr=async(e,t,s)=>{await e.setItem(t,JSON.stringify(s))},yr=async(e,t)=>{const s=await e.getItem(t);if(!s)return null;try{return JSON.parse(s)}catch(r){return s}},br=async(e,t)=>{await e.removeItem(t)};class vr{constructor(){this.promise=new vr.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}function wr(e){const t=e.split(".");if(3!==t.length)throw new sr("Invalid JWT structure");for(let s=0;s<t.length;s++)if(!qs.test(t[s]))throw new sr("JWT not in base64url format");return{header:JSON.parse(lr(t[0])),payload:JSON.parse(lr(t[1])),signature:dr(t[2]),raw:{header:t[0],payload:t[1]}}}function jr(e){return("0"+e.toString(16)).substr(-2)}async function _r(e){if(!("undefined"!=typeof crypto&&void 0!==crypto.subtle&&"undefined"!=typeof TextEncoder))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),e;const t=await async function(e){const t=(new TextEncoder).encode(e),s=await crypto.subtle.digest("SHA-256",t),r=new Uint8Array(s);return Array.from(r).map(e=>String.fromCharCode(e)).join("")}(e);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function Nr(e,t,s=!1){const r=function(){const e=new Uint32Array(56);if("undefined"==typeof crypto){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",t=e.length;let s="";for(let r=0;r<56;r++)s+=e.charAt(Math.floor(Math.random()*t));return s}return crypto.getRandomValues(e),Array.from(e,jr).join("")}();let n=r;s&&(n+="/PASSWORD_RECOVERY"),await xr(e,`${t}-code-verifier`,n);const a=await _r(r);return[a,r===a?"plain":"s256"]}vr.promiseConstructor=Promise;const Sr=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;const kr=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function Er(e){if(!kr.test(e))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function Tr(){return new Proxy({},{get:(e,t)=>{if("__isUserNotAvailableProxy"===t)return!0;if("symbol"==typeof t){const e=t.toString();if("Symbol(Symbol.toPrimitive)"===e||"Symbol(Symbol.toStringTag)"===e||"Symbol(util.inspect.custom)"===e)return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${t}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function Cr(e){return JSON.parse(JSON.stringify(e))}const Pr=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),Ar=[502,503,504];async function Ir(e){var t,s;if(!("object"==typeof(s=e)&&null!==s&&"status"in s&&"ok"in s&&"json"in s&&"function"==typeof s.json))throw new Qs(Pr(e),0);if(Ar.includes(e.status))throw new Qs(Pr(e),e.status);let r,n;try{r=await e.json()}catch(i){throw new Ks(Pr(i),i)}const a=function(e){const t=e.headers.get(Fs);if(!t)return null;if(!t.match(Sr))return null;try{return new Date(`${t}T00:00:00.0Z`)}catch(i){return null}}(e);if(a&&a.getTime()>=Bs.timestamp&&"object"==typeof r&&r&&"string"==typeof r.code?n=r.code:"object"==typeof r&&r&&"string"==typeof r.error_code&&(n=r.error_code),n){if("weak_password"===n)throw new tr(Pr(r),e.status,(null===(t=r.weak_password)||void 0===t?void 0:t.reasons)||[]);if("session_not_found"===n)throw new Hs}else if("object"==typeof r&&r&&"object"==typeof r.weak_password&&r.weak_password&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.reasons.reduce((e,t)=>e&&"string"==typeof t,!0))throw new tr(Pr(r),e.status,r.weak_password.reasons);throw new Ws(Pr(r),e.status||500,n)}async function Dr(e,t,s,r){var n;const a=Object.assign({},null==r?void 0:r.headers);a[Fs]||(a[Fs]=Bs.name),(null==r?void 0:r.jwt)&&(a.Authorization=`Bearer ${r.jwt}`);const i=null!==(n=null==r?void 0:r.query)&&void 0!==n?n:{};(null==r?void 0:r.redirectTo)&&(i.redirect_to=r.redirectTo);const o=Object.keys(i).length?"?"+new URLSearchParams(i).toString():"",l=await async function(e,t,s,r,n,a){const i=((e,t,s,r)=>{const n={method:e,headers:(null==t?void 0:t.headers)||{}};return"GET"===e?n:(n.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},null==t?void 0:t.headers),n.body=JSON.stringify(r),Object.assign(Object.assign({},n),s))})(t,r,n,a);let o;try{o=await e(s,Object.assign({},i))}catch(l){throw console.error(l),new Qs(Pr(l),0)}o.ok||await Ir(o);if(null==r?void 0:r.noResolveJson)return o;try{return await o.json()}catch(l){await Ir(l)}}(e,t,s+o,{headers:a,noResolveJson:null==r?void 0:r.noResolveJson},{},null==r?void 0:r.body);return(null==r?void 0:r.xform)?null==r?void 0:r.xform(l):{data:Object.assign({},l),error:null}}function Or(e){var t;let s=null;var r;(function(e){return e.access_token&&e.refresh_token&&e.expires_in})(e)&&(s=Object.assign({},e),e.expires_at||(s.expires_at=(r=e.expires_in,Math.round(Date.now()/1e3)+r)));return{data:{session:s,user:null!==(t=e.user)&&void 0!==t?t:e},error:null}}function $r(e){const t=Or(e);return!t.error&&e.weak_password&&"object"==typeof e.weak_password&&Array.isArray(e.weak_password.reasons)&&e.weak_password.reasons.length&&e.weak_password.message&&"string"==typeof e.weak_password.message&&e.weak_password.reasons.reduce((e,t)=>e&&"string"==typeof t,!0)&&(t.data.weak_password=e.weak_password),t}function Rr(e){var t;return{data:{user:null!==(t=e.user)&&void 0!==t?t:e},error:null}}function Ur(e){return{data:e,error:null}}function Lr(e){const{action_link:t,email_otp:s,hashed_token:r,redirect_to:n,verification_type:a}=e,i=function(e,t){var s={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(s[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(r=Object.getOwnPropertySymbols(e);n<r.length;n++)t.indexOf(r[n])<0&&Object.prototype.propertyIsEnumerable.call(e,r[n])&&(s[r[n]]=e[r[n]])}return s}(e,["action_link","email_otp","hashed_token","redirect_to","verification_type"]);return{data:{properties:{action_link:t,email_otp:s,hashed_token:r,redirect_to:n,verification_type:a},user:Object.assign({},i)},error:null}}function Mr(e){return e}const Fr=["global","local","others"];class Br{constructor({url:e="",headers:t={},fetch:s}){this.url=e,this.headers=t,this.fetch=fr(s),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,t=Fr[0]){if(Fr.indexOf(t)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${Fr.join(", ")}`);try{return await Dr(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(s){if(Gs(s))return{data:null,error:s};throw s}}async inviteUserByEmail(e,t={}){try{return await Dr(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:Rr})}catch(s){if(Gs(s))return{data:{user:null},error:s};throw s}}async generateLink(e){try{const{options:t}=e,s=function(e,t){var s={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(s[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(r=Object.getOwnPropertySymbols(e);n<r.length;n++)t.indexOf(r[n])<0&&Object.prototype.propertyIsEnumerable.call(e,r[n])&&(s[r[n]]=e[r[n]])}return s}(e,["options"]),r=Object.assign(Object.assign({},s),t);return"newEmail"in s&&(r.new_email=null==s?void 0:s.newEmail,delete r.newEmail),await Dr(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:r,headers:this.headers,xform:Lr,redirectTo:null==t?void 0:t.redirectTo})}catch(t){if(Gs(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await Dr(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:Rr})}catch(t){if(Gs(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,s,r,n,a,i,o;try{const l={nextPage:null,lastPage:0,total:0},c=await Dr(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:null!==(s=null===(t=null==e?void 0:e.page)||void 0===t?void 0:t.toString())&&void 0!==s?s:"",per_page:null!==(n=null===(r=null==e?void 0:e.perPage)||void 0===r?void 0:r.toString())&&void 0!==n?n:""},xform:Mr});if(c.error)throw c.error;const d=await c.json(),u=null!==(a=c.headers.get("x-total-count"))&&void 0!==a?a:0,h=null!==(o=null===(i=c.headers.get("link"))||void 0===i?void 0:i.split(","))&&void 0!==o?o:[];return h.length>0&&(h.forEach(e=>{const t=parseInt(e.split(";")[0].split("=")[1].substring(0,1)),s=JSON.parse(e.split(";")[1].split("=")[1]);l[`${s}Page`]=t}),l.total=parseInt(u)),{data:Object.assign(Object.assign({},d),l),error:null}}catch(l){if(Gs(l))return{data:{users:[]},error:l};throw l}}async getUserById(e){Er(e);try{return await Dr(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:Rr})}catch(t){if(Gs(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){Er(e);try{return await Dr(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:Rr})}catch(s){if(Gs(s))return{data:{user:null},error:s};throw s}}async deleteUser(e,t=!1){Er(e);try{return await Dr(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:Rr})}catch(s){if(Gs(s))return{data:{user:null},error:s};throw s}}async _listFactors(e){Er(e.userId);try{const{data:t,error:s}=await Dr(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:e=>({data:{factors:e},error:null})});return{data:t,error:s}}catch(t){if(Gs(t))return{data:null,error:t};throw t}}async _deleteFactor(e){Er(e.userId),Er(e.id);try{return{data:await Dr(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(Gs(t))return{data:null,error:t};throw t}}}function qr(e={}){return{getItem:t=>e[t]||null,setItem:(t,s)=>{e[t]=s},removeItem:t=>{delete e[t]}}}const zr=!!(globalThis&&gr()&&globalThis.localStorage&&"true"===globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug"));class Gr extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class Wr extends Gr{}async function Kr(e,t,s){zr&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",e,t);const r=new globalThis.AbortController;return t>0&&setTimeout(()=>{r.abort(),zr&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",e)},t),await Promise.resolve().then(()=>globalThis.navigator.locks.request(e,0===t?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},async r=>{if(!r){if(0===t)throw zr&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",e),new Wr(`Acquiring an exclusive Navigator LockManager lock "${e}" immediately failed`);if(zr)try{const e=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(e,null,"  "))}catch(n){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",n)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await s()}zr&&console.log("@supabase/gotrue-js: navigatorLock: acquired",e,r.name);try{return await s()}finally{zr&&console.log("@supabase/gotrue-js: navigatorLock: released",e,r.name)}}))}!function(){if("object"!=typeof globalThis)try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch(e){"undefined"!=typeof self&&(self.globalThis=self)}}();const Vr={url:"http://localhost:9999",storageKey:"supabase.auth.token",autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:Ms,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function Hr(e,t,s){return await s()}const Yr={};class Jr{constructor(e){var t,s;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=Jr.nextInstanceID,Jr.nextInstanceID+=1,this.instanceID>0&&mr()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const r=Object.assign(Object.assign({},Vr),e);if(this.logDebugMessages=!!r.debug,"function"==typeof r.debug&&(this.logger=r.debug),this.persistSession=r.persistSession,this.storageKey=r.storageKey,this.autoRefreshToken=r.autoRefreshToken,this.admin=new Br({url:r.url,headers:r.headers,fetch:r.fetch}),this.url=r.url,this.headers=r.headers,this.fetch=fr(r.fetch),this.lock=r.lock||Hr,this.detectSessionInUrl=r.detectSessionInUrl,this.flowType=r.flowType,this.hasCustomAuthorizationHeader=r.hasCustomAuthorizationHeader,r.lock?this.lock=r.lock:mr()&&(null===(t=null===globalThis||void 0===globalThis?void 0:globalThis.navigator)||void 0===t?void 0:t.locks)?this.lock=Kr:this.lock=Hr,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?(r.storage?this.storage=r.storage:gr()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=qr(this.memoryStorage)),r.userStorage&&(this.userStorage=r.userStorage)):(this.memoryStorage={},this.storage=qr(this.memoryStorage)),mr()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(n){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",n)}null===(s=this.broadcastChannel)||void 0===s||s.addEventListener("message",async e=>{this._debug("received broadcast notification from other tab or client",e),await this._notifyAllSubscribers(e.data.event,e.data.session,!1)})}this.initialize()}get jwks(){var e,t;return null!==(t=null===(e=Yr[this.storageKey])||void 0===e?void 0:e.jwks)&&void 0!==t?t:{keys:[]}}set jwks(e){Yr[this.storageKey]=Object.assign(Object.assign({},Yr[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,t;return null!==(t=null===(e=Yr[this.storageKey])||void 0===e?void 0:e.cachedAt)&&void 0!==t?t:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){Yr[this.storageKey]=Object.assign(Object.assign({},Yr[this.storageKey]),{cachedAt:e})}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${Rs}) ${(new Date).toISOString()}`,...e),this}async initialize(){return this.initializePromise||(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))()),await this.initializePromise}async _initialize(){var e;try{const t=function(e){const t={},s=new URL(e);if(s.hash&&"#"===s.hash[0])try{new URLSearchParams(s.hash.substring(1)).forEach((e,s)=>{t[s]=e})}catch(r){}return s.searchParams.forEach((e,s)=>{t[s]=e}),t}(window.location.href);let s="none";if(this._isImplicitGrantCallback(t)?s="implicit":await this._isPKCECallback(t)&&(s="pkce"),mr()&&this.detectSessionInUrl&&"none"!==s){const{data:r,error:n}=await this._getSessionFromURL(t,s);if(n){if(this._debug("#_initialize()","error detecting session from URL",n),function(e){return Gs(e)&&"AuthImplicitGrantRedirectError"===e.name}(n)){const t=null===(e=n.details)||void 0===e?void 0:e.code;if("identity_already_exists"===t||"identity_not_found"===t||"single_identity_not_deletable"===t)return{error:n}}return await this._removeSession(),{error:n}}const{session:a,redirectType:i}=r;return this._debug("#_initialize()","detected session in URL",a,"redirect type",i),await this._saveSession(a),setTimeout(async()=>{"recovery"===i?await this._notifyAllSubscribers("PASSWORD_RECOVERY",a):await this._notifyAllSubscribers("SIGNED_IN",a)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return Gs(t)?{error:t}:{error:new Ks("Unexpected error during initialization",t)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,s,r;try{const n=await Dr(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:null!==(s=null===(t=null==e?void 0:e.options)||void 0===t?void 0:t.data)&&void 0!==s?s:{},gotrue_meta_security:{captcha_token:null===(r=null==e?void 0:e.options)||void 0===r?void 0:r.captchaToken}},xform:Or}),{data:a,error:i}=n;if(i||!a)return{data:{user:null,session:null},error:i};const o=a.session,l=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",o)),{data:{user:l,session:o},error:null}}catch(n){if(Gs(n))return{data:{user:null,session:null},error:n};throw n}}async signUp(e){var t,s,r;try{let n;if("email"in e){const{email:s,password:r,options:a}=e;let i=null,o=null;"pkce"===this.flowType&&([i,o]=await Nr(this.storage,this.storageKey)),n=await Dr(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:null==a?void 0:a.emailRedirectTo,body:{email:s,password:r,data:null!==(t=null==a?void 0:a.data)&&void 0!==t?t:{},gotrue_meta_security:{captcha_token:null==a?void 0:a.captchaToken},code_challenge:i,code_challenge_method:o},xform:Or})}else{if(!("phone"in e))throw new Js("You must provide either an email or phone number and a password");{const{phone:t,password:a,options:i}=e;n=await Dr(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:t,password:a,data:null!==(s=null==i?void 0:i.data)&&void 0!==s?s:{},channel:null!==(r=null==i?void 0:i.channel)&&void 0!==r?r:"sms",gotrue_meta_security:{captcha_token:null==i?void 0:i.captchaToken}},xform:Or})}}const{data:a,error:i}=n;if(i||!a)return{data:{user:null,session:null},error:i};const o=a.session,l=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",o)),{data:{user:l,session:o},error:null}}catch(n){if(Gs(n))return{data:{user:null,session:null},error:n};throw n}}async signInWithPassword(e){try{let t;if("email"in e){const{email:s,password:r,options:n}=e;t=await Dr(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:s,password:r,gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken}},xform:$r})}else{if(!("phone"in e))throw new Js("You must provide either an email or phone number and a password");{const{phone:s,password:r,options:n}=e;t=await Dr(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:s,password:r,gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken}},xform:$r})}}const{data:s,error:r}=t;return r?{data:{user:null,session:null},error:r}:s&&s.session&&s.user?(s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",s.session)),{data:Object.assign({user:s.user,session:s.session},s.weak_password?{weakPassword:s.weak_password}:null),error:r}):{data:{user:null,session:null},error:new Ys}}catch(t){if(Gs(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,s,r,n;return await this._handleProviderSignIn(e.provider,{redirectTo:null===(t=e.options)||void 0===t?void 0:t.redirectTo,scopes:null===(s=e.options)||void 0===s?void 0:s.scopes,queryParams:null===(r=e.options)||void 0===r?void 0:r.queryParams,skipBrowserRedirect:null===(n=e.options)||void 0===n?void 0:n.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:t}=e;if("solana"===t)return await this.signInWithSolana(e);throw new Error(`@supabase/auth-js: Unsupported chain "${t}"`)}async signInWithSolana(e){var t,s,r,n,a,i,o,l,c,d,u,h;let m,p;if("message"in e)m=e.message,p=e.signature;else{const{chain:u,wallet:h,statement:g,options:f}=e;let x;if(mr())if("object"==typeof h)x=h;else{const e=window;if(!("solana"in e)||"object"!=typeof e.solana||!("signIn"in e.solana&&"function"==typeof e.solana.signIn||"signMessage"in e.solana&&"function"==typeof e.solana.signMessage))throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.");x=e.solana}else{if("object"!=typeof h||!(null==f?void 0:f.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");x=h}const y=new URL(null!==(t=null==f?void 0:f.url)&&void 0!==t?t:window.location.href);if("signIn"in x&&x.signIn){const e=await x.signIn(Object.assign(Object.assign(Object.assign({issuedAt:(new Date).toISOString()},null==f?void 0:f.signInWithSolana),{version:"1",domain:y.host,uri:y.href}),g?{statement:g}:null));let t;if(Array.isArray(e)&&e[0]&&"object"==typeof e[0])t=e[0];else{if(!(e&&"object"==typeof e&&"signedMessage"in e&&"signature"in e))throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");t=e}if(!("signedMessage"in t&&"signature"in t&&("string"==typeof t.signedMessage||t.signedMessage instanceof Uint8Array)&&t.signature instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields");m="string"==typeof t.signedMessage?t.signedMessage:(new TextDecoder).decode(t.signedMessage),p=t.signature}else{if(!("signMessage"in x&&"function"==typeof x.signMessage&&"publicKey"in x&&"object"==typeof x&&x.publicKey&&"toBase58"in x.publicKey&&"function"==typeof x.publicKey.toBase58))throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");m=[`${y.host} wants you to sign in with your Solana account:`,x.publicKey.toBase58(),...g?["",g,""]:[""],"Version: 1",`URI: ${y.href}`,`Issued At: ${null!==(r=null===(s=null==f?void 0:f.signInWithSolana)||void 0===s?void 0:s.issuedAt)&&void 0!==r?r:(new Date).toISOString()}`,...(null===(n=null==f?void 0:f.signInWithSolana)||void 0===n?void 0:n.notBefore)?[`Not Before: ${f.signInWithSolana.notBefore}`]:[],...(null===(a=null==f?void 0:f.signInWithSolana)||void 0===a?void 0:a.expirationTime)?[`Expiration Time: ${f.signInWithSolana.expirationTime}`]:[],...(null===(i=null==f?void 0:f.signInWithSolana)||void 0===i?void 0:i.chainId)?[`Chain ID: ${f.signInWithSolana.chainId}`]:[],...(null===(o=null==f?void 0:f.signInWithSolana)||void 0===o?void 0:o.nonce)?[`Nonce: ${f.signInWithSolana.nonce}`]:[],...(null===(l=null==f?void 0:f.signInWithSolana)||void 0===l?void 0:l.requestId)?[`Request ID: ${f.signInWithSolana.requestId}`]:[],...(null===(d=null===(c=null==f?void 0:f.signInWithSolana)||void 0===c?void 0:c.resources)||void 0===d?void 0:d.length)?["Resources",...f.signInWithSolana.resources.map(e=>`- ${e}`)]:[]].join("\n");const e=await x.signMessage((new TextEncoder).encode(m),"utf8");if(!(e&&e instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");p=e}}try{const{data:t,error:s}=await Dr(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:m,signature:hr(p)},(null===(u=e.options)||void 0===u?void 0:u.captchaToken)?{gotrue_meta_security:{captcha_token:null===(h=e.options)||void 0===h?void 0:h.captchaToken}}:null),xform:Or});if(s)throw s;return t&&t.session&&t.user?(t.session&&(await this._saveSession(t.session),await this._notifyAllSubscribers("SIGNED_IN",t.session)),{data:Object.assign({},t),error:s}):{data:{user:null,session:null},error:new Ys}}catch(g){if(Gs(g))return{data:{user:null,session:null},error:g};throw g}}async _exchangeCodeForSession(e){const t=await yr(this.storage,`${this.storageKey}-code-verifier`),[s,r]=(null!=t?t:"").split("/");try{const{data:t,error:n}=await Dr(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:s},xform:Or});if(await br(this.storage,`${this.storageKey}-code-verifier`),n)throw n;return t&&t.session&&t.user?(t.session&&(await this._saveSession(t.session),await this._notifyAllSubscribers("SIGNED_IN",t.session)),{data:Object.assign(Object.assign({},t),{redirectType:null!=r?r:null}),error:n}):{data:{user:null,session:null,redirectType:null},error:new Ys}}catch(n){if(Gs(n))return{data:{user:null,session:null,redirectType:null},error:n};throw n}}async signInWithIdToken(e){try{const{options:t,provider:s,token:r,access_token:n,nonce:a}=e,i=await Dr(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:s,id_token:r,access_token:n,nonce:a,gotrue_meta_security:{captcha_token:null==t?void 0:t.captchaToken}},xform:Or}),{data:o,error:l}=i;return l?{data:{user:null,session:null},error:l}:o&&o.session&&o.user?(o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",o.session)),{data:o,error:l}):{data:{user:null,session:null},error:new Ys}}catch(t){if(Gs(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,s,r,n,a;try{if("email"in e){const{email:r,options:n}=e;let a=null,i=null;"pkce"===this.flowType&&([a,i]=await Nr(this.storage,this.storageKey));const{error:o}=await Dr(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:r,data:null!==(t=null==n?void 0:n.data)&&void 0!==t?t:{},create_user:null===(s=null==n?void 0:n.shouldCreateUser)||void 0===s||s,gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken},code_challenge:a,code_challenge_method:i},redirectTo:null==n?void 0:n.emailRedirectTo});return{data:{user:null,session:null},error:o}}if("phone"in e){const{phone:t,options:s}=e,{data:i,error:o}=await Dr(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:t,data:null!==(r=null==s?void 0:s.data)&&void 0!==r?r:{},create_user:null===(n=null==s?void 0:s.shouldCreateUser)||void 0===n||n,gotrue_meta_security:{captcha_token:null==s?void 0:s.captchaToken},channel:null!==(a=null==s?void 0:s.channel)&&void 0!==a?a:"sms"}});return{data:{user:null,session:null,messageId:null==i?void 0:i.message_id},error:o}}throw new Js("You must provide either an email or phone number.")}catch(i){if(Gs(i))return{data:{user:null,session:null},error:i};throw i}}async verifyOtp(e){var t,s;try{let r,n;"options"in e&&(r=null===(t=e.options)||void 0===t?void 0:t.redirectTo,n=null===(s=e.options)||void 0===s?void 0:s.captchaToken);const{data:a,error:i}=await Dr(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:n}}),redirectTo:r,xform:Or});if(i)throw i;if(!a)throw new Error("An error occurred on token verification.");const o=a.session,l=a.user;return(null==o?void 0:o.access_token)&&(await this._saveSession(o),await this._notifyAllSubscribers("recovery"==e.type?"PASSWORD_RECOVERY":"SIGNED_IN",o)),{data:{user:l,session:o},error:null}}catch(r){if(Gs(r))return{data:{user:null,session:null},error:r};throw r}}async signInWithSSO(e){var t,s,r;try{let n=null,a=null;return"pkce"===this.flowType&&([n,a]=await Nr(this.storage,this.storageKey)),await Dr(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:null!==(s=null===(t=e.options)||void 0===t?void 0:t.redirectTo)&&void 0!==s?s:void 0}),(null===(r=null==e?void 0:e.options)||void 0===r?void 0:r.captchaToken)?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:n,code_challenge_method:a}),headers:this.headers,xform:Ur})}catch(n){if(Gs(n))return{data:null,error:n};throw n}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:s}=e;if(s)throw s;if(!t)throw new Hs;const{error:r}=await Dr(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:r}})}catch(e){if(Gs(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:s,type:r,options:n}=e,{error:a}=await Dr(this.fetch,"POST",t,{headers:this.headers,body:{email:s,type:r,gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken}},redirectTo:null==n?void 0:n.emailRedirectTo});return{data:{user:null,session:null},error:a}}if("phone"in e){const{phone:s,type:r,options:n}=e,{data:a,error:i}=await Dr(this.fetch,"POST",t,{headers:this.headers,body:{phone:s,type:r,gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken}}});return{data:{user:null,session:null,messageId:null==a?void 0:a.message_id},error:i}}throw new Js("You must provide either an email or phone number and a type")}catch(t){if(Gs(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){await this.initializePromise;return await this._acquireLock(-1,async()=>this._useSession(async e=>e))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const e=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),s=(async()=>(await e,await t()))();return this.pendingInLock.push((async()=>{try{await s}catch(e){}})()),s}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const e=t();for(this.pendingInLock.push((async()=>{try{await e}catch(t){}})()),await e;this.pendingInLock.length;){const e=[...this.pendingInLock];await Promise.all(e),this.pendingInLock.splice(0,e.length)}return await e}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",(new Error).stack);try{let e=null;const t=await yr(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),null!==t&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const s=!!e.expires_at&&1e3*e.expires_at-Date.now()<Ls;if(this._debug("#__loadSession()",`session has${s?"":" not"} expired`,"expires_at",e.expires_at),!s){if(this.userStorage){const t=await yr(this.userStorage,this.storageKey+"-user");(null==t?void 0:t.user)?e.user=t.user:e.user=Tr()}if(this.storage.isServer&&e.user){let t=this.suppressGetSessionWarning;e=new Proxy(e,{get:(e,s,r)=>(t||"user"!==s||(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),t=!0,this.suppressGetSessionWarning=!0),Reflect.get(e,s,r))})}return{data:{session:e},error:null}}const{session:r,error:n}=await this._callRefreshToken(e.refresh_token);return n?{data:{session:null},error:n}:{data:{session:r},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){if(e)return await this._getUser(e);await this.initializePromise;return await this._acquireLock(-1,async()=>await this._getUser())}async _getUser(e){try{return e?await Dr(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:Rr}):await this._useSession(async e=>{var t,s,r;const{data:n,error:a}=e;if(a)throw a;return(null===(t=n.session)||void 0===t?void 0:t.access_token)||this.hasCustomAuthorizationHeader?await Dr(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:null!==(r=null===(s=n.session)||void 0===s?void 0:s.access_token)&&void 0!==r?r:void 0,xform:Rr}):{data:{user:null},error:new Hs}})}catch(t){if(Gs(t))return function(e){return Gs(e)&&"AuthSessionMissingError"===e.name}(t)&&(await this._removeSession(),await br(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:t};throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async s=>{const{data:r,error:n}=s;if(n)throw n;if(!r.session)throw new Hs;const a=r.session;let i=null,o=null;"pkce"===this.flowType&&null!=e.email&&([i,o]=await Nr(this.storage,this.storageKey));const{data:l,error:c}=await Dr(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:null==t?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:i,code_challenge_method:o}),jwt:a.access_token,xform:Rr});if(c)throw c;return a.user=l.user,await this._saveSession(a),await this._notifyAllSubscribers("USER_UPDATED",a),{data:{user:a.user},error:null}})}catch(s){if(Gs(s))return{data:{user:null},error:s};throw s}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new Hs;const t=Date.now()/1e3;let s=t,r=!0,n=null;const{payload:a}=wr(e.access_token);if(a.exp&&(s=a.exp,r=s<=t),r){const{session:t,error:s}=await this._callRefreshToken(e.refresh_token);if(s)return{data:{user:null,session:null},error:s};if(!t)return{data:{user:null,session:null},error:null};n=t}else{const{data:r,error:a}=await this._getUser(e.access_token);if(a)throw a;n={access_token:e.access_token,refresh_token:e.refresh_token,user:r.user,token_type:"bearer",expires_in:s-t,expires_at:s},await this._saveSession(n),await this._notifyAllSubscribers("SIGNED_IN",n)}return{data:{user:n.user,session:n},error:null}}catch(t){if(Gs(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var s;if(!e){const{data:r,error:n}=t;if(n)throw n;e=null!==(s=r.session)&&void 0!==s?s:void 0}if(!(null==e?void 0:e.refresh_token))throw new Hs;const{session:r,error:n}=await this._callRefreshToken(e.refresh_token);return n?{data:{user:null,session:null},error:n}:r?{data:{user:r.user,session:r},error:null}:{data:{user:null,session:null},error:null}})}catch(t){if(Gs(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e,t){try{if(!mr())throw new Xs("No browser detected.");if(e.error||e.error_description||e.error_code)throw new Xs(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if("pkce"===this.flowType)throw new Zs("Not a valid PKCE flow url.");break;case"pkce":if("implicit"===this.flowType)throw new Xs("Not a valid implicit grant flow url.")}if("pkce"===t){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new Zs("No code detected.");const{data:t,error:s}=await this._exchangeCodeForSession(e.code);if(s)throw s;const r=new URL(window.location.href);return r.searchParams.delete("code"),window.history.replaceState(window.history.state,"",r.toString()),{data:{session:t.session,redirectType:null},error:null}}const{provider_token:s,provider_refresh_token:r,access_token:n,refresh_token:a,expires_in:i,expires_at:o,token_type:l}=e;if(!(n&&i&&a&&l))throw new Xs("No session defined in URL");const c=Math.round(Date.now()/1e3),d=parseInt(i);let u=c+d;o&&(u=parseInt(o));const h=u-c;1e3*h<=Us&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${h}s, should have been closer to ${d}s`);const m=u-d;c-m>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",m,u,c):c-m<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",m,u,c);const{data:p,error:g}=await this._getUser(n);if(g)throw g;const f={provider_token:s,provider_refresh_token:r,access_token:n,expires_in:d,expires_at:u,refresh_token:a,token_type:l,user:p.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:f,redirectType:e.type},error:null}}catch(s){if(Gs(s))return{data:{session:null,redirectType:null},error:s};throw s}}_isImplicitGrantCallback(e){return Boolean(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await yr(this.storage,`${this.storageKey}-code-verifier`);return!(!e.code||!t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var s;const{data:r,error:n}=t;if(n)return{error:n};const a=null===(s=r.session)||void 0===s?void 0:s.access_token;if(a){const{error:t}=await this.admin.signOut(a,e);if(t&&(!function(e){return Gs(e)&&"AuthApiError"===e.name}(t)||404!==t.status&&401!==t.status&&403!==t.status))return{error:t}}return"others"!==e&&(await this._removeSession(),await br(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){const t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){const t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}),s={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,s),(async()=>{await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})})(),{data:{subscription:s}}}async _emitInitialSession(e){return await this._useSession(async t=>{var s,r;try{const{data:{session:r},error:n}=t;if(n)throw n;await(null===(s=this.stateChangeEmitters.get(e))||void 0===s?void 0:s.callback("INITIAL_SESSION",r)),this._debug("INITIAL_SESSION","callback id",e,"session",r)}catch(n){await(null===(r=this.stateChangeEmitters.get(e))||void 0===r?void 0:r.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",n),console.error(n)}})}async resetPasswordForEmail(e,t={}){let s=null,r=null;"pkce"===this.flowType&&([s,r]=await Nr(this.storage,this.storageKey,!0));try{return await Dr(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:s,code_challenge_method:r,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(n){if(Gs(n))return{data:null,error:n};throw n}}async getUserIdentities(){var e;try{const{data:t,error:s}=await this.getUser();if(s)throw s;return{data:{identities:null!==(e=t.user.identities)&&void 0!==e?e:[]},error:null}}catch(t){if(Gs(t))return{data:null,error:t};throw t}}async linkIdentity(e){var t;try{const{data:s,error:r}=await this._useSession(async t=>{var s,r,n,a,i;const{data:o,error:l}=t;if(l)throw l;const c=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:null===(s=e.options)||void 0===s?void 0:s.redirectTo,scopes:null===(r=e.options)||void 0===r?void 0:r.scopes,queryParams:null===(n=e.options)||void 0===n?void 0:n.queryParams,skipBrowserRedirect:!0});return await Dr(this.fetch,"GET",c,{headers:this.headers,jwt:null!==(i=null===(a=o.session)||void 0===a?void 0:a.access_token)&&void 0!==i?i:void 0})});if(r)throw r;return mr()&&!(null===(t=e.options)||void 0===t?void 0:t.skipBrowserRedirect)&&window.location.assign(null==s?void 0:s.url),{data:{provider:e.provider,url:null==s?void 0:s.url},error:null}}catch(s){if(Gs(s))return{data:{provider:e.provider,url:null},error:s};throw s}}async unlinkIdentity(e){try{return await this._useSession(async t=>{var s,r;const{data:n,error:a}=t;if(a)throw a;return await Dr(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:null!==(r=null===(s=n.session)||void 0===s?void 0:s.access_token)&&void 0!==r?r:void 0})})}catch(t){if(Gs(t))return{data:null,error:t};throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const n=Date.now();return await(s=async s=>(s>0&&await async function(e){return await new Promise(t=>{setTimeout(()=>t(null),e)})}(200*Math.pow(2,s-1)),this._debug(t,"refreshing attempt",s),await Dr(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:Or})),r=(e,t)=>{const s=200*Math.pow(2,e);return t&&er(t)&&Date.now()+s-n<Us},new Promise((e,t)=>{(async()=>{for(let a=0;a<1/0;a++)try{const t=await s(a);if(!r(a,null,t))return void e(t)}catch(n){if(!r(a,n))return void t(n)}})()}))}catch(n){if(this._debug(t,"error",n),Gs(n))return{data:{session:null,user:null},error:n};throw n}finally{this._debug(t,"end")}var s,r}_isValidSession(e){return"object"==typeof e&&null!==e&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const s=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",s),mr()&&!t.skipBrowserRedirect&&window.location.assign(s),{data:{provider:e,url:s},error:null}}async _recoverAndRefresh(){var e,t;const s="#_recoverAndRefresh()";this._debug(s,"begin");try{const n=await yr(this.storage,this.storageKey);if(n&&this.userStorage){let t=await yr(this.userStorage,this.storageKey+"-user");this.storage.isServer||!Object.is(this.storage,this.userStorage)||t||(t={user:n.user},await xr(this.userStorage,this.storageKey+"-user",t)),n.user=null!==(e=null==t?void 0:t.user)&&void 0!==e?e:Tr()}else if(n&&!n.user&&!n.user){const e=await yr(this.storage,this.storageKey+"-user");e&&(null==e?void 0:e.user)?(n.user=e.user,await br(this.storage,this.storageKey+"-user"),await xr(this.storage,this.storageKey,n)):n.user=Tr()}if(this._debug(s,"session from storage",n),!this._isValidSession(n))return this._debug(s,"session is not valid"),void(null!==n&&await this._removeSession());const a=1e3*(null!==(t=n.expires_at)&&void 0!==t?t:1/0)-Date.now()<Ls;if(this._debug(s,`session has${a?"":" not"} expired with margin of 90000s`),a){if(this.autoRefreshToken&&n.refresh_token){const{error:e}=await this._callRefreshToken(n.refresh_token);e&&(console.error(e),er(e)||(this._debug(s,"refresh failed with a non-retryable error, removing the session",e),await this._removeSession()))}}else if(n.user&&!0===n.user.__isUserNotAvailableProxy)try{const{data:e,error:t}=await this._getUser(n.access_token);!t&&(null==e?void 0:e.user)?(n.user=e.user,await this._saveSession(n),await this._notifyAllSubscribers("SIGNED_IN",n)):this._debug(s,"could not get user data, skipping SIGNED_IN notification")}catch(r){console.error("Error getting user data:",r),this._debug(s,"error getting user data, skipping SIGNED_IN notification",r)}else await this._notifyAllSubscribers("SIGNED_IN",n)}catch(n){return this._debug(s,"error",n),void console.error(n)}finally{this._debug(s,"end")}}async _callRefreshToken(e){var t,s;if(!e)throw new Hs;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const r=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(r,"begin");try{this.refreshingDeferred=new vr;const{data:t,error:s}=await this._refreshAccessToken(e);if(s)throw s;if(!t.session)throw new Hs;await this._saveSession(t.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",t.session);const r={session:t.session,error:null};return this.refreshingDeferred.resolve(r),r}catch(n){if(this._debug(r,"error",n),Gs(n)){const e={session:null,error:n};return er(n)||await this._removeSession(),null===(t=this.refreshingDeferred)||void 0===t||t.resolve(e),e}throw null===(s=this.refreshingDeferred)||void 0===s||s.reject(n),n}finally{this.refreshingDeferred=null,this._debug(r,"end")}}async _notifyAllSubscribers(e,t,s=!0){const r=`#_notifyAllSubscribers(${e})`;this._debug(r,"begin",t,`broadcast = ${s}`);try{this.broadcastChannel&&s&&this.broadcastChannel.postMessage({event:e,session:t});const r=[],n=Array.from(this.stateChangeEmitters.values()).map(async s=>{try{await s.callback(e,t)}catch(n){r.push(n)}});if(await Promise.all(n),r.length>0){for(let e=0;e<r.length;e+=1)console.error(r[e]);throw r[0]}}finally{this._debug(r,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0;const t=Object.assign({},e),s=t.user&&!0===t.user.__isUserNotAvailableProxy;if(this.userStorage){!s&&t.user&&await xr(this.userStorage,this.storageKey+"-user",{user:t.user});const e=Object.assign({},t);delete e.user;const r=Cr(e);await xr(this.storage,this.storageKey,r)}else{const e=Cr(t);await xr(this.storage,this.storageKey,e)}}async _removeSession(){this._debug("#_removeSession()"),await br(this.storage,this.storageKey),await br(this.storage,this.storageKey+"-code-verifier"),await br(this.storage,this.storageKey+"-user"),this.userStorage&&await br(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&mr()&&(null===window||void 0===window?void 0:window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),Us);this.autoRefreshTicker=e,e&&"object"==typeof e&&"function"==typeof e.unref?e.unref():"undefined"!=typeof Deno&&"function"==typeof Deno.unrefTimer&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const t=Date.now();try{return await this._useSession(async e=>{const{data:{session:s}}=e;if(!s||!s.refresh_token||!s.expires_at)return void this._debug("#_autoRefreshTokenTick()","no session");const r=Math.floor((1e3*s.expires_at-t)/Us);this._debug("#_autoRefreshTokenTick()",`access token expires in ${r} ticks, a tick lasts 30000ms, refresh threshold is 3 ticks`),r<=3&&await this._callRefreshToken(s.refresh_token)})}catch(e){console.error("Auto refresh tick failed with error. This is likely a transient error.",e)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(!(e.isAcquireTimeout||e instanceof Gr))throw e;this._debug("auto refresh token tick lock not available")}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!mr()||!(null===window||void 0===window?void 0:window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),null===window||void 0===window||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),"visible"===document.visibilityState?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{"visible"===document.visibilityState?await this._recoverAndRefresh():this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting")}))):"hidden"===document.visibilityState&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,s){const r=[`provider=${encodeURIComponent(t)}`];if((null==s?void 0:s.redirectTo)&&r.push(`redirect_to=${encodeURIComponent(s.redirectTo)}`),(null==s?void 0:s.scopes)&&r.push(`scopes=${encodeURIComponent(s.scopes)}`),"pkce"===this.flowType){const[e,t]=await Nr(this.storage,this.storageKey),s=new URLSearchParams({code_challenge:`${encodeURIComponent(e)}`,code_challenge_method:`${encodeURIComponent(t)}`});r.push(s.toString())}if(null==s?void 0:s.queryParams){const e=new URLSearchParams(s.queryParams);r.push(e.toString())}return(null==s?void 0:s.skipBrowserRedirect)&&r.push(`skip_http_redirect=${s.skipBrowserRedirect}`),`${e}?${r.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var s;const{data:r,error:n}=t;return n?{data:null,error:n}:await Dr(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:null===(s=null==r?void 0:r.session)||void 0===s?void 0:s.access_token})})}catch(t){if(Gs(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession(async t=>{var s,r;const{data:n,error:a}=t;if(a)return{data:null,error:a};const i=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},"phone"===e.factorType?{phone:e.phone}:{issuer:e.issuer}),{data:o,error:l}=await Dr(this.fetch,"POST",`${this.url}/factors`,{body:i,headers:this.headers,jwt:null===(s=null==n?void 0:n.session)||void 0===s?void 0:s.access_token});return l?{data:null,error:l}:("totp"===e.factorType&&(null===(r=null==o?void 0:o.totp)||void 0===r?void 0:r.qr_code)&&(o.totp.qr_code=`data:image/svg+xml;utf-8,${o.totp.qr_code}`),{data:o,error:null})})}catch(t){if(Gs(t))return{data:null,error:t};throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var s;const{data:r,error:n}=t;if(n)return{data:null,error:n};const{data:a,error:i}=await Dr(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:null===(s=null==r?void 0:r.session)||void 0===s?void 0:s.access_token});return i?{data:null,error:i}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+a.expires_in},a)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",a),{data:a,error:i})})}catch(t){if(Gs(t))return{data:null,error:t};throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var s;const{data:r,error:n}=t;return n?{data:null,error:n}:await Dr(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:null===(s=null==r?void 0:r.session)||void 0===s?void 0:s.access_token})})}catch(t){if(Gs(t))return{data:null,error:t};throw t}})}async _challengeAndVerify(e){const{data:t,error:s}=await this._challenge({factorId:e.factorId});return s?{data:null,error:s}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){const{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};const s=(null==e?void 0:e.factors)||[],r=s.filter(e=>"totp"===e.factor_type&&"verified"===e.status),n=s.filter(e=>"phone"===e.factor_type&&"verified"===e.status);return{data:{all:s,totp:r,phone:n},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var t,s;const{data:{session:r},error:n}=e;if(n)return{data:null,error:n};if(!r)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:a}=wr(r.access_token);let i=null;a.aal&&(i=a.aal);let o=i;(null!==(s=null===(t=r.user.factors)||void 0===t?void 0:t.filter(e=>"verified"===e.status))&&void 0!==s?s:[]).length>0&&(o="aal2");return{data:{currentLevel:i,nextLevel:o,currentAuthenticationMethods:a.amr||[]},error:null}}))}async fetchJwk(e,t={keys:[]}){let s=t.keys.find(t=>t.kid===e);if(s)return s;const r=Date.now();if(s=this.jwks.keys.find(t=>t.kid===e),s&&this.jwks_cached_at+6e5>r)return s;const{data:n,error:a}=await Dr(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(a)throw a;return n.keys&&0!==n.keys.length?(this.jwks=n,this.jwks_cached_at=r,s=n.keys.find(t=>t.kid===e),s||null):null}async getClaims(e,t={}){try{let s=e;if(!s){const{data:e,error:t}=await this.getSession();if(t||!e.session)return{data:null,error:t};s=e.session.access_token}const{header:r,payload:n,signature:a,raw:{header:i,payload:o}}=wr(s);(null==t?void 0:t.allowExpired)||function(e){if(!e)throw new Error("Missing exp claim");if(e<=Math.floor(Date.now()/1e3))throw new Error("JWT has expired")}(n.exp);const l=r.alg&&!r.alg.startsWith("HS")&&r.kid&&"crypto"in globalThis&&"subtle"in globalThis.crypto?await this.fetchJwk(r.kid,(null==t?void 0:t.keys)?{keys:t.keys}:null==t?void 0:t.jwks):null;if(!l){const{error:e}=await this.getUser(s);if(e)throw e;return{data:{claims:n,header:r,signature:a},error:null}}const c=function(e){switch(e){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}(r.alg),d=await crypto.subtle.importKey("jwk",l,c,!0,["verify"]);if(!(await crypto.subtle.verify(c,d,a,ur(`${i}.${o}`))))throw new sr("Invalid JWT signature");return{data:{claims:n,header:r,signature:a},error:null}}catch(s){if(Gs(s))return{data:null,error:s};throw s}}}Jr.nextInstanceID=0;const Xr=Jr;class Zr extends Xr{constructor(e){super(e)}}var Qr=function(e,t,s,r){return new(s||(s=Promise))(function(n,a){function i(e){try{l(r.next(e))}catch(t){a(t)}}function o(e){try{l(r.throw(e))}catch(t){a(t)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s(function(e){e(t)})).then(i,o)}l((r=r.apply(e,t||[])).next())})};class en{constructor(e,t,s){var r,n,a;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const i=(o=e).endsWith("/")?o:o+"/";var o;const l=new URL(i);this.realtimeUrl=new URL("realtime/v1",l),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",l),this.storageUrl=new URL("storage/v1",l),this.functionsUrl=new URL("functions/v1",l);const c=`sb-${l.hostname.split(".")[0]}-auth-token`,d=function(e,t){var s,r;const{db:n,auth:a,realtime:i,global:o}=e,{db:l,auth:c,realtime:d,global:u}=t,h={db:Object.assign(Object.assign({},l),n),auth:Object.assign(Object.assign({},c),a),realtime:Object.assign(Object.assign({},d),i),storage:{},global:Object.assign(Object.assign(Object.assign({},u),o),{headers:Object.assign(Object.assign({},null!==(s=null==u?void 0:u.headers)&&void 0!==s?s:{}),null!==(r=null==o?void 0:o.headers)&&void 0!==r?r:{})}),accessToken:()=>$s(this,void 0,void 0,function*(){return""})};return e.accessToken?h.accessToken=e.accessToken:delete h.accessToken,h}(null!=s?s:{},{db:Ps,realtime:Is,auth:Object.assign(Object.assign({},As),{storageKey:c}),global:Cs});this.storageKey=null!==(r=d.auth.storageKey)&&void 0!==r?r:"",this.headers=null!==(n=d.global.headers)&&void 0!==n?n:{},d.accessToken?(this.accessToken=d.accessToken,this.auth=new Proxy({},{get:(e,t)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(t)} is not possible`)}})):this.auth=this._initSupabaseAuthClient(null!==(a=d.auth)&&void 0!==a?a:{},this.headers,d.global.fetch),this.fetch=Os(t,this._getAccessToken.bind(this),d.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},d.realtime)),this.rest=new dt(new URL("rest/v1",l).href,{headers:this.headers,schema:d.db.schema,fetch:this.fetch}),this.storage=new Es(this.storageUrl.href,this.headers,this.fetch,null==s?void 0:s.storage),d.accessToken||this._listenForAuthEvents()}get functions(){return new Se(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},s={}){return this.rest.rpc(e,t,s)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return Qr(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:s}=yield this.auth.getSession();return null!==(t=null===(e=s.session)||void 0===e?void 0:e.access_token)&&void 0!==t?t:this.supabaseKey})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:r,storageKey:n,flowType:a,lock:i,debug:o},l,c){const d={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new Zr({url:this.authUrl.href,headers:Object.assign(Object.assign({},d),l),storageKey:n,autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:r,flowType:a,lock:i,debug:o,fetch:c,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(e){return new rs(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},null==e?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((e,t)=>{this._handleTokenChanged(e,"CLIENT",null==t?void 0:t.access_token)})}_handleTokenChanged(e,t,s){"TOKEN_REFRESHED"!==e&&"SIGNED_IN"!==e||this.changedAccessToken===s?"SIGNED_OUT"===e&&(this.realtime.setAuth(),"STORAGE"==t&&this.auth.signOut(),this.changedAccessToken=void 0):this.changedAccessToken=s}}(function(){if("undefined"!=typeof window)return!1;if("undefined"==typeof process)return!1;const e=process.version;if(null==e)return!1;const t=e.match(/^v(\d+)\./);return!!t&&parseInt(t[1],10)<=18})()&&console.warn("⚠️  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");"undefined"!=typeof window&&console.error("Supabase is misconfigured: missing URL or anon key.");const tn="undefined"!=typeof window?window.location.origin.replace("http:","https:"):"",sn=(rn="",nn="",an={auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,storage:"undefined"!=typeof window?window.localStorage:void 0,storageKey:"seatyr-auth-token",redirectTo:`${tn}/auth/callback`,onAuthStateChange:(e,t)=>{if(("SIGNED_IN"===e||"TOKEN_REFRESHED"===e)&&"undefined"!=typeof window){const e=new URL(window.location.href);e.searchParams.delete("code"),e.searchParams.delete("error"),e.searchParams.delete("error_description"),window.history.replaceState({},"",e.toString())}}}},new en(rn,nn,an));var rn,nn,an;if("undefined"!=typeof window){const e="not set";console.log(`Supabase Configuration:\n    URL: not set\n    Key: ${e}\n    Configured: \n  `)}function on(e,t){if(!e)return!1;if(["active","trialing","past_due"].includes(e.status))return!0;if(e.current_period_end){if((s=e.current_period_end,isNaN(Number(s))||10!==s.length?new Date(e.current_period_end):new Date(1e3*Number(e.current_period_end)))>new Date)return!0}var s;return!1}function ln(e){return on(e)?Number.MAX_SAFE_INTEGER:80}function cn(e){return on(e)?50:5}async function dn(e,t,s){if(!e)return!1;try{console.log("Saving most recent state for user:",e);const{data:s,error:r}=await sn.auth.getSession();if(r)throw console.error("Session error when saving most recent state:",r),new Error("Your session has expired. Please log in again.");if(!s.session)throw console.log("No active session, skipping most recent state save"),new Error("No active session. Please log in to save your state.");const n={version:"1.0",timestamp:(new Date).toISOString(),guests:t.guests,tables:t.tables.map(e=>({id:e.id,seats:e.seats,name:e.name})),constraints:t.constraints,adjacents:t.adjacents,assignments:t.assignments,seatingPlans:t.seatingPlans,currentPlanIndex:t.currentPlanIndex,userSetTables:t.userSetTables},{data:a,error:i}=await sn.from("recent_session_states").select("user_id").eq("user_id",e).maybeSingle();if(i){if(401===i.status)throw console.error("Unauthorized when checking for existing recent state (session expired)"),new Error("Your session has expired. Please log in again.");throw console.error("Error checking for existing recent state:",i),new Error("Failed to check for existing state: "+i.message)}const{error:o}=await sn.from("recent_session_states").upsert({user_id:e,data:n},{onConflict:"user_id"});if(o){if(401===o.status)throw console.error("Unauthorized when saving recent state (session expired)"),new Error("Your session has expired. Please log in again.");throw console.error("Error saving most recent state:",o),new Error("Failed to save most recent state: "+o.message)}return console.log("Most recent state saved successfully for user:",e),!0}catch(r){throw console.error("Error saving most recent state:",r),r}}async function un(e){if(!e)return null;try{console.log("Retrieving most recent state for user:",e);const{data:t,error:s}=await sn.auth.getSession();if(s)throw console.error("Session error when retrieving most recent state:",s),new Error("Your session has expired. Please log in again.");if(!t.session)throw console.log("No active session, skipping most recent state fetch"),new Error("No active session. Please log in to access your recent state.");const{data:r,error:n}=await sn.from("recent_session_states").select("data, updated_at").eq("user_id",e).maybeSingle();if(n){if(401===n.status)throw console.error("Unauthorized when retrieving most recent state (session expired)"),new Error("Session expired. Please log in again to access your recent state.");throw console.error("Error retrieving most recent state:",n),new Error("Failed to retrieve your most recent state: "+n.message)}if(!r||!r.data)return console.log("No most recent state found for user:",e),null;const a=["guests","tables","constraints","adjacents","assignments"].filter(e=>!r.data[e]);if(a.length>0)throw console.error("Retrieved state is missing fields:",a),new Error("Your recent state data appears to be incomplete or corrupted.");return console.log("Successfully retrieved most recent state with timestamp:",r.data.timestamp),r.data}catch(t){throw console.error("Error retrieving most recent state:",t),t}}const hn=({userId:e,isPremium:t,recentTimestamp:r,onClose:n,onRestoreRecent:a,onKeepCurrent:o,onRetryFetch:l,error:c,loading:d=!1})=>{const u=i(),[h,m]=s.useState(!1),[p,g]=s.useState(null),f=r?new Date(r).toLocaleString():"recent session";s.useEffect(()=>{console.log("MostRecentChoiceModal mounted",{userId:e,isPremium:t,recentTimestamp:r,error:c,loading:d})},[]);return j.jsx("div",{className:"fixed inset-0 bg-black/30 z-50 flex items-center justify-center p-4",children:j.jsxs("div",{className:"bg-white w-full max-w-md p-6 rounded-xl shadow-xl relative",children:[j.jsx("button",{className:"absolute top-3 right-3 danstyle1c-btn",onClick:n,disabled:d||h,"aria-label":"Close dialog",children:j.jsx(ge,{className:"w-5 h-5"})}),j.jsx("h2",{className:"text-lg font-semibold text-[#586D78] mb-4",children:"Load Recent Session?"}),r&&j.jsxs("p",{className:"text-xs text-gray-500 mb-4",children:["Saved: ",f]}),d&&j.jsxs("div",{className:"mb-4 bg-indigo-50 border border-indigo-200 rounded p-3 text-indigo-700 text-sm flex items-center",children:[j.jsx(ie,{className:"w-4 h-4 mr-2 animate-spin"}),j.jsx("span",{children:"Loading your most recent session data..."})]}),(c||p)&&j.jsx("div",{className:"mb-4 bg-red-50 border border-red-200 rounded p-3 text-red-700 text-sm",children:j.jsxs("div",{className:"flex items-start",children:[j.jsx(E,{className:"w-4 h-4 mr-2 flex-shrink-0 mt-1"}),j.jsxs("div",{children:[j.jsx("p",{children:c||p}),l&&j.jsxs("button",{className:"danstyle1c-btn mt-2 text-sm",onClick:()=>{console.log("Retrying fetch of recent state"),g(null),l&&l()},disabled:h||d,children:[h||d?j.jsx(ie,{className:"w-4 h-4 mr-2 animate-spin"}):j.jsx(ie,{className:"w-4 h-4 mr-2"}),"Try Again"]})]})]})}),j.jsx("p",{className:"text-sm text-gray-700 mb-6",children:c||p?"Please choose an option to continue:":"We found data from your last session. What would you like to do?"}),j.jsxs("div",{className:"flex flex-col gap-3",children:[j.jsx("button",{className:"danstyle1c-btn",onClick:async()=>{try{console.log("Keeping current state"),m(!0),g(null),await o()}catch(e){console.error("Error clearing recent state:",e),g("Error clearing recent state, but continuing with current data."),n()}finally{m(!1)}},disabled:d||h,children:h?"Processing...":"✅ Continue with Current Data"}),j.jsx("button",{className:"danstyle1c-btn",onClick:async()=>{try{console.log("Restoring recent state"),m(!0),g(null),await a()}catch(e){console.error("Error restoring recent state:",e),g("Failed to restore your most recent session. Please try again or use saved settings.")}finally{m(!1)}},disabled:d||h,children:h?"Restoring...":"🕘 Return to Most Recent Settings"}),j.jsxs("button",{className:"danstyle1c-btn",onClick:()=>{u("/account"),n()},disabled:d||h,children:[j.jsx(J,{className:"w-4 h-4 mr-2"}),"Saved Settings"]})]})]})})},mn="seatyr_app_state",pn=Array.from({length:10},(e,t)=>({id:t+1,seats:8}));function gn(e,t){const s=!!e.name&&e.name.trim().length>0,r=8!==e.seats,n=function(e,t){if(!t)return!1;const s=(e.name||"").trim().toLowerCase();for(const r of Object.values(t)){if(!r)continue;const t=String(r).split(",").map(e=>e.trim()).filter(Boolean);for(const r of t){const t=Number(r);if(!Number.isNaN(t)&&t===e.id)return!0;if(s&&r.toLowerCase()===s)return!0}}return!1}(e,t);return s||r||n}function fn(e,t,s){const r=function(e){return e.reduce((e,t)=>e+Math.max(1,t.count??1),0)}(t);let n=0;for(const c of e)gn(c,s)&&(n+=Math.max(0,c.seats));const a=Math.max(0,r-n),i=Math.ceil(a/8),o=e.filter(e=>!gn(e,s)&&8===e.seats),l=i-o.length;if(0===l)return e;if(l>0){const t=e.map(e=>e.id);let s=t.length?Math.max(...t)+1:1;const r=e.slice();for(let e=0;e<l;e++)r.push({id:s++,name:null,seats:8});return r}{const t=new Set(o.sort((e,t)=>t.id-e.id).slice(0,-l).map(e=>e.id));return e.filter(e=>!t.has(e.id))}}const xn={guests:[],tables:pn,constraints:{},adjacents:{},assignments:{},seatingPlans:[],currentPlanIndex:0,subscription:null,user:null,userSetTables:!1,loadedSavedSetting:!1,isSupabaseConnected:!1,hideTableReductionNotice:!1,duplicateGuests:[],assignmentSignature:"initial"},yn=()=>{try{const e=localStorage.getItem(mn);if(e){const t=JSON.parse(e);return delete t.subscription,delete t.user,delete t.isSupabaseConnected,{...xn,...t}}}catch(e){console.error("Error loading saved state:",e)}return xn},bn=(e,t)=>{let s=e;switch(t.type){case"SET_GUESTS":s={...e,guests:t.payload,seatingPlans:[]};break;case"ADD_GUESTS":{const r=[...e.guests,...t.payload],n=r.length,a=ln(e.subscription);if(n>a)return console.log(`Cannot add guests: limit of ${a} exceeded (total: ${n})`),alert(`You can only have up to ${a} guests with your current plan. Upgrade to Premium for unlimited guests.`),e;let i=e.tables;if(!e.userSetTables){const t=r.reduce((e,t)=>e+t.count,0);((e,t=8)=>Math.ceil(e/t))(t)>e.tables.length&&(i=((e,t=8)=>{const s=Math.ceil(e/t);return Array.from({length:s},(e,s)=>({id:s+1,seats:t}))})(t))}s={...e,guests:r,tables:i,seatingPlans:[],hideTableReductionNotice:!1};break}case"REMOVE_GUEST":{const r=[...e.guests];if(t.payload<0||t.payload>=r.length)return console.warn(`REMOVE_GUEST: invalid index ${t.payload}`),e;const n=r.splice(t.payload,1)[0],a={...e.constraints};delete a[n.name],Object.keys(a).forEach(e=>{var t;(null==(t=a[e])?void 0:t[n.name])&&delete a[e][n.name]});const i={...e.adjacents};delete i[n.name],Object.keys(i).forEach(e=>{var t;i[e]=null==(t=i[e])?void 0:t.filter(e=>e!==n.name)});const o={...e.assignments};delete o[n.name];let l=e.tables;s={...e,guests:r,constraints:a,adjacents:i,assignments:o,tables:l,hideTableReductionNotice:!1};break}case"RENAME_GUEST":{const{oldName:s,newName:r}=t.payload;if(!s||!r||s===r)return e;const n=(e.guests||[]).map(e=>e.name===s?{...e,name:r}:e),a={...e.constraints||{}};a[s]&&(a[r]={...a[s]},delete a[s]);for(const e of Object.keys(a))a[e]&&Object.prototype.hasOwnProperty.call(a[e],s)&&(a[e][r]=a[e][s],delete a[e][s]);const i={...e.adjacents||{}};i[s]&&(i[r]=Array.from(new Set(i[s].map(e=>e===s?r:e))),delete i[s]);for(const e of Object.keys(i))i[e]=Array.from(new Set((i[e]||[]).map(e=>e===s?r:e)));const o={...e.assignments||{}};return Object.prototype.hasOwnProperty.call(o,s)&&(o[r]=o[s],delete o[s]),{...e,guests:n,constraints:a,adjacents:i,assignments:o}}case"UPDATE_GUEST_COUNT":{const{index:r,count:n}=t.payload,a=[...e.guests];if(r<0||r>=a.length)return console.warn(`UPDATE_GUEST_COUNT: invalid index ${r}`),e;a[r]={...a[r],count:n},s={...e,guests:a};break}case"CLEAR_GUESTS":s={...e,guests:[],constraints:{},adjacents:{},assignments:{},seatingPlans:[],hideTableReductionNotice:!1,duplicateGuests:[]};break;case"SET_CONSTRAINT":{const{guest1:r,guest2:n,value:a}=(null==t?void 0:t.payload)||{};if(!r||!n||r===n)return e;if(!["","must","cannot"].includes(a))return e;const i={...e.constraints};""===a?(i[r]&&(delete i[r][n],Object.keys(i[r]).length||delete i[r]),i[n]&&(delete i[n][r],Object.keys(i[n]).length||delete i[n])):(i[r]={...i[r]||{},[n]:a},i[n]={...i[n]||{},[r]:a}),s={...e,constraints:i};break}case"SET_ADJACENT":{const{guest1:s,guest2:r}=t.payload,n={...e.constraints},a={...e.adjacents};n[s]={...n[s]||{}},n[r]={...n[r]||{}},"cannot"===n[s][r]&&delete n[s][r],"cannot"===n[r][s]&&delete n[r][s];const i=(e,t)=>{const s=new Set(a[e]||[]);return s.add(t),!(s.size>2)&&(a[e]=Array.from(s),!0)};return i(s,r)&&i(r,s)?{...e,constraints:n,adjacents:a}:e}case"REMOVE_ADJACENT":{const{guest1:r,guest2:n}=t.payload,a={...e.adjacents};a[r]=(a[r]||[]).filter(e=>e!==n),a[n]=(a[n]||[]).filter(e=>e!==r),s={...e,adjacents:a};break}case"ADD_TABLE":{const r={id:e.tables.length>0?Math.max(...e.tables.map(e=>e.id))+1:1,seats:8,...t.payload};s={...e,tables:[...e.tables,r],hideTableReductionNotice:!0};break}case"REMOVE_TABLE":{const r=e.tables.filter(e=>e.id!==t.payload);s={...e,tables:r,hideTableReductionNotice:!1};break}case"UPDATE_TABLE_SEATS":{const{id:r,seats:n}=t.payload,a=e.tables.find(e=>e.id===r),i=a&&n>a.seats,o=e.tables.map(e=>e.id===r?{...e,seats:n}:e);s={...e,tables:o,hideTableReductionNotice:!!i||e.hideTableReductionNotice};break}case"UPDATE_TABLE_NAME":{const{id:r,name:n}=t.payload,a=e.tables.map(e=>e.id===r?{...e,name:n}:e);s={...e,tables:a};break}case"UPDATE_ASSIGNMENT":{const r={...e.assignments},n=t.payload.id||t.payload.name;if(!n)return console.warn("UPDATE_ASSIGNMENT: empty guest identifier"),e;t.payload.tables?r[n]=t.payload.tables:delete r[n],s={...e,assignments:r,assignmentSignature:`${Date.now()}-${Math.random().toString(36).substr(2,9)}`};break}case"SET_SEATING_PLANS":s={...e,seatingPlans:t.payload};break;case"SET_CURRENT_PLAN_INDEX":s={...e,currentPlanIndex:t.payload};break;case"SET_SUBSCRIPTION":s={...e,subscription:t.payload};break;case"SET_USER":s={...e,user:t.payload};break;case"SET_USER_SET_TABLES":s={...e,userSetTables:t.payload};break;case"SET_LOADED_SAVED_SETTING":s={...e,loadedSavedSetting:t.payload};break;case"SET_SUPABASE_CONNECTED":s={...e,isSupabaseConnected:t.payload};break;case"SET_DUPLICATE_GUESTS":s={...e,duplicateGuests:t.payload};break;case"HIDE_TABLE_REDUCTION_NOTICE":s={...e,hideTableReductionNotice:!0};break;case"UPDATE_DEFAULT_TABLES":s={...e,tables:t.payload,userSetTables:!0,hideTableReductionNotice:!0};break;case"IMPORT_STATE":{const r=t.payload;s={...e,...r,subscription:e.subscription,user:e.user,isSupabaseConnected:e.isSupabaseConnected,hideTableReductionNotice:!1,duplicateGuests:[]};break}case"RESET_APP_STATE":s={...xn,isSupabaseConnected:e.isSupabaseConnected,subscription:null,user:null,guests:[],tables:pn,hideTableReductionNotice:!1,duplicateGuests:[]};try{localStorage.removeItem("seatyr_current_setting_name")}catch(r){console.error("Error clearing setting name:",r)}break;case"LOAD_MOST_RECENT":s={...t.payload,subscription:e.subscription,user:e.user,isSupabaseConnected:e.isSupabaseConnected,loadedSavedSetting:!0,hideTableReductionNotice:!1,duplicateGuests:[]};break;case"AUTO_RECONCILE_TABLES":{const t=fn(e.tables||[],e.guests||[],e.assignments||{});return t===e.tables?e:{...e,tables:t}}default:return e}s.user&&on(s.subscription)&&("SET_GUESTS"===t.type||"ADD_GUESTS"===t.type||"REMOVE_GUEST"===t.type||"SET_CONSTRAINT"===t.type||"UPDATE_TABLE_SEATS"===t.type||t.type);try{const e={...s};delete e.subscription,delete e.user,delete e.isSupabaseConnected,localStorage.setItem(mn,JSON.stringify(e))}catch(n){console.error("Error saving state:",n)}return s},vn=s.createContext(void 0),wn=({children:e})=>{var t;const[r,n]=s.useState(!1),[a,i]=s.useState(null),[o,l]=s.useState(!0),[c,d]=s.useState(null),[u,h]=s.useState(null),[m,p]=s.useState(!1),[g,f]=s.useState(!1),[x,y]=s.useState(0),[b,v]=s.useState(null),[w,_]=s.useReducer(bn,void 0,yn),N=async e=>{try{console.log("Fetching most recent state for user:",e),h(null);const t=await un(e);return t?(console.log("Found most recent state from:",t.timestamp),i(t),n(!0)):console.log("No recent state found for user:",e),p(!0),t}catch(t){return console.error("Error fetching most recent state:",t),h("Failed to load your most recent state. Please try again or load from saved settings."),n(!0),p(!0),null}};s.useEffect(()=>{const{data:{subscription:e}}=sn.auth.onAuthStateChange((e,t)=>{"SIGNED_IN"===e&&(console.log("Auth state changed in AppContext: SIGNED_IN"),f(!0))});return()=>{e.unsubscribe()}},[]),s.useEffect(()=>{if(w.user&&on(w.subscription)){const e=Date.now()-x;if(b&&clearTimeout(b),e<1e4){const t=setTimeout(()=>{dn(w.user.id,w).then(()=>{y(Date.now()),console.log("Auto-saved most recent state (debounced)")}).catch(e=>{console.error("Error auto-saving most recent state:",e)})},1e4-e);return v(t),()=>clearTimeout(t)}dn(w.user.id,w).then(()=>{y(Date.now()),console.log("Auto-saved most recent state (immediate)")}).catch(e=>{console.error("Error auto-saving most recent state:",e)})}},[w.guests,w.tables,w.constraints,w.adjacents,w.assignments,w.seatingPlans,w.currentPlanIndex,null==(t=w.user)?void 0:t.id,w.subscription]),s.useEffect(()=>{(async()=>{console.log("Supabase is not configured, skipping auth initialization"),l(!1)})()},[]),s.useEffect(()=>{if(g&&w.user&&on(w.subscription)&&!r){console.log("Auth state changed and premium user detected - checking for recent state");(async()=>{try{await N(w.user.id)}catch(e){console.error("Error checking recent state after auth change:",e),h("Failed to load your most recent state after login. Please try again or load from saved settings."),n(!0)}})(),f(!1)}},[g,w.user,w.subscription,r]),s.useEffect(()=>{const{data:{subscription:e}}=sn.auth.onAuthStateChange((e,t)=>{"SIGNED_OUT"===e?(console.log("User signed out, resetting app state"),_({type:"RESET_APP_STATE"})):"SIGNED_IN"===e&&(console.log("User signed in, setting auth state changed flag"),f(!0))});return()=>{e.unsubscribe()}},[]);const S=s.useMemo(()=>({state:w,dispatch:_}),[w,_]);return j.jsxs(vn.Provider,{value:S,children:[e,r&&w.user&&on(w.subscription)&&j.jsx(hn,{userId:w.user.id,isPremium:on(w.subscription),recentTimestamp:null==a?void 0:a.timestamp,onClose:()=>n(!1),onRestoreRecent:()=>{if(a)try{n(!1),_({type:"LOAD_MOST_RECENT",payload:a})}catch(e){console.error("Error restoring most recent state:",e),h("Failed to restore most recent state. Please try again."),n(!0)}else h("No recent state data available to restore.")},onKeepCurrent:async()=>{if(n(!1),w.user)try{await async function(e){if(!e)return!1;try{console.log("Clearing most recent state for user:",e);const{data:t,error:s}=await sn.auth.getSession();if(s)return console.error("Session error when clearing most recent state:",s),!1;if(!t.session)return console.log("No active session, skipping most recent state clear"),!1;const{error:r}=await sn.from("recent_session_states").delete().eq("user_id",e);return r?401===r.status?(console.error("Unauthorized when clearing most recent state (session expired)"),!1):(console.error("Error clearing most recent state:",r),!1):(console.log("Most recent state cleared for user:",e),!0)}catch(t){return console.error("Error clearing most recent state:",t),!1}}(w.user.id)}catch(e){console.error("Error clearing most recent state:",e),console.warn("Failed to clear most recent state, but continuing with current data.")}},onRetryFetch:async()=>{if(w.user){h(null);try{await N(w.user.id)}catch(e){console.error("Error in retry fetch:",e),h("Failed to load your most recent state. Please try again later.")}}},error:u,loading:!m&&o})]})},jn=()=>{const e=s.useContext(vn);if(!e)throw new Error("useAppContext must be used within an AppProvider");return e},_n=({onClose:e})=>{const{state:t,dispatch:r}=jn(),{isSupabaseConnected:n}=t,[a,i]=s.useState(null),[o,l]=s.useState("sign_in"),[c,d]=s.useState(!1),[u,h]=s.useState(0),[m,p]=s.useState(0),[g,f]=s.useState(0),[x,y]=s.useState(0),[b,v]=s.useState(!1),[w,_]=s.useState(!1),[N,S]=s.useState(""),[k,E]=s.useState(!1),[T,C]=s.useState(!1);s.useEffect(()=>{i("Supabase is not configured correctly or cannot connect. Please check your .env file and verify your Supabase project is accessible.")},[e,n,r]),s.useEffect(()=>{const e=setInterval(()=>{const e=Date.now()-u;p(e<3e3?Math.ceil((3e3-e)/1e3):0)},1e3);return()=>clearInterval(e)},[u]);const P=async()=>{v(!0),y(e=>e+1);try{const{data:e,error:t}=await sn.from("subscriptions").select("count",{count:"exact",head:!0});t?i("Still unable to connect to Supabase. Please check your network connection or try again later."):window.location.reload()}catch(e){console.error("Error during connection retry:",e),i("Connection retry failed. Please check your network connection or try again later.")}finally{v(!1)}};return j.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:j.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full shadow-2xl",children:[j.jsxs("div",{className:"flex justify-between items-center mb-4",children:[j.jsx("h2",{className:"text-xl font-bold",children:"Authentication Error"}),j.jsx("button",{onClick:e,className:"danstyle1c-btn","aria-label":"Close",children:j.jsx(ge,{className:"w-5 h-5"})})]}),j.jsxs("div",{className:"p-4 bg-red-50 rounded-md",children:[j.jsx("p",{className:"text-red-700 text-lg",children:"Supabase is not configured correctly or cannot connect. Please check:"}),j.jsxs("ol",{className:"list-decimal ml-5 mt-2 text-red-700",children:[j.jsx("li",{children:"Your .env file has valid Supabase credentials"}),j.jsx("li",{children:"Your Supabase project is active and accessible"}),j.jsx("li",{children:"Your network connection is working properly"})]}),j.jsxs("pre",{className:"bg-red-100 p-2 mt-4 rounded overflow-auto text-sm",children:["VITE_SUPABASE_URL=https://your-project-id.supabase.co",j.jsx("br",{}),"VITE_SUPABASE_ANON_KEY=your-supabase-anon-key"]}),j.jsx("div",{className:"mt-4 flex justify-center",children:j.jsxs("button",{onClick:P,disabled:b,className:"danstyle1c-btn",children:[b?j.jsx(ie,{className:"w-4 h-4 mr-2 animate-spin"}):j.jsx(ie,{className:"w-4 h-4 mr-2"}),b?"Retrying...":"Retry Connection"]})}),x>0&&j.jsx("p",{className:"text-sm text-red-600 mt-4",children:x>2?"Multiple retries failed. You may need to check your Supabase configuration or try again later.":`Retry attempt ${x} failed. Please try again.`})]}),j.jsx("div",{className:"mt-6 text-center",children:j.jsx("button",{onClick:e,className:"danstyle1c-btn",children:"Close"})})]})})},Nn=({children:e,variant:t="primary",size:s="md",icon:r,iconPosition:n="left",className:a="",...i})=>{let o="";"primary"===t||"secondary"===t?o="":"danger"===t?o="danstyle1c-remove":"success"===t?o="bg-[#586D78] text-white":"warning"===t&&(o="bg-[#FFEE8C] text-[#6f5700] border-none");const l=i.disabled?"opacity-50 cursor-not-allowed":"";return j.jsxs("button",{className:`danstyle1c-btn ${o} ${{sm:"text-sm px-4",md:"px-6",lg:"text-lg px-8"}[s]} ${l} ${a}`,...i,children:[r&&"left"===n&&j.jsx("span",{className:"mr-2",children:r}),e,r&&"right"===n&&j.jsx("span",{className:"ml-2",children:r})]})},Sn=({onClose:e,onSuccess:t})=>{const[r,n]=s.useState(""),[a,i]=s.useState(null),[o,l]=s.useState(!1),[c,d]=s.useState(0);return j.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:j.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full shadow-2xl",children:[j.jsxs("h2",{className:"text-2xl font-bold text-[#586D78] mb-4 flex items-center",children:[j.jsx(V,{className:"mr-2 text-yellow-500"}),"Beta Tester Access"]}),j.jsxs("form",{onSubmit:async e=>{e.preventDefault(),i(null),l(!0);try{await(async()=>{var e;const{data:t,error:s}=await sn.auth.getSession(),n=null==(e=null==t?void 0:t.session)?void 0:e.user;if(!n)return i("You must be signed in to use a beta code. Please sign in and try again."),!1;const a=r.trim();if(!a)return i("Please enter a valid beta code"),!1;try{const{data:e,error:t}=await sn.from("valid_beta_codes_ui").select("*").eq("code",a).single();if(!e||t)return console.warn("Beta code validation failed:",null==t?void 0:t.message),i("Invalid or expired code. Please check and try again."),!1;const s=new Date;s.setDate(s.getDate()+30);const{error:r}=await sn.from("trial_subscriptions").upsert({user_id:n.id,trial_code:a,start_date:(new Date).toISOString(),expires_on:s.toISOString()});return!r||(console.error("Trial upsert error:",r.message),i("Failed to activate trial: "+(r.message||"Unknown error")),!1)}catch(o){return console.error("Beta code activation error:",o),i("Failed to process beta code. Please try again later."),!1}})()&&t()}catch(s){console.error("Error activating beta code:",s),i(s instanceof Error?s.message:"An unexpected error occurred"),d(e=>e+1)}finally{l(!1)}},className:"space-y-4",children:[j.jsxs("div",{children:[j.jsx("label",{htmlFor:"betaCode",className:"block text-sm font-medium text-gray-700 mb-1",children:"Enter your beta tester code:"}),j.jsx("input",{id:"betaCode",type:"text",value:r,onChange:e=>n(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#586D78]",placeholder:"e.g., bt-rabbit-car"})]}),a&&j.jsx("div",{className:"bg-red-50 border border-red-200 rounded-md p-3",children:j.jsxs("div",{className:"flex items-start",children:[j.jsx(E,{className:"w-5 h-5 text-red-500 mr-2 flex-shrink-0 mt-0.5"}),j.jsxs("div",{children:[j.jsx("p",{className:"text-red-600 text-sm",children:a}),c>0&&c<3&&j.jsx(Nn,{variant:"secondary",size:"sm",onClick:()=>{c>=3?i("Maximum retries reached. Please try again later or contact support."):(i(null),d(e=>e+1))},className:"mt-2",icon:j.jsx(ie,{className:"w-4 h-4"}),children:"Try Again"})]})]})}),j.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-md p-3",children:j.jsx("p",{className:"text-sm text-amber-700",children:"Beta tester codes provide 30 days of premium access. Each code can be used up to 3 times."})}),j.jsxs("div",{className:"flex justify-end space-x-2",children:[j.jsx(Nn,{variant:"secondary",onClick:e,disabled:o,children:"Cancel"}),j.jsx(Nn,{type:"submit",disabled:!r.trim()||o,icon:o?j.jsx("span",{className:"animate-spin",children:"⟳"}):void 0,children:o?"Activating...":"Activate Trial"})]})]})]})})};var kn,En="https://js.stripe.com/v3",Tn=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,Cn=function(e){var t=document.createElement("script");t.src="".concat(En).concat("");var s=document.head||document.body;if(!s)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return s.appendChild(t),t},Pn=null,An=null,In=null,Dn=function(e){return null!==Pn?Pn:(Pn=new Promise(function(t,s){if("undefined"!=typeof window&&"undefined"!=typeof document)if(window.Stripe)t(window.Stripe);else try{var r=function(){for(var e=document.querySelectorAll('script[src^="'.concat(En,'"]')),t=0;t<e.length;t++){var s=e[t];if(Tn.test(s.src))return s}return null}();if(r&&e);else if(r){if(r&&null!==In&&null!==An){var n;r.removeEventListener("load",In),r.removeEventListener("error",An),null===(n=r.parentNode)||void 0===n||n.removeChild(r),r=Cn()}}else r=Cn();In=function(e,t){return function(){window.Stripe?e(window.Stripe):t(new Error("Stripe.js not available"))}}(t,s),An=function(e){return function(){e(new Error("Failed to load Stripe.js"))}}(s),r.addEventListener("load",In),r.addEventListener("error",An)}catch(a){return void s(a)}else t(null)})).catch(function(e){return Pn=null,Promise.reject(e)})},On=!1,$n=function(){return kn||(kn=Dn(null).catch(function(e){return kn=null,Promise.reject(e)}))};Promise.resolve().then(function(){return $n()}).catch(function(e){On||console.warn(e)});const Rn=function(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];On=!0;var r=Date.now();return $n().then(function(e){return function(e,t,s){if(null===e)return null;var r=e.apply(void 0,t);return function(e,t){e&&e._registerWrapper&&e._registerWrapper({name:"stripe-js",version:"2.4.0",startTime:t})}(r,s),r}(e,t,r)})}(void 0),Un=async e=>{try{if(!e)throw new Error("User ID is required");const{data:s,error:r}=await sn.from("subscriptions").select("*").eq("user_id",e).eq("status","active").is("canceled_at",null).limit(1);if(r)throw console.error("Error checking existing subscription:",r),new Error("Unable to verify subscription status");if((null==s?void 0:s.length)>0)throw new Error("You already have an active subscription");console.log("Creating checkout session for user:",e);try{const t=await fetch("undefined/functions/v1/create-checkout",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer undefined"},body:JSON.stringify({userId:e})});if(!t.ok){const e=await t.text();throw console.error("Error response from create-checkout:",e),new Error(`Failed to create checkout session: ${e}`)}const{sessionId:s,url:r}=await t.json();if(console.log("Checkout session created:",s),r)return void(window.location.href=r);const n=await Rn;if(!n)throw new Error("Failed to load Stripe");const{error:a}=await n.redirectToCheckout({sessionId:s});if(a)throw console.error("Stripe redirect error:",a),a}catch(t){console.error("Edge function failed, using direct link fallback",t),window.location.href="https://buy.stripe.com/3cs4ju9Y113D8hi5kk"}}catch(t){throw console.error("Error redirecting to checkout:",t),new Error("Failed to start checkout process: "+(t.message||"Please try again."))}},Ln=async(e,t)=>{try{if(!e)throw new Error("User ID is required");const s="undefined/functions/v1/manage-subscription",r=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer undefined"},body:JSON.stringify({userId:e,action:t})});if(!r.ok){const e=await r.json();throw new Error(e.error||`Failed to ${t} subscription`)}return await r.json()}catch(s){throw console.error("Error managing subscription:",s),s}},Mn=async e=>{try{if(!e)throw new Error("User ID is required");const t=await fetch("undefined/functions/v1/create-portal-session",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer undefined"},body:JSON.stringify({userId:e})});if(!t.ok){const e=await t.json();throw new Error(e.error||"Failed to create customer portal session")}const{url:s}=await t.json();window.location.href=s}catch(t){throw console.error("Error redirecting to customer portal:",t),t}},Fn=({onClose:e,userId:t,onSuccess:r})=>{const[n,a]=s.useState(!1),[i,o]=s.useState(!1),[l,c]=s.useState(null);return j.jsxs(j.Fragment,{children:[j.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:j.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full shadow-2xl",children:[j.jsxs("div",{className:"flex justify-between items-center mb-6",children:[j.jsxs("h2",{className:"text-2xl font-bold text-[#7973BB] flex items-center",children:[j.jsx(V,{className:"w-6 h-6 text-yellow-500 mr-2"}),"Upgrade to Premium"]}),j.jsx("button",{onClick:e,className:"text-gray-500 hover:text-gray-700 text-2xl","aria-label":"Close",children:"×"})]}),l&&j.jsxs("div",{className:"mb-4 bg-red-50 border border-red-200 rounded-md p-3 flex items-start",children:[j.jsx(E,{className:"w-5 h-5 text-red-500 mr-2 flex-shrink-0 mt-0.5"}),j.jsxs("div",{children:[j.jsx("p",{className:"text-red-700",children:l}),j.jsx("p",{className:"text-sm text-red-600 mt-1",children:"Please try again or contact support if this persists."})]})]}),j.jsxs("div",{className:"space-y-5",children:[j.jsx("p",{className:"text-lg text-gray-700 mb-4",children:"Great! Please click a button:"}),j.jsx("button",{className:"w-full py-3 px-4 rounded-lg flex items-center justify-center text-[#fadeee] bg-[#a78bfa] border border-[#a78bfa] font-medium hover:bg-[#a78bfa]/90 transition-colors disabled:opacity-70 disabled:cursor-not-allowed",onClick:async()=>{try{o(!0),c(null),await Un(t)}catch(e){console.error("Error initiating checkout:",e),c(`Failed to start checkout: ${e.message||"Please try again later"}`),o(!1)}},disabled:i,children:i?"Processing...":"Sign Me Up!"}),j.jsx("button",{className:"w-full py-3 px-4 rounded-lg flex items-center justify-center text-[#a78bfa] bg-[#fadeee] font-medium hover:bg-[#fadeee]/90 transition-colors",onClick:()=>a(!0),disabled:i,children:"Beta Tester Code"}),j.jsx("div",{className:"pt-2 text-sm text-gray-500",children:j.jsx("p",{children:"Premium gives you unlimited guests, 50 saved settings, and premium support!"})})]})]})}),n&&j.jsx(Sn,{onClose:()=>a(!1),onSuccess:()=>{r&&r(),e()}})]})},Bn=async(e,t=!1)=>{if(t||localStorage.removeItem("seatyr_recent_tables"),!e)return{success:!1,error:"No user ID provided"};try{const{data:t,error:s}=await sn.auth.getSession();if(s)return console.error("Session error when clearing session settings:",s),{success:!1,error:"No active session"};if(!t.session)return console.log("No active session, skipping clear session settings"),{success:!1,error:"No active session"};const{error:r}=await sn.from("recent_session_settings").delete().eq("user_id",e);return r?(console.error("Error clearing session settings from Supabase:",r),401!==r.status&&console.error("Failed to clear session settings: "+r.message),{success:!1,error:r.message}):{success:!0}}catch(s){return console.error("Error clearing session settings from Supabase:",s),{success:!1,error:s instanceof Error?s.message:"Unknown error"}}},qn=()=>{try{Object.keys(localStorage).forEach(e=>{e.startsWith("seatyr_")&&localStorage.removeItem(e)}),localStorage.removeItem("seatyr_app_state"),localStorage.removeItem("seatyr_current_setting_name"),Object.keys(sessionStorage).forEach(e=>{e.startsWith("seatyr_")&&sessionStorage.removeItem(e)}),localStorage.removeItem("seatyr-auth-token"),localStorage.removeItem("supabase.auth.token"),localStorage.removeItem("lastEmailSent"),localStorage.removeItem("dailyEmailCount"),localStorage.removeItem("emailCountDate"),console.log("All Seatyr data cleared from browser storage")}catch(e){console.error("Error clearing Seatyr data from storage:",e)}},zn=()=>{const[e,t]=s.useState(!1),[r,n]=s.useState(!1),[a,l]=s.useState(!1),[c,d]=s.useState(null),[u,h]=s.useState(null),[m,p]=s.useState(!1),[g,f]=s.useState(!1),[x,y]=s.useState(!1),[b,v]=s.useState(0),w=i(),{state:_,dispatch:N}=jn(),S=on(u)||on(_.subscription);s.useEffect(()=>{(async()=>{try{const{data:{session:e}}=await sn.auth.getSession();d((null==e?void 0:e.user)??null),(null==e?void 0:e.user)&&(N({type:"SET_USER",payload:e.user}),k(e.user.id,!0))}catch(e){console.error("Error initializing user in Header:",e)}})();const{data:{subscription:e}}=sn.auth.onAuthStateChange(async(e,t)=>{console.log("Auth state changed in Header:",e);const s=(null==t?void 0:t.user)??null;d(s),s?(N({type:"SET_USER",payload:s}),k(s.id,!0)):(h(null),N({type:"SET_SUBSCRIPTION",payload:null}))});return()=>e.unsubscribe()},[N]),s.useEffect(()=>{_.user&&_.user!==c&&d(_.user),_.subscription&&_.subscription!==u&&h(_.subscription)},[_.user,_.subscription,c,u]),s.useEffect(()=>{if(!x)return;const e=Date.now()-b;if(g)return void y(!1);if(e<1e4){const t=setTimeout(()=>{y(!0)},1e4-e);return()=>clearTimeout(t)}(async()=>{var e,t;if(null==c?void 0:c.id){f(!0);try{const{data:r,error:n}=await sn.from("subscriptions").select("*").eq("user_id",c.id).order("current_period_end",{ascending:!1}).limit(1);if(n)return void console.error("Subscription fetch error:",n);const a=(null==r?void 0:r[0])||null;if(h(a),N({type:"SET_SUBSCRIPTION",payload:a}),!a){const{data:r,error:n}=await sn.from("trial_subscriptions").select("*").eq("user_id",c.id).gt("expires_on",(new Date).toISOString()).limit(1);if(!n&&(null==r?void 0:r.length)>0){const e={id:`trial-${r[0].id}`,user_id:c.id,status:"active",current_period_start:r[0].start_date,current_period_end:r[0].expires_on,cancel_at_period_end:!0};h(e),N({type:"SET_SUBSCRIPTION",payload:e})}else{const{data:r}=await sn.auth.getUser(),n=null==(t=null==(e=null==r?void 0:r.user)?void 0:e.email)?void 0:t.toLowerCase();if("danabrams999@yahoo.com"===n||"immortality.bytes.book@gmail.com"===n)try{await fetch("undefined/functions/v1/sync-user-premium",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer undefined"},body:JSON.stringify({email:n})});const{data:e}=await sn.from("subscriptions").select("*").eq("user_id",c.id).order("current_period_end",{ascending:!1}).limit(1),t=(null==e?void 0:e[0])||null;t&&(h(t),N({type:"SET_SUBSCRIPTION",payload:t}))}catch(s){console.error("VIP sync error:",s)}}}}catch(r){console.error("Error in fetchSubscription:",r)}finally{v(Date.now()),f(!1),y(!1)}}else y(!1)})()},[x,g,b,c,N]);const k=async(e,t=!1)=>{if(e)if(t){if(g)return;f(!0);try{const{data:t,error:s}=await sn.from("subscriptions").select("*").eq("user_id",e).order("current_period_end",{ascending:!1}).limit(1);if(s)return void console.error("Subscription fetch error:",s);const r=(null==t?void 0:t[0])||null;if(h(r),N({type:"SET_SUBSCRIPTION",payload:r}),!r){const{data:t,error:s}=await sn.from("trial_subscriptions").select("*").eq("user_id",e).gt("expires_on",(new Date).toISOString()).limit(1);if(!s&&(null==t?void 0:t.length)>0){const s={id:`trial-${t[0].id}`,user_id:e,status:"active",current_period_start:t[0].start_date,current_period_end:t[0].expires_on,cancel_at_period_end:!0};h(s),N({type:"SET_SUBSCRIPTION",payload:s})}}}catch(s){console.error("Error in forced fetchSubscription:",s)}finally{v(Date.now()),f(!1)}}else y(!0)};return j.jsxs("header",{className:"bg-[#ddele3] shadow-md",style:{paddingTop:"1.3rem",paddingBottom:"1.3rem"},children:[j.jsx("div",{className:"container mx-auto px-4 py-3",children:j.jsxs("div",{className:"flex flex-col space-y-3 md:space-y-2",children:[j.jsxs("div",{className:"flex flex-col md:flex-row md:justify-between md:items-center",children:[j.jsxs("div",{className:"flex items-center",children:[j.jsx("img",{src:"https://i.imgur.com/FD3PWnT.png",alt:"Seatyr Logo",className:"h-6 w-auto mr-8",style:{height:"8rem"}}),j.jsxs("div",{className:"flex flex-col",children:[j.jsxs("div",{className:"relative",children:[j.jsx("h3",{className:"text-8xl font-bold text-[#586D78]",style:{fontSize:"4.3rem",lineHeight:"1"},children:"Seatyr"}),j.jsx("span",{className:"text-xs text-[#586D78] absolute",style:{top:"4.5rem",left:"0",whiteSpace:"nowrap",fontSize:"0.8rem"},children:"Preview Version 0.975"})]}),j.jsx("span",{className:"text-2xl italic text-[#586D78]",style:{marginTop:"2rem",fontSize:"0.9rem"},children:"Guaranteed Fewer Headaches..."}),j.jsx("span",{className:"text-2xl italic text-[#586D78]",style:{fontSize:"0.9rem",marginTop:"0.3rem",lineHeight:"0.3"},children:"*seating-related headaches only."})]})]}),j.jsxs("div",{className:"flex flex-wrap items-center gap-2 mt-2 md:mt-0",children:[S&&c&&j.jsxs("span",{className:"flex items-center danstyle1c-btn danstyle1c-premium",children:[j.jsx(V,{className:"w-4 h-4 mr-1"}),"Premium"]}),g&&j.jsx("span",{className:"flex items-center text-gray-600 px-2 py-0.5 text-xs",children:"Syncing..."}),c?j.jsxs(j.Fragment,{children:[j.jsxs("button",{className:"danstyle1c-btn",onClick:()=>w("/account"),children:[j.jsx(B,{className:"w-4 h-4 mr-2"}),j.jsx("span",{className:"text-xs truncate max-w-[140px]",children:c.email})]}),j.jsx("button",{className:"danstyle1c-btn",onClick:async()=>{try{p(!0),N({type:"RESET_APP_STATE"}),N({type:"SET_DUPLICATE_GUESTS",payload:[]}),qn(),await sn.auth.signOut(),d(null),h(null),w("/")}catch(e){console.error("Error during logout:",e);try{await sn.auth.signOut(),N({type:"RESET_APP_STATE"}),qn(),d(null),h(null),w("/")}catch(t){console.error("Final error during forced logout:",t),alert("An error occurred during logout. Please refresh the page.")}}finally{p(!1)}},disabled:m,children:m?"Signing Out...":"Sign Out"})]}):j.jsx("button",{className:"danstyle1c-btn",onClick:()=>t(!0),children:"Login/Join"}),c&&!S&&j.jsxs("button",{className:"danstyle1c-btn danstyle1c-premium",onClick:()=>{c?n(!0):t(!0)},disabled:m,children:[j.jsx(V,{className:"w-4 h-4 mr-2"}),m?"Processing...":"Upgrade"]})]})]}),j.jsx("nav",{className:"flex flex-wrap gap-3 w-full",style:{marginTop:"3.0rem"},children:j.jsxs("ul",{className:"flex flex-wrap justify-start gap-3 w-full",children:[j.jsx(Gn,{to:"/",icon:j.jsx(me,{className:"w-4 h-4"}),label:"Guests"}),j.jsx(Gn,{to:"/constraints",icon:j.jsx(z,{className:"w-4 h-4"}),label:"Your Rules"}),j.jsx(Gn,{to:"/tables",icon:j.jsx(de,{className:"w-4 h-4"}),label:"Tables"}),j.jsx(o,{to:"/seating",className:({isActive:e})=>"flex items-center "+(e?"danstyle1c-btn selected":"danstyle1c-btn"),children:({isActive:e})=>j.jsxs(j.Fragment,{children:[j.jsx(C,{className:"w-4 h-4 mr-1"}),j.jsx("span",{children:"Seating"})]})})]})})]})}),e&&j.jsx(_n,{onClose:()=>t(!1)}),r&&c&&j.jsx(Fn,{onClose:()=>n(!1),userId:c.id,onSuccess:()=>{(null==c?void 0:c.id)&&k(c.id,!0)}}),a&&c&&S&&j.jsx(hn,{userId:c.id,isPremium:S,recentTimestamp:null,onClose:()=>l(!1),onRestoreRecent:()=>{un(c.id).then(e=>{e&&N({type:"LOAD_MOST_RECENT",payload:e}),l(!1)})},onKeepCurrent:()=>l(!1)})]})},Gn=({to:e,icon:t,label:s})=>j.jsx("li",{className:"flex-none",children:j.jsxs(o,{to:e,className:({isActive:e})=>"flex items-center "+(e?"danstyle1c-btn selected":"danstyle1c-btn"),children:[t,j.jsx("span",{className:"ml-1",children:s})]})}),Wn=({title:e,children:t,className:s="",actions:r})=>j.jsxs("div",{className:`bg-white rounded-lg shadow-md overflow-hidden ${s}`,children:[e&&j.jsxs("div",{className:"px-4 py-3 bg-indigo-50 border-b border-indigo-100 flex justify-between items-center",children:[j.jsx("h2",{className:"text-lg font-bold text-[#586D78]",children:e}),r&&j.jsx("div",{className:"flex space-x-2",children:r})]}),j.jsx("div",{className:e?"p-2":"p-4",children:t})]});function Kn(e){if(!e||"string"!=typeof e)return"";const t=e.trim();if(!t)return"";const s=t.match(/%(\w+)/);if(s)return s[1];const r=t.split(/[&+]|\b(?:and|plus)\b/gi);for(const a of r){const e=a.trim().split(/\s+/).filter(e=>e.length>0);if(e.length>1)return e[e.length-1]}const n=t.split(/\s+/).filter(e=>e.length>0);return n.length>0?n[0]:t}const Vn=({name:e,className:t=""})=>{const s=function(e){const t=String(e).trim();if(!t)return null;const s=t.match(/[&+]\s*(\d+)\s*$/),r=t.match(/\((\d+)\)\s*$/),n=/[&+]\s*(?:guest|guests?)\s*$/i.test(t),a=/\b(?:\+|plus|and)\s+(?:guest|guests?)\s*$/i.test(t),i=t.match(/\b(?:\+|plus|and)\s+(one|two|three|four|five|six|seven|eight|nine|ten)\s*$/i);if(s)return`+${parseInt(s[1],10)}`;if(r)return`+${parseInt(r[1],10)}`;if(n)return"+1";if(a)return"+1";if(i)return`+${{one:1,two:2,three:3,four:4,five:5,six:6,seven:7,eight:8,nine:9,ten:10}[i[1].toLowerCase()]||1}`;return null}(e),r=e.replace(/\s*\(\s*\d+\s*\)\s*$/i,"").replace(/\s*[&+]\s*\d+\s*$/i,"").replace(/\s+(?:and|plus|\+|&)\s+(?:guest|guests?)\s*$/i,"").trim();if(!r||"string"!=typeof r||!r.includes("%"))return j.jsxs("span",{className:t,children:[r,s&&j.jsx("span",{className:"ml-0.5 font-normal",children:s})]});const[n,...a]=r.split("%"),i=a.join("%");if(!i.trim())return j.jsxs("span",{className:t,children:[n.replace("%",""),s&&j.jsx("span",{className:"ml-0.5 font-normal",children:s})]});const o=i.match(/(\s*)(\S+)(.*)/);if(!o)return j.jsxs("span",{className:t,children:[n,i,s&&j.jsx("span",{className:"ml-0.5 font-normal",children:s})]});const[,l,c,d]=o;return j.jsxs("span",{className:t,children:[n,l,j.jsx("span",{style:{color:"#959595",fontStyle:"italic"},children:c}),d,s&&j.jsx("span",{className:"ml-0.5 font-normal",children:s})]})},Hn=()=>{const{state:e,dispatch:t}=jn(),[r,n]=s.useState(""),[a,o]=s.useState(!1),[l,c]=s.useState(!1),[d,u]=s.useState(!1),[h,m]=s.useState(null);i();const[p,g]=s.useState(null),[f,x]=s.useState(""),[y,b]=s.useState("as-entered"),[v,w]=s.useState(!1),_=s.useRef(null),[N,S]=s.useState([]),k=e.duplicateGuests||N,[T,C]=s.useState(!1),[A,D]=s.useState([]),[O,$]=s.useState(!1),[R,L]=s.useState(null),[M,B]=s.useState(!1),[q,z]=s.useState(null),G=s.useRef(null);s.useEffect(()=>{if(e.user&&!on(e.subscription)){const s=ln(e.subscription);if(e.guests.length>s){console.log(`Trimming guest list from ${e.guests.length} to ${s} (free user limit)`);const r=e.guests.slice(0,s);t({type:"SET_GUESTS",payload:r}),alert(`Your guest list has been trimmed to ${s} guests (free user limit). Upgrade to Premium for unlimited guests.`)}}},[e.user,e.subscription,e.guests.length,t]),s.useEffect(()=>{e.user?K():D([])},[e.user]),s.useEffect(()=>{if(!e.user)return;q&&q.unsubscribe();const t=sn.channel("saved_settings_changes").on("postgres_changes",{event:"*",schema:"public",table:"saved_settings",filter:`user_id=eq.${e.user.id}`},()=>{K()}).subscribe();return z(t),()=>{t.unsubscribe(),z(null)}},[e.user]),s.useEffect(()=>{const e=k&&k.length>0;C(e)},[k]),s.useEffect(()=>{const t=!!e.user,s=localStorage.getItem("seatyr_video_visible");if(null!==s)w("true"===s);else if(t)w(!1),localStorage.setItem("seatyr_video_visible","false");else if(w(!0),localStorage.setItem("seatyr_video_visible","true"),_.current){const e=_.current,t=e.src;t.includes("autoplay=0")?e.src=t.replace("autoplay=0","autoplay=1"):t.includes("autoplay=1")||(e.src=t+(t.includes("?")?"&":"?")+"autoplay=1")}},[e.user]),s.useEffect(()=>{(async()=>{if(e.user&&on(e.subscription)&&e.userSetTables){e.tables.some(e=>void 0!==e.name)&&await(async(e,t,s)=>{if(s&&0!==s.length)try{if(localStorage.setItem("seatyr_recent_tables",JSON.stringify(s)),t&&e){const{data:t,error:r}=await sn.auth.getSession();if(r)throw console.error("Session error when saving recent session settings:",r),new Error("Your session has expired. Please log in again.");if(!t.session)throw console.log("No active session, skipping recent session settings save"),new Error("No active session. Please log in to save your settings.");const{data:n,error:a}=await sn.from("recent_session_settings").select("id").eq("user_id",e).maybeSingle();if(a){if(401===a.status)throw console.error("Unauthorized when fetching session settings (session expired)"),new Error("Your session has expired. Please log in again.");throw console.error("Error fetching recent session settings:",a),new Error("Failed to fetch recent session settings: "+a.message)}const i={tables:s,timestamp:(new Date).toISOString()};if(n){const{error:t}=await sn.from("recent_session_settings").update({data:i}).eq("user_id",e);if(t)throw console.error("Error updating recent session settings:",t),new Error("Failed to update recent session settings: "+t.message)}else{const{error:t}=await sn.from("recent_session_settings").insert([{user_id:e,data:i}]);if(t)throw console.error("Error inserting recent session settings:",t),new Error("Failed to save recent session settings: "+t.message)}}}catch(r){throw console.error("Error saving recent session settings:",r),r}})(e.user.id,on(e.subscription),e.tables)}})()},[e.tables,e.user,e.subscription,e.userSetTables]),s.useEffect(()=>{const e=setTimeout(()=>{X()},2e4);return()=>clearTimeout(e)},[]);const W=()=>{const e=!v;if(w(e),localStorage.setItem("seatyr_video_visible",e.toString()),e&&_.current){const e=_.current,t=e.src;t.includes("autoplay=0")?e.src=t.replace("autoplay=0","autoplay=1"):t.includes("autoplay=1")||(e.src=t+(t.includes("?")?"&":"?")+"autoplay=1")}},K=async()=>{try{if(!e.user)return;$(!0),L(null);const{data:t,error:s}=await sn.from("saved_settings").select("*").eq("user_id",e.user.id).order("updated_at",{ascending:!1});if(s)return console.error("Error fetching saved settings:",s),void(401===s.status?L("Your session has expired. Please log in again."):L("Failed to load saved settings. "+(s.message||"Please try again")));console.log(`Fetched ${(null==t?void 0:t.length)||0} saved settings`),D(t||[])}catch(t){console.error("Error fetching saved settings:",t),L("An error occurred while loading saved settings")}finally{$(!1)}},V=async e=>{try{if(!e.data)throw new Error("Saved setting data is missing or corrupted");e.data.tables&&(e.data.tables=e.data.tables.map(e=>e.hasOwnProperty("seats")?e:{...e,seats:8})),e.data.hasOwnProperty("userSetTables")||(e.data.userSetTables=!0),S([]),C(!1),t({type:"SET_DUPLICATE_GUESTS",payload:[]}),localStorage.setItem("seatyr_current_setting_name",e.name),t({type:"IMPORT_STATE",payload:e.data}),t({type:"SET_LOADED_SAVED_SETTING",payload:!0}),B(!1)}catch(s){console.error("Error loading saved setting:",s),alert("Failed to load settings: "+(s.message||"Unknown error"))}},H=()=>{t({type:"SET_SEATING_PLANS",payload:[]}),t({type:"SET_CURRENT_PLAN_INDEX",payload:0}),localStorage.setItem("seatyr_current_setting_name","Unsaved"),t({type:"SET_LOADED_SAVED_SETTING",payload:!1})},Y=()=>{if(!r.trim())return;const s=(e=>{try{if(e.includes("CONFIGURATION DATA")){const s=e.substring(e.indexOf("CONFIGURATION DATA")),r=s.indexOf("{");if(-1!==r){const e=JSON.parse(s.substring(r));if(e.version&&e.guests)return e.tables&&(e.tables=e.tables.map(e=>e.hasOwnProperty("seats")?e:{...e,seats:8})),e.hasOwnProperty("userSetTables")||(e.userSetTables=!0),S([]),t({type:"SET_DUPLICATE_GUESTS",payload:[]}),C(!1),t({type:"IMPORT_STATE",payload:e}),t({type:"SET_LOADED_SAVED_SETTING",payload:!0}),n(""),m(null),H(),[]}}return e.split(/[,\n]/).map(e=>e.trim()).filter(e=>e).map(e=>{const t=me(e);return{id:`guest_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,name:e,count:t}}).filter(e=>e.name)}catch(s){return console.error("Error parsing input:",s),m("Invalid format. Please check your input and try again."),[]}})(r);if(s.length>0){const r=on(e.subscription),a=ln(e.subscription),i=s.reduce((e,t)=>e+t.count,0);if(e.guests.reduce((e,t)=>e+t.count,0)+i>a&&!r)return void u(!0);const o=e.guests.map(e=>e.name.toLowerCase()),l=[],c=[],d=new Set;for(const e of s){const t=e.name.toLowerCase();o.includes(t)||d.has(t)?l.push(e.name):(c.push(e),d.add(t))}l.length>0?(S(l),t({type:"SET_DUPLICATE_GUESTS",payload:l}),C(!0)):(S([]),t({type:"SET_DUPLICATE_GUESTS",payload:[]}),C(!1)),c.length>0?(t({type:"ADD_GUESTS",payload:c}),n(""),m(null),H()):l.length>0&&m("All entered guests are duplicates of existing guests.")}},X=()=>{const e=document.getElementById("leftArrow"),t=document.getElementById("rightArrow");e&&e.classList.add("hidden"),t&&t.classList.add("hidden")},Q=(t,s)=>{g(t),x("string"==typeof s?s:e.guests[t].name)},ee=s=>{if(!f.trim())return g(null),void x("");const r=f.trim().toLowerCase();if(e.guests.some((e,t)=>t!==s&&e.name.toLowerCase()===r))return alert(`Cannot rename: "${f}" already exists in your guest list.`),g(null),void x("");const n=f.trim(),a=e.guests[s],i=me(n);t({type:"RENAME_GUEST",payload:{oldName:a.name,newName:n}}),i!==a.count&&t({type:"UPDATE_GUEST_COUNT",payload:{index:s,count:i}}),H(),S([]),t({type:"SET_DUPLICATE_GUESTS",payload:[]}),C(!1),g(null),x("")},re=async()=>{if(e.user)try{await Un(e.user.id)}catch(t){console.error("Error initiating checkout:",t),alert("Failed to start checkout process. Please try again.")}else c(!0)},ne=()=>{C(!1),S([]),t({type:"SET_DUPLICATE_GUESTS",payload:[]})},ae=(t,s,r)=>{if(null==s?void 0:s.tables)for(const e of s.tables){if((e.seats||[]).map(e=>"string"==typeof e?e:null==e?void 0:e.name).filter(Boolean).includes(t))return e.id}const n=e.guests.find(e=>e.name===t);if(n&&r){const e=r[n.id];if(e){const t=e.split(",").map(e=>parseInt(e.trim(),10)).filter(e=>!Number.isNaN(e));if(t.length)return t[0]}const s=r[t];if(s){const e=s.split(",").map(e=>parseInt(e.trim(),10)).filter(e=>!Number.isNaN(e));if(e.length)return e[0]}}return Number.POSITIVE_INFINITY},oe=on(e.subscription),le=!oe&&e.guests.length>=70,ce="as-entered"===y?[...e.guests]:[...e.guests].sort((t,s)=>{if("first-name"===y){const e=t.name.split(" ")[0].toLowerCase(),r=s.name.split(" ")[0].toLowerCase();return e.localeCompare(r)}if("last-name"===y){const e=e=>Kn(e.split("&")[0].trim()).toLowerCase(),r=e(t.name),n=e(s.name);return r.localeCompare(n)}if("current-table"===y){if(0===e.seatingPlans.length)return 0;const r=e.seatingPlans[e.currentPlanIndex];return ae(t.name,r,e.assignments)-ae(s.name,r,e.assignments)}return 0}),de=ln(e.subscription);!oe&&Math.min(100,Math.round(e.guests.length/de*100)),!oe&&e.guests.length;const me=e=>{if(!e||!e.trim())return 0;let t=1;/plus\s+one/i.test(e)&&(t+=1);const s=e.split(/(\s*[&+]\s*|\s+and\s+|\s+plus\s+)/gi);for(let r=1;r<s.length;r+=2){const e=s[r];if(e&&e.match(/[&+]|and|plus/i)&&(t++,r+1<s.length)){const e=s[r+1].trim(),n=e.match(/^(\d+)/);if(n){const e=parseInt(n[1],10);!isNaN(e)&&e>0&&(t+=e-1)}else{const s={zero:0,one:1,two:2,three:3,four:4,five:5,six:6,seven:7,eight:8,nine:9,ten:10,eleven:11,twelve:12,thirteen:13,fourteen:14,fifteen:15,sixteen:16,seventeen:17,eighteen:18,nineteen:19,twenty:20,thirty:30,forty:40,fifty:50,sixty:60,seventy:70,eighty:80,ninety:90,hundred:100},r=e.toLowerCase();for(const[e,n]of Object.entries(s))if(r.startsWith(e)){n>0&&(t+=n-1);break}}}}if(/\bguest\b/i.test(e)){/\b(plus|and|&|\+)\s+guest\b/i.test(e)||/\b(plus|and|&|\+)\s+one\b/i.test(e)||(t+=1)}return t};return j.jsxs("div",{className:"space-y-14",children:[j.jsx("div",{className:"w-full bg-white rounded-lg shadow-md overflow-hidden",children:v?j.jsxs("div",{className:"relative",children:[j.jsx("div",{className:"p-2 flex justify-end",children:j.jsxs("button",{onClick:W,className:"danstyle1c-btn","aria-label":"Hide video section",children:[j.jsx(ge,{className:"w-4 h-4 mr-2"}),"Hide Section"]})}),j.jsx("div",{className:"relative w-full pt-[37.5%] overflow-hidden",children:j.jsx("iframe",{ref:_,src:`https://player.vimeo.com/video/1085961997?badge=0&autopause=0&player_id=0&app_id=58479&autoplay=${e.user?"0":"1"}&muted=1&loop=1&dnt=1`,allow:"autoplay; fullscreen; picture-in-picture; clipboard-write; encrypted-media",title:"SeatyrBannerV1cVideo",className:"absolute top-0 left-0 w-full h-full"})})]}):j.jsxs("div",{className:"p-4 flex justify-end items-center",children:[j.jsx("h3",{className:"text-lg font-medium text-[#586D78] mr-4",children:"Quick Overview Intro"}),j.jsxs("button",{onClick:W,className:"danstyle1c-btn","aria-label":"Replay video",children:[j.jsx(se,{className:"w-4 h-4 mr-2"}),"Replay Video"]})]})}),null,e.user?j.jsx("div",{className:"w-full",children:j.jsx(Wn,{children:j.jsxs("div",{className:"space-y-4",children:[j.jsxs("div",{children:[j.jsx("p",{className:"text-gray-700 text-[17px]",children:"• Enter guest names separated by commas or line breaks."}),j.jsx("p",{className:"text-gray-700 text-[17px]",children:'• Connect couples and parties with an ampersand (&), plus (+), or the word "and".'}),!oe&&j.jsx("div",{className:"mt-2",children:(()=>{const t=(e.guests??[]).reduce((e,t)=>e+Math.max(1,t.count??1),0);return j.jsxs("p",{className:"text-sm text-[#586D78]",style:{fontSize:"0.7em"},children:["Free plan: ",t,"/80 guests used"]})})()}),oe&&e.user&&j.jsx("p",{className:"text-sm text-green-600 mt-2",children:"Premium plan: Unlimited guests"})]}),T&&j.jsxs("div",{className:"p-3 bg-[#88abc6] border border-[#88abc6] rounded-md relative",children:[j.jsxs("div",{className:"flex items-start pr-8",children:[j.jsx(E,{className:"text-white mr-2 mt-0.5 flex-shrink-0"}),j.jsxs("div",{children:[j.jsx("p",{className:"text-white font-medium",children:"Duplicate Guest Names Detected"}),j.jsx("p",{className:"text-white text-sm",children:"The following names already exist in your guest list and were not added:"}),j.jsx("ul",{className:"text-white text-sm mt-1 list-disc pl-5",children:k.map((e,t)=>j.jsx("li",{children:j.jsx(Vn,{name:e})},t))})]})]}),j.jsx("button",{className:"absolute top-2 right-2 text-white hover:text-white",onClick:ne,"aria-label":"Close warning",children:j.jsx(ge,{className:"w-5 h-5"})})]}),j.jsxs("div",{className:"flex flex-col space-y-2",children:[j.jsx("div",{className:"mt-2"}),j.jsx("textarea",{value:r,onChange:e=>{n(e.target.value),k.length>0&&(S([]),t({type:"SET_DUPLICATE_GUESTS",payload:[]}),C(!1))},placeholder:"e.g., Alice, Bob\r\nCarol & David",className:"w-full px-3 py-2 border border-[#586D78] border-[1.5px] rounded-md focus:outline-none focus:ring-2 focus:ring-[#586D78] min-h-[100px]",rows:4,onKeyDown:e=>"Enter"===e.key&&e.ctrlKey&&Y()})]}),h&&j.jsx("div",{className:"text-red-600 text-sm mt-2",children:h}),j.jsxs("div",{className:"flex space-x-2",children:[j.jsx("input",{type:"file",ref:G,onChange:s=>{var r;const a=null==(r=s.target.files)?void 0:r[0];if(!a)return;const i=new FileReader;i.onload=s=>{var r;const a=null==(r=s.target)?void 0:r.result;try{const s=a.split("\n");let r=null;const i=s.findIndex(e=>e.includes("CONFIGURATION DATA"));if(-1!==i){const e=s.slice(i+1).join("\n"),t=e.indexOf("{");-1!==t&&(r=JSON.parse(e.substring(t)))}if((null==r?void 0:r.version)&&(null==r?void 0:r.guests)){r.tables&&(r.tables=r.tables.map(e=>e.hasOwnProperty("seats")?e:{...e,seats:8})),r.hasOwnProperty("userSetTables")||(r.userSetTables=!0);const s=r.guests.length,a=on(e.subscription);return s>ln(e.subscription)&&!a?void u(!0):(S([]),C(!1),t({type:"SET_DUPLICATE_GUESTS",payload:[]}),a&&e.user&&Bn(e.user.id,!0),t({type:"IMPORT_STATE",payload:r}),t({type:"SET_LOADED_SAVED_SETTING",payload:!0}),n(""),m(null),void H())}{const r=s.map(e=>e.trim()).filter(e=>e&&!e.startsWith("#")).map(e=>{const t=e.split(",").map(e=>e.trim());return{name:t[0],count:parseInt(t[1])||1}}).filter(e=>e.name);if(!(r.length>0))throw new Error("No valid guest data found");{const s=on(e.subscription),a=ln(e.subscription),i=r.reduce((e,t)=>e+t.count,0);if(e.guests.reduce((e,t)=>e+t.count,0)+i>a&&!s)return void u(!0);const o=e.guests.map(e=>e.name.toLowerCase()),l=[],c=[];for(const e of r)o.includes(e.name.toLowerCase())?l.push(e.name):c.push(e);l.length>0?(S(l),t({type:"SET_DUPLICATE_GUESTS",payload:l}),C(!0)):(S([]),t({type:"SET_DUPLICATE_GUESTS",payload:[]}),C(!1)),c.length>0?(t({type:"ADD_GUESTS",payload:c}),n(""),m(null),H()):l.length>0&&m("All guests in the file are duplicates of existing guests.")}}}catch(i){console.error("Error parsing file:",i),m("Invalid file format. Please ensure it's a CSV file with the correct format.")}G.current&&(G.current.value="")},i.readAsText(a)},accept:".csv,.txt",className:"hidden"}),j.jsxs("button",{onClick:()=>{var e;return null==(e=G.current)?void 0:e.click()},className:"danstyle1c-btn inline-flex items-center justify-center px-4",style:{height:"70.2px",width:"36%"},children:[j.jsx(he,{className:"w-4 h-4 mr-2"}),"Upload Guests & Settings"]}),j.jsx("button",{onClick:Y,className:"danstyle1c-btn inline-flex items-center justify-center px-4",style:{height:"70.2px",width:"24%"},disabled:!oe&&e.guests.length>=de,children:"+ Add"})]}),!oe&&e.guests.length>=de&&j.jsx("div",{className:"p-3 bg-[#88abc6] border border-[#88abc6] rounded-md",children:j.jsxs("p",{className:"text-white font-medium",children:["You've reached the guest limit of ",de," for free accounts. Upgrade to Premium for unlimited guests."]})})]})})}):j.jsxs("div",{className:"flex items-stretch gap-6",children:[j.jsx("div",{className:"w-[40%] flex-shrink-0 bg-white rounded-lg shadow-md p-4 border border-[#566F9B] mt-2",children:j.jsxs("div",{className:"flex flex-col justify-between h-[256px]",children:[j.jsx("div",{className:"flex-1 flex flex-col justify-center",children:j.jsxs("div",{className:"text-right pr-4",children:[j.jsx("h3",{className:"font-bold text-[#566F9B] mb-2",style:{fontSize:"1.25em"},children:"For First-Time Users:"}),j.jsxs("div",{className:"space-y-2 text-sm text-[#566F9B]",style:{fontSize:"1.25em",lineHeight:"1.8"},children:[j.jsx("p",{children:'1.) Click "Load Test Guest List" button.'}),j.jsx("p",{children:'2.) Click "Your Rules" at the top.'}),j.jsx("p",{children:"3.) Pair and Prevent as you like."})]})]})}),j.jsx("div",{className:"flex justify-end pr-4",children:j.jsx("div",{className:"pulsing-arrow self-end translate-y-2",style:{fontSize:"36pt",animation:"pulseAndColor 2s ease-in-out infinite",animationIterationCount:5},"aria-hidden":!0,children:"➡️"})})]})}),j.jsx("div",{className:"flex-1 bg-white rounded-lg shadow-md p-4 border border-[#566F9B] mt-2",children:j.jsxs("div",{className:"flex flex-col h-[256px]",children:[j.jsxs("div",{className:"text-[1.05rem] text-gray-500 mt-2 space-y-1",children:[j.jsx("p",{children:"Enter guest names separated by commas or line breaks."}),j.jsx("p",{children:"Connect couples and parties with an ampersand (&)."})]}),j.jsx("div",{className:"mt-3 text-sm text-gray-600",children:!oe&&j.jsxs("p",{children:["Free plan: ",(e.guests??[]).reduce((e,t)=>e+Math.max(1,t.count??1),0),"/80 guests used"]})}),j.jsx("textarea",{value:r,onChange:e=>{n(e.target.value),k.length>0&&(S([]),t({type:"SET_DUPLICATE_GUESTS",payload:[]}),C(!1))},placeholder:"e.g., Alice, Bob\r\nCarol & David",className:"w-full px-3 py-2 border border-[#586D78] border-[1.5px] rounded-md focus:outline-none focus:ring-2 focus:ring-[#586D78] min-h-[80px] mt-2",rows:3,onKeyDown:e=>"Enter"===e.key&&e.ctrlKey&&Y()}),T&&j.jsxs("div",{className:"p-3 bg-[#88abc6] border border-[#88abc6] rounded-md relative mt-3",children:[j.jsxs("div",{className:"flex items-start pr-8",children:[j.jsx(E,{className:"text-white mr-2 mt-0.5 flex-shrink-0"}),j.jsxs("div",{children:[j.jsx("p",{className:"text-white font-medium",children:"Duplicate Guest Names Detected"}),j.jsx("p",{className:"text-white text-sm",children:"The following names already exist in your guest list and were not added:"}),j.jsx("ul",{className:"text-white text-sm mt-1 list-disc pl-5",children:k.map((e,t)=>j.jsx("li",{children:j.jsx(Vn,{name:e})},t))})]})]}),j.jsx("button",{className:"absolute top-2 right-2 text-white hover:text-white",onClick:ne,"aria-label":"Close warning",children:j.jsx(ge,{className:"w-5 h-5"})})]}),h&&j.jsx("div",{className:"text-red-600 text-sm mt-2",children:h}),j.jsxs("div",{className:"mt-auto pt-2 flex space-x-2",children:[j.jsxs("button",{onClick:()=>{X();t({type:"SET_GUESTS",payload:[{id:"guest_test_1",name:"Maria Garcia+1",count:2},{id:"guest_test_2",name:"James Johnson&1",count:2},{id:"guest_test_3",name:"Wei & Sara Chen",count:2},{id:"guest_test_4",name:"Sarah&Bobby Williams+1",count:3},{id:"guest_test_5",name:"Carlos Rodriguez+2",count:3},{id:"guest_test_6",name:"Emily Davis& 2",count:3},{id:"guest_test_7",name:"Raj Patel +1",count:2},{id:"guest_test_8",name:"Ashley Brown &1",count:2},{id:"guest_test_9",name:"Jose Martinez & Billy & Jessica Li",count:3},{id:"guest_test_10",name:"David Kim + 1",count:2},{id:"guest_test_11",name:"Michelle Jones+ 1",count:2},{id:"guest_test_12",name:"Luis Hernandez",count:1},{id:"guest_test_13",name:"Amanda %Zeta Taylor+ 2",count:3},{id:"guest_test_14",name:"Priya Sharma plus 1",count:2},{id:"guest_test_15",name:"Michael Miller + 2",count:3},{id:"guest_test_16",name:"Ana Macron plus 1",count:2},{id:"guest_test_17",name:"Christopher Anderson + 2",count:3},{id:"guest_test_18",name:"Mo Rashid",count:1},{id:"guest_test_19",name:"Cher",count:1},{id:"guest_test_20",name:"Tyler Goldberg+3",count:4},{id:"guest_test_21",name:"Stephanie Jackson",count:1},{id:"guest_test_22",name:"Arjun Gupta",count:1},{id:"guest_test_23",name:"Nicole White",count:1},{id:"guest_test_24",name:"Diego Ramirez",count:1},{id:"guest_test_25",name:"Samantha Harris",count:1},{id:"guest_test_26",name:"Jin Wang",count:1},{id:"guest_test_27",name:"Rachel Martin &2",count:3},{id:"guest_test_28",name:"Sergio Gambuto",count:1},{id:"guest_test_29",name:"Kayla & Daveed Lopez",count:2},{id:"guest_test_30",name:"Ravi Berns-Krishnan+wife",count:2},{id:"guest_test_31",name:"Kenji Nakamura+2",count:3},{id:"guest_test_32",name:"Megan Kaczmarek",count:1}]}),S([]),C(!1),t({type:"SET_DUPLICATE_GUESTS",payload:[]}),H()},className:"danstyle1c-btn inline-flex items-center justify-center",style:{height:"70.2px",width:"60%"},id:"loadTestGuestListBtn",children:[j.jsx("span",{className:"pulsing-arrow",id:"leftArrow",children:"➡️"}),j.jsx("span",{className:"mx-8",children:"Load Test Guest List"}),j.jsx("span",{className:"pulsing-arrow",id:"rightArrow",children:"⬅️"})]}),j.jsx("button",{onClick:Y,className:"danstyle1c-btn inline-flex items-center justify-center",style:{height:"70.2px",width:"40%"},disabled:!oe&&e.guests.length>=de,children:"+ Add"})]})]})})]}),j.jsxs("button",{className:"border border-indigo-200 rounded-md p-3 w-full flex justify-between items-center hover:bg-[#d7e5e5] transition-colors cursor-pointer",style:{backgroundColor:"#d7e5e5"},onClick:()=>{!M&&e.user&&K(),B(!M)},children:[j.jsxs("span",{className:"text-[#586D78] font-bold",children:[j.jsx(J,{className:"w-4 h-4 mr-2 inline-block"})," Saved Settings"]}),M?j.jsx(F,{className:"w-4 h-4 text-[#586D78]"}):j.jsx(U,{className:"w-4 h-4 text-[#586D78]"})]}),M&&j.jsx(Wn,{children:e.user?O?j.jsxs("div",{className:"text-center py-4",children:[j.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-500 mx-auto"}),j.jsx("p",{className:"mt-2 text-gray-600",children:"Loading saved settings..."})]}):R?j.jsx("div",{className:"bg-red-50 border border-red-200 rounded-md p-4 mb-4",children:j.jsxs("div",{className:"flex items-start",children:[j.jsx(E,{className:"text-red-600 mr-2 mt-0.5 flex-shrink-0"}),j.jsxs("div",{children:[j.jsx("p",{className:"text-red-700",children:R}),j.jsxs("button",{className:"danstyle1c-btn mt-2 text-sm",onClick:()=>K(),children:[j.jsx(ie,{className:"w-4 h-4 mr-2"}),"Try Again"]})]})]})}):0===A.length?j.jsx("div",{className:"text-center py-4 text-gray-500",children:"No saved settings found. Save your settings from the Seating Plan page."}):j.jsx("div",{className:"space-y-14 max-h-[400px] overflow-y-auto",children:A.map(e=>{var t,s;return j.jsx("div",{className:"border border-gray-200 rounded-lg p-4 hover:bg-gray-50 transition-colors cursor-pointer",onClick:()=>V(e),children:j.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[j.jsxs("div",{children:[j.jsx("h3",{className:"font-medium text-[#586D78]",children:e.name}),j.jsxs("p",{className:"text-xs text-gray-500",children:["Last modified: ",new Date(e.updated_at).toLocaleDateString()]}),(null==(t=e.data)?void 0:t.guests)&&j.jsxs("p",{className:"text-xs text-gray-600",children:[e.data.guests.length," guests • ",(null==(s=e.data.tables)?void 0:s.length)||0," tables"]})]}),j.jsxs("button",{className:"danstyle1c-btn",onClick:t=>{t.stopPropagation(),V(e)},children:[j.jsx(I,{className:"w-4 h-4 mr-2"}),"Load"]})]})},e.id)})}):j.jsxs("div",{className:"text-center py-4 bg-gray-50 rounded-lg border border-gray-200",children:[j.jsx("p",{className:"text-gray-600 mb-2",children:"Please log in to view your saved settings."}),j.jsx("button",{onClick:()=>c(!0),className:"danstyle1c-btn",children:"Log In / Sign Up"})]})}),j.jsx(Wn,{title:j.jsxs("div",{className:"w-full flex items-center justify-between",children:[j.jsxs("span",{children:["Guest List (",e.guests.reduce((e,t)=>e+t.count,0),oe?"":"/80",")"]}),j.jsxs("div",{className:"flex space-x-2",children:[j.jsxs("span",{className:"text-gray-700 font-medium flex items-center",children:[j.jsx(P,{className:"w-4 h-4 mr-1"}),"Sort:"]}),e.user&&j.jsx("button",{className:"as-entered"===y?"danstyle1c-btn selected":"danstyle1c-btn",onClick:()=>b("as-entered"),children:"As Entered"}),j.jsx("button",{className:"first-name"===y?"danstyle1c-btn selected":"danstyle1c-btn",onClick:()=>b("first-name"),children:"First Name"}),j.jsx("button",{className:"last-name"===y?"danstyle1c-btn selected":"danstyle1c-btn",onClick:()=>b("last-name"),children:"Last Name"}),e.user&&j.jsx("button",{className:`danstyle1c-btn ${"current-table"===y?"selected":""} ${0===e.seatingPlans.length?"opacity-50":""}`,onClick:()=>b("current-table"),disabled:0===e.seatingPlans.length,children:"Current Table"})]})]}),children:0===e.guests.length?j.jsxs("div",{className:"text-center",children:[j.jsx("p",{className:"text-gray-500 py-4",children:"Add some guests to get started."}),!oe&&j.jsx("div",{className:"mt-4",children:j.jsx("button",{onClick:re,className:"danstyle1c-btn",children:"Upgrade to Premium"})})]}):j.jsxs(j.Fragment,{children:[j.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:ce.map((s,r)=>{const n=e.guests.findIndex(e=>e.name===s.name);return j.jsxs("div",{className:"border border-[#586D78] border-[0.5px] rounded-lg p-4 flex flex-col items-start bg-white shadow",onDoubleClick:()=>Q(n),children:[p===n?j.jsx("input",{type:"text",value:f,autoFocus:!0,onChange:e=>x(e.target.value),onBlur:()=>ee(n),onKeyDown:e=>{"Enter"===e.key&&ee(n),"Escape"===e.key&&g(null)},className:"guest-name-input font-medium text-[#586D78] text-xl",style:{fontWeight:"bold"}}):j.jsxs("span",{className:"font-medium text-[#586D78] text-xl flex items-center break-words",onDoubleClick:()=>Q(n,s.name),style:{cursor:"pointer"},children:[j.jsx(Vn,{name:s.name}),j.jsx(te,{className:"w-3 h-3 ml-1 text-gray-400 cursor-pointer",onClick:()=>Q(n,s.name)})]}),s.count>1&&j.jsxs("span",{className:"text-sm text-gray-700 font-medium mt-1",children:["Party size: ",s.count," ",1===s.count?"person":"people"]}),(()=>{const t=(t=>{const s=e.guests.find(e=>e.name===t);if(!s)return{text:"Unassigned",type:"none"};if(e.assignments&&e.assignments[s.id])return{text:e.assignments[s.id].split(",").map(e=>e.trim()).map(t=>{const s=parseInt(t);if(!isNaN(s)){const t=e.tables.find(e=>e.id===s);return(null==t?void 0:t.name)?`${t.name} (${s})`:`Table ${s}`}return t}).join(", "),type:"assigned"};if(e.assignments&&e.assignments[t])return{text:e.assignments[t].split(",").map(e=>e.trim()).map(t=>{const s=parseInt(t);if(!isNaN(s)){const t=e.tables.find(e=>e.id===s);return(null==t?void 0:t.name)?`${t.name} (${s})`:`Table ${s}`}return t}).join(", "),type:"assigned"};if(e.seatingPlans&&e.seatingPlans.length>0){const s=e.seatingPlans[e.currentPlanIndex];for(const r of s.tables)if(r.seats.find(e=>e.name===t)){const t=e.tables.find(e=>e.id===r.id);return{text:(null==t?void 0:t.name)?`${t.name} (${r.id})`:`Table ${r.id}`,type:"plan"}}}return{text:"Unassigned",type:"none"}})(s.name);return j.jsxs("span",{className:"text-sm text-gray-700 mt-1 "+("assigned"===t.type?"font-normal":"plan"===t.type?"font-normal opacity-65":"font-normal opacity-40"),children:["Table: ",t.text]})})(),j.jsx("div",{className:"flex space-x-2 mt-3",children:j.jsxs("button",{className:"danstyle1c-btn danstyle1c-remove btn-small",onClick:()=>(e=>{t({type:"REMOVE_GUEST",payload:e}),H(),S([]),t({type:"SET_DUPLICATE_GUESTS",payload:[]}),C(!1)})(n),children:[j.jsx(ue,{className:"w-3 h-3 mr-1"}),"Remove"]})})]},`${s.name}-${r}`)})}),le&&j.jsxs("div",{className:"mt-4 p-4 bg-indigo-50 rounded-lg",children:[j.jsx("p",{className:"text-[#586D78]",children:"You're approaching the 80 guest limit. Upgrade to Premium for unlimited guests!"}),j.jsx("div",{className:"mt-2",children:j.jsx("button",{onClick:re,className:"danstyle1c-btn",children:"Upgrade to Premium"})})]}),j.jsx("div",{className:"mt-4 flex justify-end",children:j.jsxs("button",{className:"danstyle1c-btn danstyle1c-remove",onClick:()=>{o(!0)},children:[j.jsx(ue,{className:"w-4 h-4 mr-2"}),"Clear Guest List"]})})]})}),j.jsxs("div",{className:"bg-blue-50 border border-indigo-200 rounded-md p-4 flex items-start",children:[j.jsx(Z,{className:"text-[#586D78] mr-2 mt-1 flex-shrink-0"}),j.jsxs("div",{children:[j.jsxs("p",{className:"text-gray-700",children:[j.jsx("strong",{children:"NOTE:"}),' For names with 3 or more words (e.g., "Tatiana Sokolov Boyko", "Jan Tomasz Kowalski Nowak", "Angel Alba Salavador Costa Almeida"), if you want one of those surnames (other than the "last" word of the last name) to be the alphabetical sorting word "By Last Name" then put a percentage symbol (',j.jsx("span",{style:{color:"#959595"},children:"%"}),") before that name."]}),j.jsxs("p",{className:"text-gray-700 mt-1",children:['Examples: "Tatiana ',j.jsx("span",{style:{color:"#959595"},children:"%"}),'Sokolov Boyko", "Jan Tomasz ',j.jsx("span",{style:{color:"#959595"},children:"%"}),'Kowalski Nowak", "Angel Alba Salavador ',j.jsx("span",{style:{color:"#959595"},children:"%"}),'Costa Almeida"']})]})]}),j.jsxs("div",{className:"w-full mt-10 bg-[#fff4cd] border-2 border-[#586D78] rounded-xl p-6",children:[j.jsx("h2",{className:"text-lg font-bold text-[#586D78] mb-4",children:"Seatyr's Favorite Sites — August 2025:"}),j.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-x-6 gap-y-2 text-sm text-gray-800 list-disc list-inside",children:[j.jsxs("ul",{children:[j.jsx("li",{children:j.jsx("a",{href:"https://Zingermans.com",target:"_blank",rel:"noopener noreferrer",children:"https://Zingermans.com"})}),j.jsx("li",{children:j.jsx("a",{href:"https://Zabars.com",target:"_blank",rel:"noopener noreferrer",children:"https://Zabars.com"})})]}),j.jsxs("ul",{children:[j.jsx("li",{children:j.jsx("a",{href:"https://BigBobGibson.com",target:"_blank",rel:"noopener noreferrer",children:"https://BigBobGibson.com"})}),j.jsx("li",{children:j.jsx("a",{href:"https://linktr.ee/immortalitybytes",target:"_blank",rel:"noopener noreferrer",children:"https://linktr.ee/immortalitybytes"})})]}),j.jsxs("ul",{children:[j.jsx("li",{children:j.jsx("a",{href:"https://MadGreens.com",target:"_blank",rel:"noopener noreferrer",children:"https://MadGreens.com"})}),j.jsx("li",{children:j.jsx("a",{href:"https://HubermanLab.com",target:"_blank",rel:"noopener noreferrer",children:"https://HubermanLab.com"})})]})]})]}),a&&j.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:j.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full shadow-2xl",children:[j.jsx("h3",{className:"text-xl font-bold mb-4",children:"Confirm Clear Guest List"}),j.jsx("p",{className:"text-gray-700 mb-6",children:"This will remove all guests and reset all constraints, assignments, and seating plans. This action cannot be undone."}),j.jsxs("div",{className:"flex justify-end space-x-2",children:[j.jsx("button",{className:"danstyle1c-btn",onClick:()=>o(!1),children:"Cancel"}),j.jsx("button",{className:"danstyle1c-btn danstyle1c-remove",onClick:()=>{t({type:"CLEAR_GUESTS"}),o(!1),on(e.subscription)&&e.user&&Bn(e.user.id,!0),localStorage.setItem("seatyr_current_setting_name","Unsaved"),S([]),t({type:"SET_DUPLICATE_GUESTS",payload:[]}),C(!1)},children:"Clear All Data"})]})]})}),l&&j.jsx(_n,{onClose:()=>c(!1)}),d&&j.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:j.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full shadow-2xl",children:[j.jsx("h3",{className:"text-xl font-bold mb-4",children:"Guest Limit Reached"}),j.jsx("p",{className:"text-gray-700 mb-6",children:"You've reached the guest limit for free accounts. Upgrade to Premium for unlimited guests."}),j.jsxs("div",{className:"flex justify-end space-x-2",children:[j.jsx("button",{className:"danstyle1c-btn",onClick:()=>u(!1),children:"Cancel"}),j.jsx("button",{className:"danstyle1c-btn",onClick:re,children:"Upgrade to Premium"})]})]})})]})};if("undefined"!=typeof window){const e=document.createElement("style");e.textContent="\n    @keyframes pulseAndColor {\n      0% { \n        transform: scale(1); \n        filter: hue-rotate(0deg) saturate(1) brightness(1);\n      }\n      25% { \n        transform: scale(1.2); \n        filter: hue-rotate(90deg) saturate(1.5) brightness(1.2);\n      }\n      50% { \n        transform: scale(1.4); \n        filter: hue-rotate(180deg) saturate(2) brightness(1.4);\n      }\n      75% { \n        transform: scale(1.2); \n        filter: hue-rotate(270deg) saturate(1.5) brightness(1.2);\n      }\n      100% { \n        transform: scale(1); \n        filter: hue-rotate(360deg) saturate(1) brightness(1);\n      }\n    }\n  ",document.querySelector("#pulsing-arrow-styles")||(e.id="pulsing-arrow-styles",document.head.appendChild(e))}const Yn=e=>(e=>(e||"").normalize("NFC").trim())(e).replace(/\s+/g," ");class Jn{constructor(e=12345){t(this,"x"),this.x=e>>>0||2654435769}nextU32(){let e=this.x>>>0;return e^=e<<13,e>>>=0,e^=e>>17,e>>>=0,e^=e<<5,e>>>=0,this.x=e,e>>>0}next(){return(4294967295&this.nextU32())/4294967296}shuffle(e){for(let t=e.length-1;t>0;t--){const s=Math.floor(this.next()*(t+1));[e[t],e[s]]=[e[s],e[t]]}}}class Xn{constructor(){t(this,"parent",new Map),t(this,"rank",new Map)}find(e){const t=this.parent.get(e);if(!t||t===e)return this.parent.set(e,e),this.rank.set(e,this.rank.get(e)??0),e;const s=this.find(t);return this.parent.set(e,s),s}union(e,t){if(e===t)return;const s=this.find(e),r=this.find(t);if(s===r)return;const n=this.rank.get(s)??0,a=this.rank.get(r)??0;n<a?this.parent.set(s,r):n>a?this.parent.set(r,s):(this.parent.set(r,s),this.rank.set(s,n+1))}}function Zn(e){const t=[],s=[],r=new Set;for(const a of e||[])try{const e=String((null==a?void 0:a.id)??"").trim();if(!e){s.push({kind:"invalid_input_data",message:"Guest missing or invalid id",details:{guest:a}});continue}if(r.has(e)){s.push({kind:"invalid_input_data",message:`Duplicate guest id: ${e}`,details:{guest:a}});continue}const n=String((null==a?void 0:a.name)??"").trim()||`Guest ${e}`,i=Math.max(1,Math.floor(Number(null==a?void 0:a.count)||1));t.push({id:e,name:n,count:i}),r.add(e)}catch(n){s.push({kind:"invalid_input_data",message:"Failed to parse guest",details:{guest:a,error:n instanceof Error?n.message:String(n)}})}return{guests:t,errors:s}}function Qn(e){const t=[],s=[],r=new Set;for(const a of e||[])try{const e=String((null==a?void 0:a.id)??"").trim();if(!e){s.push({kind:"invalid_input_data",message:"Table missing or invalid id",details:{table:a}});continue}if(r.has(e)){s.push({kind:"invalid_input_data",message:`Duplicate table id: ${e}`,details:{table:a}});continue}const n=String((null==a?void 0:a.name)??"").trim()||`Table ${e}`,i=Math.max(1,Math.floor(Number((null==a?void 0:a.capacity)??(null==a?void 0:a.seats))||1));t.push({id:e,name:n,capacity:i}),r.add(e)}catch(n){s.push({kind:"invalid_input_data",message:"Failed to parse table",details:{table:a,error:n instanceof Error?n.message:String(n)}})}return{tables:t,errors:s}}function ea(e){const t=[],s=[];if(!e)return{mustPairs:t,cantPairs:s};for(const r of Object.keys(e)){const n=e[r]||{};for(const e of Object.keys(n)){const a=n[e];r!==e&&("must"===a?t.push([String(r),String(e)]):"cannot"===a&&s.push([String(r),String(e)]))}}return{mustPairs:sa(t),cantPairs:sa(s)}}function ta(e){const t=[];if(e)for(const s of Object.keys(e))for(const r of e[s]||[])s!==r&&t.push([String(s),String(r)]);return{pairs:sa(t)}}function sa(e){const t=new Set,s=[];for(const[r,n]of e){const e=String(r),a=String(n),i=e<a?`${e}|${a}`:`${a}|${e}`;t.has(i)||(t.add(i),s.push([e,a]))}return s}function ra(e){const t=new Map;for(const[s,r]of e)s!==r&&(t.has(s)||t.set(s,new Set),t.has(r)||t.set(r,new Set),t.get(s).add(r),t.get(r).add(s));return t}function na(e,t){var s;return(null==(s=e.get(t))?void 0:s.size)??0}function aa(e,t,s,r,n){var a;const i=[],o=new Map(e.map(e=>[e.id,e])),l=new Map(t.map(e=>[e.id,e])),c=ra(s.cantPairs),d=ra(r.pairs),u=new Xn;for(const x of e)u.find(x.id);for(const[x,y]of s.mustPairs)u.union(x,y);const h=new Map;for(const x of e){const e=u.find(x.id);h.has(e)||h.set(e,{root:e,members:[],size:0,cantNeighbors:new Set,adjacencyDegree:0});const t=h.get(e);t.members.push(x.id),t.size+=x.count,t.adjacencyDegree+=na(d,x.id)}for(const x of h.values()){for(const e of x.members)for(const t of c.get(e)||[])x.cantNeighbors.add(t);for(let e=0;e<x.members.length;e++)for(let t=e+1;t<x.members.length;t++){const s=x.members[e],r=x.members[t];(null==(a=c.get(s))?void 0:a.has(r))&&i.push({kind:"cant_within_must_group",message:"CANNOT within MUST group",details:{group:x.members,pair:[s,r]}})}}for(const x of h.values()){const e=new Set;for(const t of x.members){const s=n[t];if(!s)continue;const r=(Array.isArray(s)?s:String(s).split(/[\s,]+/).filter(Boolean)).find(e=>l.has(String(e)));r&&e.add(String(r))}e.size>1?i.push({kind:"assignment_conflict",message:"Conflicting preassignments in group",details:{group:x.members,tables:Array.from(e)}}):1===e.size&&(x.preassignedTable=Array.from(e)[0])}for(const[x,y]of d.entries())y.size>2&&i.push({kind:"adjacency_degree_violation",message:`Adjacency degree > 2 for ${x}`,details:{id:x,degree:y.size}});const m=Math.max(0,...t.map(e=>e.capacity));i.push(...function(e,t,s){const r=[],n=new Set,a=Array.from(e.keys());for(const i of a){if(n.has(i))continue;const a=[],o=[i];n.add(i);let l=0;for(;l<o.length;){const t=o[l++];a.push(t);for(const s of e.get(t)||[])n.has(s)||(n.add(s),o.push(s))}if(a.length<=2)continue;if(!a.every(t=>2===na(e,t)))continue;const c=a.reduce((e,s)=>{var r;return e+((null==(r=t.get(s))?void 0:r.count)??1)},0);c>s&&r.push({kind:"adjacency_closed_loop_too_big",message:`An adjacency loop requires ${c} seats, but the largest table only has ${s}.`,details:{ids:a}})}return r}(d,o,m));for(const x of h.values())x.size>m&&i.push({kind:"group_too_big_for_any_table",message:`Group size ${x.size} exceeds max table capacity ${m}`,details:{group:x.members}});const p=new Set(e.map(e=>e.id)),g=(e,t)=>e.forEach(([e,s])=>{e===s&&i.push({kind:"self_reference_ignored",message:`Ignored self reference in ${t}: ${e}`})});g(s.mustPairs,"must"),g(s.cantPairs,"cannot"),g(r.pairs,"adjacent");const f=(e,t)=>e.forEach(([e,s])=>{p.has(e)&&p.has(s)||i.push({kind:"unknown_guest",message:`Unknown guest in ${t}: ${e}-${s}`})});f(s.mustPairs,"must"),f(s.cantPairs,"cannot"),f(r.pairs,"adjacent");for(const x of Object.keys(n))p.has(x)||i.push({kind:"unknown_guest",message:`Unknown assignment guest: ${x}`});return{groups:Array.from(h.values()).sort((e,t)=>{const s=e.size+e.cantNeighbors.size+e.adjacencyDegree-(e.preassignedTable?1e3:0);return t.size+t.cantNeighbors.size+t.adjacencyDegree-(t.preassignedTable?1e3:0)-s}),errors:i,ctx:{idToGuest:o,idToTable:l},cantMap:c,adjMap:d}}function ia(e,t,s){if(e.size>t.remaining)return!1;for(const r of e.members){const e=s.get(r);if(e)for(const s of t.occupants)if(e.has(s))return!1}return!0}function oa(e,t,s,r,n,a,i){const o={placed:new Map,tables:t.map(e=>({table:e,remaining:e.capacity,occupants:[]}))};let l=0;for(const d of e){if(!d.preassignedTable)continue;const e=o.tables.find(e=>e.table.id===d.preassignedTable);if(!e)return{success:!1,state:o,attempts:l};if(!ia(d,e,s))return{success:!1,state:o,attempts:l};e.remaining-=d.size,e.occupants.push(...d.members);for(const t of d.members)o.placed.set(t,e.table.id)}const c=function t(c){if(Date.now()>i||l>a)return!1;if(c>=e.length)return!0;const d=e[c];if(d.preassignedTable&&d.members.every(e=>o.placed.has(e)))return t(c+1);const u=[],h=new Set;for(const e of d.members)for(const t of r.get(e)||[])h.add(t);for(const e of o.tables){if(!ia(d,e,s))continue;let t=0;for(const s of e.occupants)h.has(s)&&t++;u.push({ts:e,score:10*t-(e.remaining-d.size)})}if(!u.length)return!1;u.sort((e,t)=>t.score-e.score||e.ts.table.id.localeCompare(t.ts.table.id));let m=0;const p=[];for(;m<u.length;){let e=m+1;for(;e<u.length&&u[e].score===u[m].score;)e++;const t=u.slice(m,e).map(e=>e.ts);n.shuffle(t),p.push(...t),m=e}for(const e of p){l++,e.remaining-=d.size,e.occupants.push(...d.members);for(const t of d.members)o.placed.set(t,e.table.id);if(t(c+1))return!0;e.remaining+=d.size;const s=new Set(d.members);e.occupants=e.occupants.filter(e=>!s.has(e));for(const e of d.members)o.placed.delete(e)}return!1}(0);return{success:c,state:o,attempts:l}}function la(e,t){var s,r;if(e.length<=1)return e.slice();const n=e.slice().sort((e,s)=>na(t,s)-na(t,e)||e.localeCompare(s))[0],a=new Set(e);a.delete(n);const i=[n];for(;a.size>0;){const e=i[i.length-1];let n=[...t.get(e)||[]].find(e=>a.has(e));if(!n){let o;for(const n of a){let a=((null==(s=t.get(n))?void 0:s.has(e))?1:0)+((null==(r=t.get(n))?void 0:r.has(i[0]))?1:0)+.01*na(t,n);(!o||a>o.gain||a===o.gain&&n<o.id)&&(o={id:n,gain:a})}n=o.id}i.push(n),a.delete(n)}let o=i.slice(),l=ca(o,t);for(let c=1;c<i.length;c++){const e=i.slice(c).concat(i.slice(0,c)),s=ca(e,t);s>l&&(l=s,o=e)}return o}function ca(e,t){var s,r;if(e.length<2)return 1;let n=0;const a=new Set(e),i=new Set;for(const c of a)for(const e of t.get(c)||[])if(a.has(e)){const t=c<e?`${c}|${e}`:`${e}|${c}`;i.has(t)||(i.add(t),n++)}if(0===n)return 1;let o=0;const l=new Set;for(let c=0;c<e.length;c++){const n=e[c],a=e[(c+1)%e.length],i=n<a?`${n}|${a}`:`${a}|${n}`;!(null==(s=t.get(n))?void 0:s.has(a))&&!(null==(r=t.get(a))?void 0:r.has(n))||l.has(i)||(l.add(i),o++)}return o/n}function da(e,t,s,r){const n=new Map;for(const[h,m]of e.placed)n.has(m)||n.set(m,[]),n.get(m).push(h);const a=[];let i=0,o=0,l=0,c=0,d=0,u=0;for(const h of t)c+=h.capacity;for(const h of t){const e=n.get(h.id)||[];if(0===e.length){a.push({tableId:h.id,seats:[]});continue}const t=new Map;for(const s of e){const n=new Set(Array.from(r.get(s)||[]).filter(t=>e.includes(t)));n.size>0&&t.set(s,n)}const c=la(e,t),m=[];for(const r of c){const e=s.get(r);for(let t=0;t<e.count;t++)m.push({name:e.name,partyIndex:t})}l+=m.length;i+=ca(c,t),o++;const p=h.capacity>0?m.length/h.capacity:1;d+=Math.abs(.8-p),u++,a.push({tableId:h.id,seats:m})}return{planTables:a,adjSat:o>0?i/o:1,capUtil:c>0?l/c:1,balance:u>0?1-d/u:1,byTable:n}}async function ua(e,t,s,r,n,a=!1){console.time("SeatingGeneration");try{const i=e,o=t.map(e=>({id:e.id,name:e.name??void 0,seats:e.seats,capacity:e.seats})),l=new Map;e.forEach(e=>{l.set(e.name,e.id)});const c={};Object.entries(s??{}).forEach(([e,t])=>{const s=l.get(e);s&&(c[s]={},Object.entries(t).forEach(([e,t])=>{const r=l.get(e);r&&(c[s][r]=t)}))});const d={};Object.entries(r??{}).forEach(([e,t])=>{const s=l.get(e);s&&(d[s]=t.map(e=>l.get(e)||e))});const u={};Object.entries(n??{}).forEach(([t,s])=>{let r=t;if(e.some(e=>e.id===t)||(r=l.get(t)||""),r&&s){const e=String(s).split(",").map(e=>e.trim()).filter(Boolean).map(e=>String(e));e.length>0&&(u[r]=e)}});const h=await async function(e,t,s,r,n={},a=!1){const i=Date.now(),o=12345,l=a?3500:1500,c=a?30:10,d=7500,u=3,h={adj:.6,util:.3,balance:.1},{guests:m,errors:p}=Zn(e),{tables:g,errors:f}=Qn(t),x=ea(s),y=ta(r),b=[...p,...f],{groups:v,errors:w,ctx:j,cantMap:_,adjMap:N}=aa(m,g,x,y,n),S=[...b,...w],k=S.filter(e=>"self_reference_ignored"!==e.kind);if(k.length>0)return{plans:[],errors:k};const E=new Jn(o),T=i+l,C=new Map,P=Math.max(c*u,c+5),A=e=>{let t=0;const s=Array.from(e.keys()).sort();for(const r of s){for(let e=0;e<r.length;e++)t=(t<<5)-t+r.charCodeAt(e)|0;const s=(e.get(r)||[]).slice().sort();for(const e of s)for(let s=0;s<e.length;s++)t=(t<<5)-t+e.charCodeAt(s)|0}return 0|t};for(let I=0;I<P&&!(Date.now()>T||C.size>=c);I++){const e=E.nextU32(),t=new Jn(e),s=Math.min(T,Date.now()+Math.max(60,Math.floor(l/P))),{success:r,state:n,attempts:a}=oa(v,g,_,N,t,d,s);if(!r)continue;const{planTables:i,adjSat:o,capUtil:c,balance:u,byTable:m}=da(n,g,j.idToGuest,N),p=A(m),f=h.adj*o+h.util*c+h.balance*u,x=C.get(p);if(x&&(x.score??0)>=f)continue;const y={tables:i,score:f,adjacencySatisfaction:o,capacityUtilization:c,balance:u,seedUsed:e,attemptsUsed:a};C.set(p,y)}return{plans:Array.from(C.values()).sort((e,t)=>(t.score??0)-(e.score??0)),errors:S}}(i,o,c,d,u,a),m=h.plans.map(e=>({id:pa(e),tables:e.tables.map(e=>{const s=t.find(t=>String(t.id)===e.tableId);return{id:Number(e.tableId),capacity:(null==s?void 0:s.seats)??0,seats:e.seats}})})),p=h.errors.map(e=>{var t,s;return{type:ma(e.kind),message:e.message,...(null==(s=null==(t=import.meta)?void 0:t.env)?void 0:s.DEV)&&{_originalKind:e.kind,_details:e.details}}});return console.timeEnd("SeatingGeneration"),{plans:m,errors:p}}catch(i){return console.error("The seating algorithm engine encountered a fatal error:",i,i instanceof Error?i.stack:""),console.timeEnd("SeatingGeneration"),{plans:[],errors:[{type:"error",message:"A critical error occurred in the seating algorithm."}]}}}const ha=new Map;function ma(e){if(!ha.has(e))switch(e){case"self_reference_ignored":case"invalid_input_data":ha.set(e,"warn");break;default:ha.set(e,"error")}return ha.get(e)}function pa(e){if(e.seedUsed)return e.seedUsed>>>0;let t=0;for(const s of e.tables.sort((e,t)=>e.tableId.localeCompare(t.tableId))){for(let r=0;r<s.tableId.length;r++)t=(t<<5)-t+s.tableId.charCodeAt(r)|0;const e=s.seats.map(e=>`${e.name}:${e.partyIndex}`).sort().join(",");for(let s=0;s<e.length;s++)t=(t<<5)-t+e.charCodeAt(s)|0}return t>>>0}function ga(e,t,s,r,n){let a,i,o,l;Array.isArray(e)&&"object"==typeof t&&!Array.isArray(t)&&Array.isArray(s)?(a=e,o=t,i=s,l=("object"==typeof r?r:n)||{}):(a=e,i=t,o=s||{},l=r||{});const c=a,d=i.map(e=>({id:e.id,name:e.name??void 0,seats:e.seats,capacity:e.seats})),u=new Map;a.forEach(e=>{u.set(e.name,e.id)});const h={};Object.entries(o??{}).forEach(([e,t])=>{const s=u.get(e);s&&(h[s]={},Object.entries(t).forEach(([e,t])=>{const r=u.get(e);r&&(h[s][r]=t)}))});const m={};Object.entries(l??{}).forEach(([e,t])=>{const s=u.get(e);s&&(m[s]=t.map(e=>u.get(e)||e))});const p=function(e,t,s,r,n){const{guests:a,errors:i}=Zn(e),{tables:o,errors:l}=Qn(t),c=ea(s),d=ta(r),{errors:u}=aa(a,o,c,d,n);return[...i,...l,...u]}(c,d,h,m,{});return p.map(e=>{var t,s;return{type:ma(e.kind),message:e.message,...(null==(s=null==(t=import.meta)?void 0:t.env)?void 0:s.DEV)&&{_originalKind:e.kind,_details:e.details}}})}const fa=({isDefaultOpen:e=!1})=>{const{state:t,dispatch:r}=jn(),[n,a]=s.useState([]),[o,l]=s.useState(!0),[c,d]=s.useState(null),[u,h]=s.useState(!1),[m,p]=s.useState(""),[g,f]=s.useState(!1),[x,y]=s.useState(!1),[b,v]=s.useState(null),[w,_]=s.useState(!1),[N,S]=s.useState(null),[k,T]=s.useState(null),[C,P]=s.useState(e),[A,I]=s.useState(null),[D,O]=s.useState(""),[$,R]=s.useState(null),[L,M]=s.useState(!1),B=s.useRef(null),q=i(),{user:z,subscription:G}=t;s.useEffect(()=>{C&&(z||b)&&K()},[C,z,b]),s.useEffect(()=>{(async()=>{var e;if(!z)try{_(!0),S(null);const{data:s,error:n}=await sn.auth.getSession();if(n)return console.error("Error fetching session:",n),void S("Failed to verify authentication. Please try again or log in.");const a=null==(e=null==s?void 0:s.session)?void 0:e.user;if(a){console.log("Found authenticated user in session:",a.id),v(a),r({type:"SET_USER",payload:a});try{const{data:e,error:t}=await sn.from("subscriptions").select("*").eq("user_id",a.id).order("current_period_end",{ascending:!1}).limit(1);!t&&e&&e.length>0&&r({type:"SET_SUBSCRIPTION",payload:e[0]})}catch(t){console.error("Error fetching subscription data:",t)}}else console.log("No authenticated user found in session")}catch(t){console.error("Error checking session:",t),S("Failed to verify your session. Please try again later.")}finally{_(!1)}})()},[z,r]),s.useEffect(()=>{function e(e){B.current&&!B.current.contains(e.target)&&Y()}return A?document.addEventListener("mousedown",e):document.removeEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[A]);const K=async()=>{try{if(!(z||b))return a([]),void l(!1);l(!0),d(null);const{data:e,error:t}=await sn.from("saved_settings").select("*").order("updated_at",{ascending:!1});if(t){if(401===t.status)throw console.error("Session expired when loading settings"),S("Your session has expired. Please log in again."),v(null),r({type:"SET_USER",payload:null}),new Error("Session expired");throw console.error("Error loading settings:",t),t}console.log("Loaded settings:",(null==e?void 0:e.length)||0),a(e||[])}catch(e){d("Failed to load saved settings. Please try again or refresh the page."),console.error(e)}finally{l(!1)}},V=async(e,s)=>{if(s&&s.stopPropagation(),!A&&!L)try{if(!e.data)throw new Error("Saved setting data is missing or corrupted");if(!function(e,t){var s;return!(null==(s=null==e?void 0:e.data)?void 0:s.guests)||!!on(t)||e.data.guests.length<=ln(t)}(e,t.subscription))throw new Error(`This setting contains ${e.data.guests.length} guests, which exceeds the free account limit of 80 guests. Upgrade to Premium to load this setting.`);e.data.tables&&(e.data.tables=e.data.tables.map(e=>e.hasOwnProperty("seats")?e:{...e,seats:8})),e.data.hasOwnProperty("userSetTables")||(e.data.userSetTables=!0),localStorage.setItem("seatyr_current_setting_name",e.name),r({type:"IMPORT_STATE",payload:e.data}),r({type:"SET_LOADED_SAVED_SETTING",payload:!0}),await sn.from("saved_settings").update({updated_at:(new Date).toISOString()}).eq("id",e.id),q("/seating")}catch(n){console.error("Failed to load settings:",n),T("Failed to load settings: "+(n.message||"Unknown error"))}},H=e=>{O(e.target.value),R(null)},Y=async()=>{if(!A)return;const e=D.trim();if(!e)return void I(null);const t=n.find(e=>e.id===A);if(t&&e!==t.name){R(null);try{const{error:s}=await sn.from("saved_settings").update({name:e}).eq("id",A);if(s)throw 401===s.status?new Error("Your session has expired. Please log in again."):s;localStorage.getItem("seatyr_current_setting_name")===t.name&&localStorage.setItem("seatyr_current_setting_name",e),I(null),M(!0),setTimeout(()=>{M(!1)},2e3),await K()}catch(s){console.error("Failed to rename settings:",s),R(s.message||"Failed to rename settings")}}else I(null)},X=e=>{"Enter"===e.key?Y():"Escape"===e.key&&(I(null),R(null))},Z=on(G),Q=cn(Z?{status:"active"}:null),ee=z||b,te=localStorage.getItem("seatyr_current_setting_name")||null,se=t.loadedSavedSetting&&0===t.seatingPlans.length;return j.jsxs("div",{className:"mt-6",children:[j.jsxs("div",{className:"flex justify-between items-center p-3 rounded-md bg-[#D7E5E5] cursor-pointer",onClick:()=>{P(e=>!e)},children:[j.jsxs("h2",{className:"text-lg font-bold text-[#586D78] flex items-center",children:[j.jsx(J,{className:"mr-2 h-5 w-5"}),"Saved Settings"]}),j.jsx("div",{className:"flex items-center space-x-2",children:C?j.jsx(F,{className:"h-5 w-5 text-[#586D78]"}):j.jsx(U,{className:"h-5 w-5 text-[#586D78]"})})]}),C&&j.jsx("div",{className:"mt-4 space-y-4 p-4 bg-[#D7E5E5] rounded-md",children:ee||w?w?j.jsx(Wn,{children:j.jsxs("div",{className:"text-center py-4",children:[j.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-[#586D78] mx-auto mb-4"}),j.jsx("p",{className:"text-gray-600",children:"Verifying your account..."})]})}):j.jsxs(j.Fragment,{children:[j.jsxs("div",{className:"space-y-4",children:[j.jsx("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-2",children:j.jsxs("p",{className:"text-gray-700",children:["Save and manage your seating arrangements.",Z?" Premium users can save up to 50 configurations.":` Free users can save up to ${Q} configurations. Premium users can save up to 50.`]})}),j.jsxs("button",{className:"danstyle1c-btn",onClick:()=>h(!0),disabled:Z?n.length>=50:n.length>=Q,children:[j.jsx(oe,{className:"w-4 h-4 mr-2"}),"Save Current Settings"]}),c&&j.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-md p-3 flex items-start",children:[j.jsx(E,{className:"w-5 h-5 text-red-500 mr-2 flex-shrink-0 mt-0.5"}),j.jsx("p",{className:"text-red-700",children:c})]}),!Z&&n.length>=Q&&j.jsx("div",{className:"bg-indigo-50 border border-indigo-200 rounded-md p-3",children:j.jsxs("p",{className:"text-indigo-700",children:["You've reached your limit of ",Q," saved settings.",j.jsx("span",{className:"font-bold",children:" Upgrade to Premium for more saved settings!"})]})})]}),j.jsxs("div",{className:"mt-4",children:[j.jsx("h3",{className:"text-lg font-medium text-[#586D78] mb-4",children:"Saved Configurations"}),o?j.jsxs("div",{className:"text-center py-4",children:[j.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-500 mx-auto"}),j.jsx("p",{className:"mt-2 text-gray-600",children:"Loading saved settings..."})]}):0===n.length?j.jsx("div",{className:"text-center py-4 text-gray-500",children:'No saved settings yet. Click "Save Current Settings" to create your first configuration.'}):j.jsxs("div",{className:"space-y-4",children:[k&&j.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-md p-3 flex items-start",children:[j.jsx(E,{className:"w-5 h-5 text-red-500 mr-2 flex-shrink-0 mt-0.5"}),j.jsx("p",{className:"text-red-700",children:k})]}),n.map(e=>{var t,s,a,i;const o=!on(G)&&(null==(s=null==(t=e.data)?void 0:t.guests)?void 0:s.length)>80;let l="border border-gray-200";e.name===te&&(l=se?"border-2 border-[#d1d5db]":"border-2 border-[#06b6d4]");const c=A===e.id,d=o?"opacity-50 cursor-not-allowed pointer-events-none":"";return j.jsx("div",{className:`${l} rounded-lg p-4 bg-white hover:bg-gray-50 transition-colors cursor-pointer ${d} ${L?"pointer-events-none opacity-90":""}`,onClick:()=>!c&&!o&&V(e),children:j.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[j.jsxs("div",{className:"relative",children:[c?j.jsxs("div",{className:"mb-2",children:[j.jsx("input",{type:"text",value:D,onChange:H,onBlur:Y,onKeyDown:X,className:"px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-[#586D78] w-full "+($?"border-red-300 bg-red-50":"border-[#586D78]"),autoFocus:!0,onClick:e=>e.stopPropagation(),ref:B}),$&&j.jsx("p",{className:"text-red-600 text-xs mt-1",children:$})]}):j.jsx("div",{className:"font-medium text-[#586D78] relative",onDoubleClick:t=>((e,t,s)=>{e.stopPropagation(),L||(I(t),O(s),R(null))})(t,e.id,e.name),style:{padding:"25px 15px",margin:"-25px -15px",display:"inline-block",position:"relative",zIndex:10},onClick:e=>e.stopPropagation(),children:e.name}),j.jsxs("p",{className:"text-sm text-gray-500",children:["Last modified: ",new Date(e.updated_at).toLocaleDateString()]}),(null==(a=e.data)?void 0:a.guests)&&j.jsxs("p",{className:"text-sm text-gray-600",children:[e.data.guests.length," guests • ",(null==(i=e.data.tables)?void 0:i.length)||0," tables",o&&j.jsx("span",{className:"ml-2 text-red-500 font-medium",children:"Exceeds free guest limit"})]}),o&&j.jsx("div",{className:"absolute right-0 top-0 bg-red-50 text-red-600 rounded-full p-1",title:"This setting has more than 80 guests and requires a Premium account to load.",children:j.jsx(E,{className:"w-5 h-5"})})]}),j.jsxs("div",{className:"flex flex-wrap gap-2",children:[j.jsxs("button",{className:"danstyle1c-btn bg-[#586D78] text-white "+(o?"opacity-50 cursor-not-allowed":""),onClick:t=>{t.stopPropagation(),o||V(e,t)},disabled:o||L,title:o?"Upgrade to Premium to load settings with more than 80 guests":"Load this setting",children:[j.jsx(J,{className:"w-4 h-4 mr-2"}),"Load"]}),j.jsxs("button",{className:"danstyle1c-btn",onClick:t=>(async(e,t)=>{if(t.stopPropagation(),!L){T(null);try{const t=z||b;if(!t)return void f(!0);const s=on(G),r=cn(s?{status:"active"}:null);if(n.length>=r&&!s)return void T(`Free users can only save up to ${r} settings. Upgrade to Premium for more settings.`);const{error:a}=await sn.from("saved_settings").insert({name:`${e.name} (Copy)`,data:e.data,user_id:t.id});if(a)throw a.message.includes("enforce_save_rate_limit")?new Error("You're duplicating too quickly. Please wait a moment and try again."):a.message.includes("check_settings_limit")?new Error("You've reached your limit of saved settings. Upgrade to Premium for more."):a.message.includes("duplicate key")||a.message.includes("unique constraint")?new Error("A setting with this name already exists. Please choose a different name."):a;await K()}catch(s){console.error("Failed to duplicate settings:",s),T("Failed to duplicate settings: "+(s.message||"Unknown error"))}}})(e,t),disabled:!Z&&n.length>=Q||L,children:[j.jsx(W,{className:"w-4 h-4 mr-2"}),"Duplicate"]}),j.jsxs("button",{className:"danstyle1c-btn danstyle1c-remove",onClick:t=>(async(e,t)=>{if(t.stopPropagation(),!L&&(T(null),window.confirm("Are you sure you want to delete these settings?")))try{const{error:t}=await sn.from("saved_settings").delete().eq("id",e);if(t)throw 401===t.status?new Error("Your session has expired. Please log in again."):t;const s=localStorage.getItem("seatyr_current_setting_name"),a=n.find(t=>t.id===e);a&&s===a.name&&(localStorage.setItem("seatyr_current_setting_name","Unsaved"),r({type:"SET_LOADED_SAVED_SETTING",payload:!1})),await K()}catch(s){console.error("Failed to delete settings:",s),T("Failed to delete settings: "+(s.message||"Unknown error"))}})(e.id,t),disabled:L,children:[j.jsx(ue,{className:"w-4 h-4 mr-2"}),"Delete"]})]})]})},e.id)})]})]})]}):j.jsx(Wn,{children:j.jsxs("div",{className:"text-center py-4",children:[j.jsx("p",{className:"text-gray-600 mb-4",children:"You need to be logged in to access saved settings."}),j.jsx(Nn,{onClick:()=>f(!0),children:"Log In or Sign Up"})]})})}),u&&j.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:j.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full shadow-2xl",children:[j.jsx("h3",{className:"text-xl font-bold mb-4",children:"Save Current Settings"}),j.jsxs("div",{className:"mb-4",children:[j.jsx("label",{htmlFor:"settingName",className:"block text-sm font-medium text-gray-700 mb-1",children:"Configuration Name"}),j.jsx("input",{id:"settingName",type:"text",value:m,onChange:e=>p(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#586D78]",placeholder:"Enter a name for these settings"})]}),c&&j.jsx("div",{className:"mb-4 bg-red-50 border border-red-200 rounded-md p-3",children:j.jsx("p",{className:"text-sm text-red-700",children:c})}),j.jsxs("div",{className:"flex justify-end space-x-2",children:[j.jsx("button",{className:"danstyle1c-btn",onClick:()=>{h(!1),d(null)},disabled:x,children:"Cancel"}),j.jsxs("button",{className:"danstyle1c-btn bg-[#586D78] text-white",onClick:async()=>{d(null);const e=z||b;if(e)if(m.trim())try{y(!0);const s=on(G),a=cn(s?{status:"active"}:null);if(n.length>=a&&!s)return void d(`Free users can only save up to ${a} settings. Upgrade to Premium for unlimited settings.`);const i={version:"1.0",guests:t.guests,tables:t.tables.map(e=>({id:e.id,seats:e.seats,name:e.name})),constraints:t.constraints,adjacents:t.adjacents,assignments:t.assignments,seatingPlans:t.seatingPlans,currentPlanIndex:t.currentPlanIndex,userSetTables:t.userSetTables},{error:o}=await sn.from("saved_settings").insert({name:m,data:i,user_id:e.id});if(o)throw console.error("Error saving settings:",o),o.message.includes("violates row-level security policy")?new Error("You don't have permission to save settings. Please make sure you're logged in."):o.message.includes("enforce_save_rate_limit")?new Error("You're saving too quickly. Please wait a moment and try again."):o.message.includes("check_settings_limit")?new Error("You've reached your limit of saved settings. Upgrade to Premium for more."):o;h(!1),p(""),localStorage.setItem("seatyr_current_setting_name",m),r({type:"SET_LOADED_SAVED_SETTING",payload:!0}),await K()}catch(s){console.error("Failed to save settings:",s),d(s.message||"Failed to save settings")}finally{y(!1)}else d("Please enter a name for your settings");else f(!0)},disabled:!m.trim()||x,children:[j.jsx(oe,{className:"w-4 h-4 mr-2"}),x?"Saving...":"Save Settings"]})]})]})}),g&&j.jsx(_n,{onClose:()=>f(!1)})]})},xa=!1;const ya=120,ba=()=>{var e,t;const{state:r,dispatch:n}=jn(),[a,i]=s.useState(null),[o,c]=s.useState(null),[d,u]=s.useState(null),[h,m]=s.useState([]),[p,g]=s.useState(!0),[f,x]=s.useState(!1),[y,b]=s.useState(0),[v,w]=s.useState(1),[_,N]=s.useState("as-entered"),[S,k]=s.useState(!1),[E,C]=s.useState(!1),[A,I]=s.useState(!1),[D,O]=s.useState(!1),$=s.useRef(null),R=null==on?void 0:on(r.subscription);s.useEffect(()=>{const e=()=>x("ontouchstart"in window||navigator.maxTouchPoints>0);return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]);const U=s.useMemo(()=>{const e=new Map;for(const t of r.guests){const s=Yn(t.name),r=e.get(s);r?r.push(t.id):e.set(s,[t.id])}return e},[r.guests]),F=s.useMemo(()=>new Set(r.guests.map(e=>e.id)),[r.guests]),B=e=>{if(F.has(e))return e;const t=U.get(Yn(e));return t&&1===t.length?t[0]:null},q=s.useMemo(()=>{const e={};for(const[t,s]of Object.entries(r.constraints||{})){const r=B(String(t));if(r)for(const[t,n]of Object.entries(s||{})){if("must"!==n&&"cannot"!==n)continue;const s=B(String(t));s&&r!==s&&((e[r]||(e[r]={}))[s]=n,(e[s]||(e[s]={}))[r]=n)}}return e},[r.constraints,U,F]),z=s.useMemo(()=>{const e={};for(const[t,s]of Object.entries(r.adjacents||{})){const r=B(String(t));if(!r)continue;const n=Array.isArray(s)?s:Object.keys(s||{});for(const t of n){const s=B(String(t));s&&r!==s&&((e[r]||(e[r]=new Set)).add(s),(e[s]||(e[s]=new Set)).add(r))}}return Object.fromEntries(Object.entries(e).map(([e,t])=>[e,Array.from(t).slice(0,2)]))},[r.adjacents,U,F]),G=function(e,t){const r=s.useRef(null);return s.useEffect(()=>()=>{r.current&&clearTimeout(r.current)},[]),l.useCallback((...s)=>{r.current&&clearTimeout(r.current),r.current=setTimeout(()=>e(...s),t)},[e,t])}(()=>{if(r.guests.length<2)return void m([]);const e=function(e,t,s,r=!0,n){const a=ga(e,t,s,r,n),i=Array.isArray(a)?a:[],o=new Set,l=[];for(const c of i){const e=(null==c?void 0:c.type)??"generic",t=Array.isArray(null==c?void 0:c.affectedGuests)?Array.from(new Set(c.affectedGuests.filter(Boolean))).sort():[];if(t.length<2)continue;const s=`${e}::${t.join("|")}`;o.has(s)||(o.add(s),l.push({...c,affectedGuests:t}))}return l}(r.guests,q,r.tables,!0,z);m(e)},300);s.useEffect(()=>{G()},[r.guests,r.tables,q,z,G]);const W=s.useMemo(()=>h.filter(e=>Array.isArray(e.affectedGuests)&&new Set(e.affectedGuests).size>=2),[h]);s.useEffect(()=>{b(0),R&&r.guests.length>ya?w(Math.ceil(r.guests.length/10)):w(1)},[r.guests,R]),s.useEffect(()=>{b(0)},[_]),s.useEffect(()=>{k(!1),R&&r.guests.length>ya&&!E&&C(!0),I(!1)},[]),s.useEffect(()=>{if(R&&r.guests.length>ya){if(!A&&!E){k(!0),C(!0);const e=setTimeout(()=>{A||k(!1)},1e4);return()=>clearTimeout(e)}}else C(!1)},[r.guests,R,A,E]);const K=e=>{var t,s;return(null==(s=null==(t=r.adjacents)?void 0:t[e])?void 0:s.length)||0},V=r.guests.length>=ya,H=e=>b(t=>Math.max(0,Math.min(v-1,t+e)));let Y;const J=(e,t)=>{e.preventDefault(),Y=setTimeout(()=>ee(t),500)},X=()=>{Y&&clearTimeout(Y)},Q=()=>{n({type:"SET_SEATING_PLANS",payload:[]}),n({type:"SET_CURRENT_PLAN_INDEX",payload:0});try{localStorage.setItem("seatyr_current_setting_name","Unsaved")}catch{}n({type:"SET_LOADED_SAVED_SETTING",payload:!1})},ee=e=>{if(null!==a)if(a!==e){const t=a,s=e;n({type:"SET_CONSTRAINT",payload:{guest1:t,guest2:s,value:"must"}}),n({type:"SET_ADJACENT",payload:{guest1:t,guest2:s}}),c({guest1:t,guest2:s}),i(null);const r=setTimeout(()=>c(null),3e3);d&&clearTimeout(d),u(r),Q()}else i(null);else i(e)},te=s.useMemo(()=>{const e=(()=>{const e=[...r.guests];if("as-entered"===_)return e;if("first-name"===_)return e.sort((e,t)=>{const s=Yn(e.name.split(" ")[0]||""),r=Yn(t.name.split(" ")[0]||"");return s.localeCompare(r)});if("last-name"===_){const t=e=>(null==Kn?void 0:Kn(e.split("&")[0].trim()))??e;return e.sort((e,s)=>{const r=Yn(t(e.name)),n=Yn(t(s.name));return r.localeCompare(n)})}if("current-table"===_){if(!R||!r.seatingPlans||0===r.seatingPlans.length)return e;const t=r.seatingPlans[r.currentPlanIndex],s={};for(const e of t.tables)for(const t of e.seats){const r=Yn(t.name);s[r]=e.id}return e.sort((e,t)=>{const r=s[Yn(e.name)]??Number.MAX_SAFE_INTEGER,n=s[Yn(t.name)]??Number.MAX_SAFE_INTEGER;if(r===Number.MAX_SAFE_INTEGER&&n!==Number.MAX_SAFE_INTEGER)return 1;if(n===Number.MAX_SAFE_INTEGER&&r!==Number.MAX_SAFE_INTEGER)return-1;if(r!==n)return r-n;const a=Yn(e.name),i=Yn(t.name);return a.localeCompare(i)})}return e})();if(0===e.length)return j.jsx("div",{className:"text-center py-8 text-gray-500",children:"No guests added yet. Add guests to create constraints."});const t=R&&e.length>ya,s=t?e.slice(10*y,Math.min(10*(y+1),e.length)):e,l=[j.jsx("th",{className:"bg-indigo-50 font-medium p-2 border border-gray-500 sticky top-0 left-0 z-30",children:"Guest Names"},"corner")];s.forEach((e,t)=>{var s;const n=K(e.name),i=a===e.name,c=o&&(o.guest1===e.name||o.guest2===e.name);l.push(j.jsx("th",{className:"p-2 font-medium sticky top-0 z-20 min-w-[100px] cursor-pointer border border-gray-500 "+(c?"bg-yellow-300":i?"bg-gray-700 text-white":"bg-indigo-50 text-gray-700 hover:bg-indigo-100"),onDoubleClick:()=>ee(e.name),onTouchStart:t=>J(t,e.name),onTouchEnd:()=>X(),"data-name":e.name,children:j.jsxs("div",{className:"whitespace-normal break-words",children:[j.jsx(Vn,{name:e.name}),n>0&&j.jsx("span",{className:"text-yellow-600 font-bold ml-1",title:`Adjacent to: ${((null==(s=r.adjacents)?void 0:s[e.name])||[]).join(", ")}`,children:1===n?"*":"**"})]})},`col-${t}`))});const h=[j.jsx("tr",{children:l},"header")];e.forEach((e,t)=>{var l;const m=o&&(o.guest1===e.name||o.guest2===e.name),p=a===e.name,g=K(e.name),f=[j.jsx("td",{className:"p-2 font-medium sticky left-0 z-10 min-w-[140px] cursor-pointer border border-gray-500 "+(m?"bg-yellow-300":p?"bg-gray-700 text-white":"bg-indigo-50 text-gray-700 hover:bg-indigo-100"),onDoubleClick:()=>ee(e.name),onTouchStart:t=>J(t,e.name),onTouchEnd:()=>X(),"data-name":e.name,children:j.jsxs("div",{children:[j.jsxs("div",{className:"whitespace-normal break-words",children:[j.jsx(Vn,{name:e.name}),g>0&&j.jsx("span",{className:"text-yellow-600 font-bold ml-1",title:`Adjacent to: ${((null==(l=r.adjacents)?void 0:l[e.name])||[]).join(", ")}`,children:1===g?"*":"**"})]}),e.count&&e.count>1&&j.jsxs("div",{className:"text-xs text-gray-700 font-medium",children:["Party size: ",e.count," ",1===e.count?"person":"people"]}),(()=>{const t=(e=>{if(!R)return null;const t=r.guests.find(t=>t.name===e);if(!t)return{text:"unassigned",type:"none"};if(r.assignments&&r.assignments[t.id])return{text:r.assignments[t.id].split(",").map(e=>e.trim()).map(e=>{const t=parseInt(e);if(!isNaN(t)){const e=r.tables.find(e=>e.id===t);return(null==e?void 0:e.name)?`${e.name} (${t})`:`${t}`}return e}).join(", "),type:"assigned"};if(r.assignments&&r.assignments[e])return{text:r.assignments[e].split(",").map(e=>e.trim()).map(e=>{const t=parseInt(e);if(!isNaN(t)){const e=r.tables.find(e=>e.id===t);return(null==e?void 0:e.name)?`${e.name} (${t})`:`${t}`}return e}).join(", "),type:"assigned"};if(r.seatingPlans&&r.seatingPlans.length>0){const t=r.seatingPlans[r.currentPlanIndex];for(const s of t.tables)if(s.seats.find(t=>t.name===e)){const e=r.tables.find(e=>e.id===s.id);return{text:(null==e?void 0:e.name)?`${e.name} (${s.id})`:`${s.id}`,type:"plan"}}}return{text:"unassigned",type:"none"}})(e.name);if(!t)return j.jsx("div",{className:"text-xs text-gray-700 opacity-40",children:"Table: Unassigned"});const s="none"===t.type?"Unassigned":t.text;return j.jsxs("div",{className:`text-xs ${"assigned"===t.type?"text-gray-700 font-normal":"plan"===t.type?"text-gray-700 font-normal opacity-65":"text-gray-700 font-normal opacity-40"} whitespace-normal break-words`,title:s,children:["Table: ",s]})})()]})},`row-${t}`)];s.forEach((s,a)=>{var l,h,m,p,g,x;if(e.name===s.name)f.push(j.jsx("td",{className:"p-2 border border-gray-500 bg-gray-800"},`cell-${t}-${a}`));else{const y=(null==(h=null==(l=r.constraints)?void 0:l[e.name])?void 0:h[s.name])||"",b=!!(null==(p=null==(m=r.adjacents)?void 0:m[e.name])?void 0:p.includes(s.name))||!!(null==(x=null==(g=r.adjacents)?void 0:g[s.name])?void 0:x.includes(e.name));let v=null,w="";"must"===y?(w="bg-[#22cf04]",v=b?j.jsxs("div",{className:"flex items-center justify-center space-x-1",children:[j.jsx("span",{className:"font-bold",children:"*"}),j.jsx("span",{className:"font-bold",children:"&"}),j.jsx("span",{className:"font-bold",children:"*"})]}):j.jsx("span",{className:"font-bold",children:"&"})):"cannot"===y&&(w="bg-[#e6130b]",v=j.jsx("span",{className:"font-bold",children:"X"}));o&&(o.guest1===e.name&&o.guest2===s.name||o.guest1===s.name&&o.guest2===e.name)&&(w="bg-yellow-300"),f.push(j.jsx("td",{className:`p-2 border border-gray-500 cursor-pointer text-center ${w}`,onClick:()=>((e,t)=>{var s,a,o,l;i(null),c(null),d&&(clearTimeout(d),u(null));const h=(null==(a=null==(s=r.constraints)?void 0:s[e])?void 0:a[t])??"";let m;""===h?m="must":"must"===h?((null==(l=null==(o=r.adjacents)?void 0:o[e])?void 0:l.includes(t))&&n({type:"REMOVE_ADJACENT",payload:{guest1:e,guest2:t}}),m="cannot"):m="",n({type:"SET_CONSTRAINT",payload:{guest1:e,guest2:t,value:m}}),Q()})(e.name,s.name),"data-guest1":e.name,"data-guest2":s.name,children:v},`cell-${t}-${a}`))}}),h.push(j.jsx("tr",{children:f},`row-${t}`))});const m=t&&j.jsx("div",{className:"flex flex-col md:flex-row items-center justify-between py-4 border-t mt-4",children:j.jsxs("div",{className:"flex items-center w-full justify-between",children:[j.jsx("div",{className:"pl-[140px]",children:j.jsxs("button",{onClick:()=>H(-1),disabled:0===y,className:"danstyle1c-btn w-24 mx-1",children:[j.jsx(L,{className:"w-4 h-4 mr-1"})," Previous"]})}),j.jsx("div",{className:"flex flex-wrap justify-center",children:(()=>{if(v<=5)return Array.from({length:v},(e,t)=>j.jsx("button",{onClick:()=>b(t),className:y===t?"danstyle1c-btn selected mx-1 w-1 text-lg":"danstyle1c-btn mx-1 w-1 text-lg",children:t+1},t));const e=[],t=y,s=v-1;e.push(j.jsx("button",{onClick:()=>b(0),className:0===t?"danstyle1c-btn selected mx-1 w-1 text-lg":"danstyle1c-btn mx-1 w-1 text-lg",children:"1"},0)),t>2&&e.push(j.jsx("span",{className:"mx-1",children:"..."},"ellipsis1"));const r=Math.max(1,t-2),n=Math.min(s-1,t+2);for(let a=r;a<=n;a++)0!==a&&a!==s&&e.push(j.jsx("button",{onClick:()=>b(a),className:t===a?"danstyle1c-btn selected mx-1 w-1 text-lg":"danstyle1c-btn mx-1 w-1 text-lg",children:a+1},a));return t<s-2&&e.push(j.jsx("span",{className:"mx-1",children:"..."},"ellipsis2")),s>0&&e.push(j.jsx("button",{onClick:()=>b(s),className:t===s?"danstyle1c-btn selected mx-1 w-1 text-lg":"danstyle1c-btn mx-1 w-1 text-lg",children:s+1},s)),e})()}),j.jsx("div",{className:"pr-[10px]",children:j.jsxs("button",{onClick:()=>H(1),disabled:y>=v-1,className:"danstyle1c-btn w-24 mx-1",children:["Next ",j.jsx(M,{className:"w-4 h-4 ml-1"})]})})]})}),p=!R&&e.length>100&&e.length<=ya;return j.jsxs("div",{className:"flex flex-col space-y-4",children:[p&&xa,t&&xa,j.jsx("div",{className:"overflow-auto max-h-[60vh] border rounded-md relative",children:j.jsx("table",{className:"w-full border-collapse bg-white",children:j.jsx("tbody",{children:h})})}),t&&m]})},[r.guests,r.constraints,r.adjacents,a,o,y,v,_,R,r.seatingPlans,r.assignments,r.tables,r.currentPlanIndex,S,E]);return j.jsxs("div",{className:"space-y-6",children:[j.jsx(Wn,{children:j.jsxs("div",{className:"space-y-4",children:[p&&W.length>0&&j.jsxs("div",{className:"bg-red-50 border rounded-lg p-4",children:[j.jsxs("h3",{className:"flex items-center text-red-800 font-medium mb-2",children:[j.jsx(T,{className:"w-4 h-4 mr-1"})," Detected Conflicts (",W.length,")"]}),j.jsx("div",{className:"space-y-2 max-h-32 overflow-y-auto",children:W.map((e,t)=>j.jsx("div",{className:"text-sm",children:j.jsx("p",{className:"text-red-700",children:e.description||e.message||e.type})},t))})]}),j.jsxs("div",{className:"flex items-start space-x-4 my-4",children:[j.jsx(Z,{className:"text-gray-700 mt-1 flex-shrink-0"}),j.jsxs("div",{className:"ml-20",children:[j.jsx("h3",{className:"font-bold text-[#586D78] text-[18.75px]",children:"How To Use Constraints"}),j.jsxs("div",{className:"text-gray-600 text-[18.75px] mt-2 leading-relaxed",children:[j.jsx("div",{children:"Click a cell to cycle between constraints:"}),j.jsxs("div",{className:"mt-1 flex flex-wrap gap-12",children:[j.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[j.jsx("span",{className:"inline-flex items-center justify-center",style:{width:"1.5em",height:"1.5em",background:"#34d399",border:"2px solid #000",lineHeight:"1.5em"},"aria-label":"Must",children:"&"}),j.jsx("span",{children:"Must sit at the same table"})]}),j.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[j.jsx("span",{className:"inline-flex items-center justify-center",style:{width:"1.5em",height:"1.5em",background:"#ef4444",border:"2px solid #000",lineHeight:"1.5em"},"aria-label":"Cannot",children:"X"}),j.jsx("span",{children:"Cannot sit at the same table"})]}),j.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[j.jsx("span",{className:"inline-flex items-center justify-center",style:{width:"1.5em",height:"1.5em",background:"#ffffff",border:"2px solid #000",lineHeight:"1.5em"},"aria-label":"No constraint"}),j.jsx("span",{children:"No constraint"})]})]})]}),r.user&&j.jsx("div",{className:"mt-4",children:j.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-md",children:[j.jsxs("button",{className:"w-full px-4 py-2 text-left text-blue-800 font-medium hover:bg-blue-100 transition-colors",onClick:()=>O(!D),children:[j.jsx("span",{className:"mr-2",children:D?"▼":"▶"}),"To Set Adjacent-Seating:"]}),D&&j.jsx("div",{className:"px-4 pb-4 text-blue-700",children:j.jsxs("div",{className:"mt-2",children:[j.jsx("div",{children:"1) Double-click a guest name to select it."}),j.jsx("div",{children:"2) Double-click another guest and the adjacency will be set automatically."}),j.jsx("div",{className:"mt-2",children:"Guests with adjacent constraints are marked with *"})]})})]})})]})]})]})}),j.jsxs(Wn,{title:"Constraint Grid",children:[j.jsxs("div",{className:"flex flex-col lg:flex-row justify-between items-center mb-4 space-y-2 lg:space-y-0",children:[j.jsx("div",{className:"flex flex-wrap items-center gap-4",children:j.jsxs("div",{className:"flex items-center space-x-2",children:[j.jsxs("span",{className:"text-gray-700 font-medium flex items-center",children:[j.jsx(P,{className:"w-5 h-5 mr-2"})," Sort by:"]}),j.jsxs("div",{className:"flex space-x-2",children:[r.user&&j.jsx("button",{className:"as-entered"===_?"danstyle1c-btn selected":"danstyle1c-btn",onClick:()=>N("as-entered"),children:"As Entered"}),j.jsx("button",{className:"first-name"===_?"danstyle1c-btn selected":"danstyle1c-btn",onClick:()=>N("first-name"),children:"First Name"}),j.jsx("button",{className:"last-name"===_?"danstyle1c-btn selected":"danstyle1c-btn",onClick:()=>N("last-name"),children:"Last Name"}),j.jsx("button",{className:`danstyle1c-btn ${"current-table"===_?"selected":""} ${0===((null==(e=r.seatingPlans)?void 0:e.length)||0)?"opacity-50":""}`,onClick:()=>N("current-table"),disabled:0===((null==(t=r.seatingPlans)?void 0:t.length)||0),children:"Current Table"})]})]})}),V&&r.guests.length>0&&j.jsxs("div",{className:"flex space-x-2",children:[j.jsxs("button",{className:"danstyle1c-btn w-24 mx-1",onClick:()=>H(-1),disabled:0===y,children:[j.jsx(L,{className:"w-4 h-4 mr-1"})," Previous"]}),j.jsxs("button",{className:"danstyle1c-btn w-24 mx-1",onClick:()=>H(1),disabled:y>=v-1,children:["Next ",j.jsx(M,{className:"w-4 h-4 ml-1"})]})]})]}),j.jsx("div",{ref:$,children:0===r.guests.length?j.jsx("p",{className:"text-gray-500 text-center py-4",children:"No guests added yet. Add guests to create constraints."}):te})]}),j.jsx(fa,{isDefaultOpen:!1})]})},va=({tone:e,ownerName:t,value:r,onChange:n,allGuests:a,activeFieldKey:i,setActiveFieldKey:o})=>{const l=`${e}:${t}`,[c,d]=s.useState(""),[u,h]=s.useState(-1),m=((e,t)=>{const[r,n]=s.useState(e);return s.useEffect(()=>{const s=setTimeout(()=>n(e),t);return()=>clearTimeout(s)},[e,t]),r})(c,300),p=s.useMemo(()=>{const e=m.trim().toLowerCase();if(!e)return[];const s=/(?:\b(?:and|plus|with|guest|guests?)\b|[&+]|[0-9]+)/gi;return a.map(e=>e.name).filter(n=>{return(a=n,a.toLowerCase().replace(s,"").replace(/\s+/g," ").trim()).includes(e)&&!r.includes(n)&&n!==t;var a}).slice(0,8)},[m,r,t,a]),g=e=>{const t=e.trim();t&&!r.includes(t)&&n([...r,t]),d(""),h(-1)},f="must"===e?"bg-green-50 border-green-200":"bg-red-50 border-red-200",x=`Type to add "${e} sit with"...`,y="must"===e?"border-green-300":"border-red-300";return j.jsxs("div",{className:"relative",children:[j.jsx("div",{className:"flex flex-wrap gap-1 mb-1 min-h-[24px]",children:r.map(e=>j.jsxs("span",{className:`inline-flex items-center rounded-full px-2 py-0.5 text-sm ${f} border`,children:[e,j.jsx("button",{type:"button",className:"ml-1.5 text-xs hover:text-red-700",onClick:()=>{return t=e,void n(r.filter(e=>e!==t));var t},"aria-label":`Remove ${e}`,children:"✕"})]},e))}),j.jsx("input",{value:c,onChange:e=>{d(e.target.value),h(-1)},onFocus:()=>o(l),onBlur:()=>setTimeout(()=>o(null),150),onKeyDown:e=>{"ArrowDown"===e.key?(e.preventDefault(),h(e=>Math.min(e+1,p.length-1))):"ArrowUp"===e.key?(e.preventDefault(),h(e=>Math.max(e-1,0))):"Enter"===e.key&&(e.preventDefault(),p[u]?g(p[u]):c.trim()&&g(c.trim()))},role:"combobox","aria-expanded":i===l&&p.length>0,className:`w-full border-2 ${y} rounded px-2 py-1 text-sm`,placeholder:x}),i===l&&p.length>0&&j.jsx("ul",{role:"listbox",className:"absolute z-10 mt-1 w-full bg-white border rounded shadow-lg max-h-48 overflow-auto",children:p.map((e,t)=>j.jsx("li",{role:"option","aria-selected":t===u,onMouseDown:()=>g(e),className:"px-2 py-1 text-sm cursor-pointer "+(t===u?"bg-indigo-100":"hover:bg-gray-50"),children:e},e))})]})},wa=()=>{const{state:e,dispatch:t}=jn(),[r,n]=s.useState(null),[a,i]=s.useState(""),[o,l]=s.useState(null),[c,d]=s.useState(()=>!e.user),[u,h]=s.useState(!0),[m,p]=s.useState("as-entered"),[g,f]=s.useState(null),x=e.tables.reduce((e,t)=>e+t.seats,0),y=on(e.subscription),b=()=>{t({type:"SET_SEATING_PLANS",payload:[]}),t({type:"SET_CURRENT_PLAN_INDEX",payload:0}),localStorage.setItem("seatyr_current_setting_name","Unsaved"),t({type:"SET_LOADED_SAVED_SETTING",payload:!1})},v=s.useMemo(()=>e.guests.reduce((e,t)=>e+Math.max(1,t.count),0),[e.guests]);s.useEffect(()=>{t({type:"AUTO_RECONCILE_TABLES"}),b()},[v,e.assignments,t]);const w=e=>{i(e.target.value),l(null)},_=()=>{if(null===r)return;const s=a.trim();if(!s)return void n(null);e.tables.some(e=>{var t;return e.id!==r&&((null==(t=e.name)?void 0:t.toLowerCase())===s.toLowerCase()||!e.name&&`Table ${e.id}`.toLowerCase()===s.toLowerCase())})?l("That name is already in use. Please choose another."):(t({type:"UPDATE_TABLE_NAME",payload:{id:r,name:s===`Table ${r}`?void 0:s}}),n(null),b())},N=e=>{"Enter"===e.key?_():"Escape"===e.key&&(n(null),l(null))},S=e=>e.name||`Table ${e.id}`,k=(s,r,n)=>{const a=Object.entries(e.constraints[s]??{}).filter(([,e])=>e===n).map(([e])=>e),i=r.filter(e=>!a.includes(e)),o=a.filter(e=>!r.includes(e));i.forEach(e=>t({type:"SET_CONSTRAINT",payload:{guest1:s,guest2:e,value:n}})),o.forEach(e=>t({type:"SET_CONSTRAINT",payload:{guest1:s,guest2:e,value:""}})),(i.length||o.length)&&b()},E=(t,s)=>{if((null==s?void 0:s.tables)&&s.tables.some(e=>e.seats.some(e=>e.name===t)))return s.tables.find(e=>e.seats.some(e=>e.name===t)).id;const r=e.guests.find(e=>e.name===t);if(r){const t=e.assignments[r.id];if(t){const e=t.split(",").map(e=>parseInt(e.trim(),10)).filter(Number.isFinite);if(e.length)return e[0]}}return Number.POSITIVE_INFINITY},T="flex justify-between items-center p-3 rounded-md bg-[#D7E5E5] cursor-pointer";return j.jsxs("div",{className:"space-y-14",children:[j.jsxs("div",{children:[j.jsxs("div",{className:T,onClick:()=>d(!c),children:[j.jsxs("h2",{className:"text-lg font-semibold text-[#586D78] flex items-center",children:[j.jsx(de,{className:"mr-2 h-5 w-5"}),"Tables"]}),c?j.jsx(F,{className:"h-5 w-5 text-[#586D78]"}):j.jsx(U,{className:"h-5 w-5 text-[#586D78]"})]}),c&&j.jsxs("div",{className:"mt-4 space-y-4",children:[j.jsx(Wn,{children:j.jsx("div",{className:"flex justify-between items-start",children:j.jsxs("div",{className:"space-y-4 w-1/2",children:[j.jsx("p",{className:"text-gray-700",children:"Add, remove, and manage tables for your seating arrangement."}),j.jsx("p",{className:"text-gray-700",children:"Each table can have between 1 and 20 seats."}),y&&e.user&&j.jsx("div",{className:"bg-green-50 border border-green-300 rounded-md p-2 max-w-max",children:j.jsxs("p",{className:"text-sm text-green-700 flex items-center whitespace-nowrap",children:[j.jsx(V,{className:"w-4 h-4 mr-1 text-yellow-500"}),"Premium feature: Double-click to rename any table."]})}),!e.userSetTables&&j.jsx("div",{className:"bg-blue-50 border border-[#586D78] rounded-md p-3",children:j.jsx("p",{className:"text-sm text-[#586D78]",children:"Tables are currently in auto-adjust mode. The number of tables will automatically increase based on your guest list. Any manual changes will switch to fixed table settings."})}),j.jsxs("button",{onClick:()=>{e.tables.length>=100?alert("Maximum number of tables (100) reached."):(t({type:"SET_USER_SET_TABLES",payload:!0}),t({type:"ADD_TABLE",payload:{}}),b())},className:"danstyle1c-btn",children:[j.jsx(ne,{className:"w-4 h-4 mr-2"}),"Add New Table"]})]})})}),j.jsxs(Wn,{children:[j.jsxs("div",{className:"flex justify-between items-center mb-4",children:[j.jsxs("h2",{className:"text-lg font-normal text-[#586D78]",children:["Tables (",e.tables.length,")"]}),j.jsxs("div",{className:"text-[#586D78]",children:["Total Seats: ",x]})]}),0===e.tables.length?j.jsx("p",{className:"text-gray-500 text-center py-4",children:"No tables added yet. Add a table to get started."}):j.jsx("div",{className:"grid gap-4 grid-cols-1 sm:grid-cols-2 lg:grid-cols-3",children:e.tables.map(e=>j.jsxs("div",{className:"bg-[#f9f9f9] rounded-lg p-3 border border-solid border-[#586D78] border-[1px] shadow-sm flex justify-between items-center",children:[j.jsxs("div",{className:"flex-grow",children:[r===e.id?j.jsxs("div",{className:"mb-2",children:[j.jsx("input",{type:"text",value:a,onChange:w,onBlur:_,onKeyDown:N,className:"px-3 py-1 border rounded-md focus:outline-none focus:ring-2 focus:ring-[#586D78] w-full "+(o?"border-red-300 bg-red-50":"border-[#586D78]"),autoFocus:!0}),o&&j.jsx("p",{className:"text-red-600 text-xs mt-1",children:o})]}):j.jsxs("div",{className:"font-medium text-[#586D78] "+(y?"cursor-pointer":""),onDoubleClick:()=>{return t=e.id,s=e.name,void(y&&(n(t),i(s||`Table ${t}`),l(null)));var t,s},title:y?"Double-click to rename (Premium feature)":"",children:[S(e),y&&j.jsx(te,{className:"w-3 h-3 ml-1 text-gray-400 inline-block"}),j.jsxs("span",{className:"text-xs bg-gray-200 text-gray-600 px-1.5 py-0.5 rounded ml-2",children:["#",e.id]})]}),j.jsxs("div",{className:"flex items-center space-x-3 mt-2",children:[j.jsx("label",{htmlFor:`table-${e.id}-seats`,className:"text-[#586D78]",children:"Seats:"}),j.jsx("input",{id:`table-${e.id}-seats`,type:"number",min:"1",max:"20",value:e.seats,onChange:s=>((e,s)=>{const r=parseInt(s,10);Number.isFinite(r)&&r>=1&&r<=20&&(t({type:"SET_USER_SET_TABLES",payload:!0}),t({type:"UPDATE_TABLE_SEATS",payload:{id:e,seats:r}}),b())})(e.id,s.target.value),className:"px-3 py-1 border border-[#586D78] rounded-md w-16 focus:outline-none focus:ring-2 focus:ring-[#586D78]"})]})]}),j.jsx("button",{className:"danstyle1c-btn danstyle1c-remove h-10",onClick:()=>{return s=e.id,void(window.confirm("Are you sure you want to remove this table? This will also update any assignments that reference this table.")&&(t({type:"SET_USER_SET_TABLES",payload:!0}),t({type:"REMOVE_TABLE",payload:s}),b()));var s},"aria-label":"Remove table",children:j.jsx(ue,{className:"w-4 h-4"})})]},e.id))})]})]})]}),j.jsxs("div",{children:[j.jsxs("div",{className:T,onClick:()=>h(!u),children:[j.jsxs("h2",{className:"text-lg font-semibold text-[#586D78] flex items-center",children:[j.jsx(ee,{className:"mr-2 h-5 w-5"}),"Guest Assignments"]}),u?j.jsx(F,{className:"h-5 w-5 text-[#586D78]"}):j.jsx(U,{className:"h-5 w-5 text-[#586D78]"})]}),u&&j.jsxs("div",{className:"mt-4 space-y-4",children:[j.jsx(Wn,{children:j.jsxs("div",{className:"text-sm text-black space-y-1",children:[j.jsx("p",{children:"You can specify which tables each guest can be assigned to."}),j.jsx("p",{children:'Tip: You can assign a guest to a range of tables by entering comma-separated numbers (e.g., "1,3,5").'}),j.jsx("p",{children:"Simply, enter table numbers separated by commas, or leave blank for automatic assignment."}),j.jsx("p",{children:"This means the seating algorithm will place them at one of these tables."})]})}),j.jsxs("div",{className:"flex flex-wrap gap-2 items-center",children:[j.jsx("span",{className:"text-sm text-gray-600",children:"Sort by:"}),j.jsx("button",{onClick:()=>p("as-entered"),className:"px-3 py-1 text-sm rounded "+("as-entered"===m?"bg-[#586D78] text-white":"bg-gray-200 text-gray-700"),children:"As Entered"}),j.jsx("button",{onClick:()=>p("first-name"),className:"px-3 py-1 text-sm rounded "+("first-name"===m?"bg-[#586D78] text-white":"bg-gray-200 text-gray-700"),children:"First Name"}),j.jsx("button",{onClick:()=>p("last-name"),className:"px-3 py-1 text-sm rounded "+("last-name"===m?"bg-[#586D78] text-white":"bg-gray-200 text-gray-700"),children:"Last Name"}),j.jsx("button",{onClick:()=>p("current-table"),className:"px-3 py-1 text-sm rounded "+("current-table"===m?"bg-[#586D78] text-white":"bg-gray-200 text-gray-700"),children:"Current Table"})]}),j.jsx("div",{className:"space-y-4",children:(()=>{const t=[...e.guests],s=e.seatingPlans[e.currentPlanIndex]??null;switch(m){case"first-name":return t.sort((e,t)=>e.name.localeCompare(t.name));case"last-name":return t.sort((e,t)=>(e.name.split(" ").pop()??e.name).localeCompare(t.name.split(" ").pop()??t.name));case"current-table":return t.sort((e,t)=>E(e.name,s)-E(t.name,s));default:return t}})().map(s=>{const r=e.adjacents[s.name]??[],n=Object.entries(e.constraints[s.name]??{}).filter(([,e])=>"must"===e).map(([e])=>e).filter(e=>!r.includes(e)),a=Object.entries(e.constraints[s.name]??{}).filter(([,e])=>"cannot"===e).map(([e])=>e);return j.jsx("div",{className:"rounded-2xl border-[3px] border-white bg-white/90 shadow-sm p-3",children:j.jsxs("div",{className:"flex flex-col space-y-2",children:[j.jsxs("div",{className:"flex items-center",children:[j.jsx(Vn,{name:s.name}),j.jsxs("span",{className:"ml-2 px-2 py-0.5 text-xs rounded-full border border-gray-300",children:["Party size: ",s.count]})]}),j.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[j.jsxs("div",{children:[j.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Table Assignment"}),j.jsx("input",{type:"text",value:e.assignments[s.id]||"",onChange:e=>{return r=s.id,n=e.target.value,t({type:"UPDATE_ASSIGNMENT",payload:{id:r,tables:n}}),void b();var r,n},className:"w-full border-2 border-gray-300 rounded px-2 py-1 text-sm",placeholder:"e.g., 1, 3, 5"}),e.tables.length>0&&j.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Available: ",y&&e.tables.some(e=>e.name)?e.tables.map(e=>e.name?`${e.id} (${e.name})`:e.id).join(", "):e.tables.map(e=>e.id).join(", ")]})]}),j.jsxs("div",{children:[j.jsx("label",{className:"block text-sm font-medium text-green-700 mb-1",children:"Must Sit With"}),r.length>0&&j.jsx("div",{className:"flex flex-wrap gap-1 mb-1",children:r.map(e=>j.jsxs("span",{className:"inline-flex items-center rounded-full px-2 py-0.5 text-xs border bg-yellow-50 border-yellow-200 text-yellow-900",title:"Adjacent preference",children:["* ",e]},`adj-${e}`))}),j.jsx(va,{tone:"must",ownerName:s.name,value:n,onChange:e=>k(s.name,e,"must"),allGuests:e.guests,activeFieldKey:g,setActiveFieldKey:f})]}),j.jsxs("div",{children:[j.jsx("label",{className:"block text-sm font-medium text-red-700 mb-1",children:"Cannot Sit With"}),j.jsx(va,{tone:"cannot",ownerName:s.name,value:a,onChange:e=>k(s.name,e,"cannot"),allGuests:e.guests,activeFieldKey:g,setActiveFieldKey:f})]})]})]})},s.name)})})]})]}),j.jsx(fa,{isDefaultOpen:!1})]})},ja=(e,t)=>{if(!e)return"";const s=e.trim(),r=function(e){if(!e||"string"!=typeof e)return[e||""];const t=e.replace(/\s*\(\s*\d+\s*\)\s*$/i,"").replace(/\s*[&+]\s*\d+\s*$/i,"").replace(/\s+(?:and|plus|\+|&)\s+(?:guest|guests?)\s*$/i,"").trim(),s=t.split(/\s+(?:and|&|\+|plus|also)\s+/i).map(e=>e.trim()).filter(e=>e.length>0);return s.length>0?s:[t]}(e),n=function(e){if(!e||"string"!=typeof e)return[];const t=e.trim();if(!t)return[];const s=t.match(/[&+]\s*(\d+)\s*$/),r=t.match(/\((\d+)\)\s*$/),n=/\b(?:\+|plus|and)\s+(?:guest|guests?)\s*$/i.test(t),a=t.match(/\b(?:\+|plus|and)\s+(one|two|three|four|five|six|seven|eight|nine|ten)\s*$/i);let i=0;s?i=parseInt(s[1],10):r?i=parseInt(r[1],10):n?i=1:a&&(i={one:1,two:2,three:3,four:4,five:5,six:6,seven:7,eight:8,nine:9,ten:10}[a[1].toLowerCase()]||1);if(i<=0)return[];const o=["1st","2nd","3rd","4th","5th","6th","7th","8th","9th","10th"],l=[];for(let c=1;c<=i;c++){const e=c<=10?o[c-1]:`${c}th`;l.push(`${e} of ${i}`)}return l}(e),a=/[&+]|\b(?:and|plus)\b/i.test(s),i=a&&/(?:(?:\+|&)\s*1(?!\d))|(?:\b(?:and|plus)\b\s*(?:one|1)(?!\d))/i.test(s);r.length,n.length;let o="",l=!1,c="";if(t<r.length)o=r[t];else{l=!0;c=n[t-r.length]||"",o=c}const d=[];if(a)if(i){const e=s.replace(/(?:(?:\+|&)\s*1(?!\d))|(?:\b(?:and|plus)\b\s*(?:one|1)(?!\d))/gi," plus One");if(t<r.length){const s=r[t],n=e.indexOf(s);if(-1!==n){const t=e.substring(0,n),r=e.substring(n+s.length);t&&d.push(j.jsx("span",{children:t},"before-name")),d.push(j.jsx("strong",{children:s},"bold-name")),r&&d.push(j.jsx("span",{children:r},"after-name"))}else d.push(j.jsx("span",{children:e},"full-name"))}else{const t=e.indexOf("One");if(-1!==t){const s=e.substring(0,t),r=e.substring(t+3);s&&d.push(j.jsx("span",{children:s},"before-one")),d.push(j.jsx("strong",{children:"One"},"bold-one")),r&&d.push(j.jsx("span",{children:r},"after-one"))}else d.push(j.jsx("span",{children:e},"full-name"))}}else if(t<r.length){const e=r[t],n=s.indexOf(e);if(-1!==n){const t=s.substring(0,n),r=s.substring(n+e.length);t&&d.push(j.jsx("span",{children:t},"before-name")),d.push(j.jsx("strong",{children:e},"bold-name")),r&&d.push(j.jsx("span",{children:r},"after-name"))}else d.push(j.jsx("span",{children:s},"full-name"))}else if(d.push(j.jsx("span",{children:s},"full-name")),d.push(j.jsx("span",{children:"+ "},"ordinal-sep")),c===o){const e=c.match(/^(\d+(?:st|nd|rd|th))\s+(of\s+\d+)$/);e?(d.push(j.jsx("strong",{children:e[1]},"ordinal-bold")),d.push(j.jsxs("span",{children:[" ",e[2]]},"ordinal-of"))):d.push(j.jsx("strong",{children:c},"ordinal-bold"))}else d.push(j.jsx("span",{children:c},"ordinal-norm"));else if(r.forEach((e,t)=>{t>0&&d.push(j.jsx("span",{children:" & "},`conn-${t}`)),e===o?d.push(j.jsx("strong",{children:e},`bold-${t}`)):d.push(j.jsx("span",{children:e},`norm-${t}`))}),l&&c)if(d.push(j.jsx("span",{children:"+"},"ordinal-sep")),c===o){const e=c.match(/^(\d+(?:st|nd|rd|th))\s+(of\s+\d+)$/);e?(d.push(j.jsx("strong",{children:e[1]},"ordinal-bold")),d.push(j.jsxs("span",{children:[" ",e[2]]},"ordinal-of"))):d.push(j.jsx("strong",{children:c},"ordinal-bold"))}else d.push(j.jsx("span",{children:c},"ordinal-norm"));return j.jsx(j.Fragment,{children:d})},_a=(e,t)=>{const s=t+1,r=`Table #${s}`;return e.name&&""!==e.name.trim()&&e.name.trim().toLowerCase()!==`table ${s}`?`Table #${s} (${e.name.trim()})`:r},Na=()=>{const{state:e,dispatch:t}=jn(),[r,n]=s.useState(!1),[a,i]=s.useState([]),[o,l]=s.useState(0),[c,d]=s.useState(1),u=on(e.subscription),h=e.seatingPlans[e.currentPlanIndex]??null;s.useEffect(()=>{0===e.seatingPlans.length&&e.guests.length>0&&e.tables.length>0&&(n(!0),ua(e.guests,e.tables,e.constraints,e.adjacents,{},u).then(e=>{e.plans.length>0&&t({type:"SET_SEATING_PLANS",payload:e.plans})}).catch(e=>{console.error("Auto-generation failed:",e)}).finally(()=>{n(!1)}))},[e.guests,e.tables,e.constraints,e.adjacents,e.seatingPlans.length,u,t]),s.useEffect(()=>{l(0),u&&e.user&&e.guests.length>120?d(Math.ceil(e.guests.length/10)):d(1)},[e.guests,u,e.user]);const m=s.useMemo(()=>{const t=new Map;return e.tables.forEach(e=>t.set(e.id,e.seats)),t},[e.tables]),p=s.useMemo(()=>h?[...h.tables].sort((e,t)=>e.id-t.id):[],[h]),g=u&&e.user&&e.guests.length>120,f=e.guests.length>=120,x=e=>l(t=>Math.max(0,Math.min(c-1,t+e))),y=s=>{const r=e.currentPlanIndex+s;r>=0&&r<e.seatingPlans.length&&t({type:"SET_CURRENT_PLAN_INDEX",payload:r})};return j.jsxs("div",{className:"space-y-6",children:[j.jsxs(Wn,{children:[j.jsx("h2",{className:"text-lg font-bold text-[#586D78] mb-4",children:"Seating Plan"}),j.jsx("p",{className:"text-gray-700",children:"Generate and review seating plans based on your guests, tables, and constraints."}),j.jsx("div",{className:"flex flex-wrap gap-2 mt-4",children:j.jsxs("button",{className:"danstyle1c-btn",onClick:async()=>{n(!0),i([]);try{const{plans:s,errors:r}=await ua(e.guests,e.tables,e.constraints,e.adjacents,e.assignments,u);r.length>0&&i(r),s.length>0?(t({type:"SET_SEATING_PLANS",payload:s}),t({type:"SET_CURRENT_PLAN_INDEX",payload:0})):0===r.length&&i([{type:"error",message:"No valid seating plans could be generated. Try relaxing constraints."}])}catch(s){i([{type:"error",message:"An unexpected error occurred during plan generation."}])}finally{n(!1)}},disabled:r,children:[r&&j.jsx(ie,{className:"w-4 h-4 mr-2 animate-spin"}),r?"Generating...":"Generate Seating Plan"]})}),a.length>0&&j.jsxs("div",{className:"mt-4 bg-red-50 border border-red-200 rounded-md p-3",children:[j.jsxs("h3",{className:"flex items-center text-red-800 font-medium mb-2",children:[j.jsx(E,{className:"w-4 h-4 mr-1"})," Errors"]}),j.jsx("ul",{className:"list-disc pl-5 text-red-700 text-sm space-y-1",children:a.map((e,t)=>j.jsx("li",{children:e.message},t))})]})]}),j.jsxs(Wn,{title:`Current Plan (${e.currentPlanIndex+1} of ${e.seatingPlans.length})`,children:[e.seatingPlans.length>1&&j.jsxs("div",{className:"flex justify-end space-x-2 mb-4",children:[j.jsx("button",{className:"danstyle1c-btn w-32 mx-1",onClick:()=>y(-1),disabled:e.currentPlanIndex<=0,children:"← Previous"}),j.jsxs("button",{className:"danstyle1c-btn w-24 mx-1",onClick:()=>y(1),disabled:e.currentPlanIndex>=e.seatingPlans.length-1,children:["Next",j.jsx(I,{className:"w-4 h-4 ml-2"})]})]}),f&&e.user&&e.guests.length>0&&j.jsxs("div",{className:"flex justify-end space-x-2 mb-4",children:[j.jsxs("button",{className:"danstyle1c-btn w-24 mx-1",onClick:()=>x(-1),disabled:0===o,children:[j.jsx(L,{className:"w-4 h-4 mr-1"})," Previous"]}),j.jsxs("button",{className:"danstyle1c-btn w-24 mx-1",onClick:()=>x(1),disabled:o>=c-1,children:["Next ",j.jsx(M,{className:"w-4 h-4 ml-1"})]})]}),(()=>{if(!h)return j.jsx("div",{className:"text-center py-8 text-gray-500",children:"No seating plan available."});const t=Math.max(0,...Array.from(m.values()));return j.jsx("div",{className:"overflow-x-auto",children:j.jsxs("table",{className:"min-w-full border-collapse",children:[j.jsx("thead",{children:j.jsx("tr",{children:p.map((t,s)=>{const r=m.get(t.id)??0,n=t.seats.length,a=e.tables.find(e=>e.id===t.id);return j.jsxs("th",{className:"bg-indigo-100 text-[#586D78] font-medium p-2 border border-indigo-200",children:[_a({id:t.id,name:null==a?void 0:a.name},s),j.jsxs("span",{className:"text-xs block text-gray-600",children:[n,"/",r," seats"]})]},t.id)})})}),j.jsx("tbody",{children:Array.from({length:t}).map((e,t)=>j.jsx("tr",{children:p.map(e=>{const s=m.get(e.id)??0;if(t>=s)return j.jsx("td",{className:"p-2 border border-gray-700 bg-black","aria-hidden":"true",style:{pointerEvents:"none"}},`cell-blackout-${e.id}-${t}`);const r=e.seats[t];if(!r)return j.jsx("td",{className:"p-2 border border-gray-200 bg-gray-50",children:j.jsx("div",{className:"text-xs text-gray-400 text-center",children:"Empty"})},`cell-empty-${e.id}-${t}`);const n="string"==typeof r.name&&r.name.trim()?r.name.trim():"",a=Number.isFinite(r.partyIndex)?r.partyIndex:-1;return j.jsx("td",{className:"p-2 border border-indigo-200 align-top",children:j.jsx("div",{className:"font-medium text-[#586D78] text-sm",children:ja(n,a)})},`cell-guest-${e.id}-${t}`)})},`row-${t}`))})]})})})(),e.seatingPlans.length>1&&j.jsx("div",{className:"flex justify-center space-x-2 mt-4",children:e.seatingPlans.length<=7?Array.from({length:e.seatingPlans.length},(s,r)=>j.jsx("button",{className:"danstyle1c-btn w-8 mx-1 "+(e.currentPlanIndex===r?"selected":""),onClick:()=>t({type:"SET_CURRENT_PLAN_INDEX",payload:r}),children:r+1},r)):j.jsxs(j.Fragment,{children:[j.jsx("button",{className:"danstyle1c-btn w-8 mx-1 "+(0===e.currentPlanIndex?"selected":""),onClick:()=>t({type:"SET_CURRENT_PLAN_INDEX",payload:0}),children:"1"}),e.currentPlanIndex>2&&j.jsx("span",{className:"mx-2 text-gray-500",children:"..."}),e.currentPlanIndex>0&&j.jsx("button",{className:"danstyle1c-btn w-8 mx-1",onClick:()=>t({type:"SET_CURRENT_PLAN_INDEX",payload:e.currentPlanIndex-1}),children:e.currentPlanIndex}),j.jsx("button",{className:"danstyle1c-btn w-8 mx-1 selected",children:e.currentPlanIndex+1}),e.currentPlanIndex<e.seatingPlans.length-1&&j.jsx("button",{className:"danstyle1c-btn w-8 mx-1",onClick:()=>t({type:"SET_CURRENT_PLAN_INDEX",payload:e.currentPlanIndex+1}),children:e.currentPlanIndex+2}),e.currentPlanIndex<e.seatingPlans.length-3&&j.jsx("span",{className:"mx-2 text-gray-500",children:"..."}),e.currentPlanIndex<e.seatingPlans.length-1&&j.jsx("button",{className:"danstyle1c-btn w-8 mx-1 "+(e.currentPlanIndex===e.seatingPlans.length-1?"selected":""),onClick:()=>t({type:"SET_CURRENT_PLAN_INDEX",payload:e.seatingPlans.length-1}),children:e.seatingPlans.length})]})}),g&&j.jsx("div",{className:"flex flex-col md:flex-row items-center justify-between py-4 border-t mt-4",children:j.jsxs("div",{className:"flex items-center w-full justify-between",children:[j.jsx("div",{className:"pl-[140px]",children:j.jsxs("button",{onClick:()=>x(-1),disabled:0===o,className:"danstyle1c-btn w-24 mx-1",children:[j.jsx(L,{className:"w-4 h-4 mr-1"})," Previous"]})}),j.jsx("div",{className:"flex flex-wrap justify-center",children:(()=>{if(c<=9)return Array.from({length:c},(e,t)=>j.jsx("button",{onClick:()=>l(t),className:o===t?"danstyle1c-btn selected mx-1 w-4":"danstyle1c-btn mx-1 w-4",children:t+1},t));const e=[];for(let t=0;t<3;t++)t<c&&e.push(j.jsx("button",{onClick:()=>l(t),className:o===t?"danstyle1c-btn selected mx-1 w-4":"danstyle1c-btn mx-1 w-4",children:t+1},t));o>2&&(e.push(j.jsx("span",{className:"mx-1",children:"..."},"ellipsis1")),o<c-3&&e.push(j.jsx("button",{onClick:()=>l(o),className:"danstyle1c-btn selected mx-1 w-4",children:o+1},o))),o<c-3&&e.push(j.jsx("span",{className:"mx-1",children:"..."},"ellipsis2"));for(let t=Math.max(3,c-3);t<c;t++)e.push(j.jsx("button",{onClick:()=>l(t),className:o===t?"danstyle1c-btn selected mx-1 w-4":"danstyle1c-btn mx-1 w-4",children:t+1},t));return e})()}),j.jsx("div",{className:"pr-[10px]",children:j.jsxs("button",{onClick:()=>x(1),disabled:o>=c-1,className:"danstyle1c-btn w-24 mx-1",children:["Next ",j.jsx(M,{className:"w-4 h-4 ml-1"})]})})]})}),h&&j.jsxs("div",{className:"mt-6 flex justify-center space-x-4",children:[j.jsxs("button",{className:"danstyle1c-btn",onClick:()=>y(-1),disabled:e.currentPlanIndex<=0,children:[j.jsx(A,{className:"w-4 h-4 mr-2"})," Previous"]}),j.jsxs("button",{className:"danstyle1c-btn",onClick:()=>y(1),disabled:e.currentPlanIndex>=e.seatingPlans.length-1,children:["Next ",j.jsx(I,{className:"w-4 h-4 ml-2"})]})]})]}),j.jsx(fa,{isDefaultOpen:!1})]})},Sa=()=>{const{state:e,dispatch:t}=jn(),[r,n]=s.useState([]),[a,o]=s.useState(!0),[l,c]=s.useState(null),[d,u]=s.useState(!1),[h,m]=s.useState(""),[p,g]=s.useState(!1),[f,x]=s.useState(!1),[y,b]=s.useState(null),[v,w]=s.useState(!1),[_,N]=s.useState(null),[S,k]=s.useState(null),T=i(),{user:C,subscription:P}=e;s.useEffect(()=>{(async()=>{var e;if(!C)try{w(!0),N(null);const{data:r,error:n}=await sn.auth.getSession();if(n)return console.error("Error fetching session:",n),void N("Failed to verify authentication. Please try again or log in.");const a=null==(e=null==r?void 0:r.session)?void 0:e.user;if(a){console.log("Found authenticated user in session:",a.id),b(a),t({type:"SET_USER",payload:a});try{const{data:e,error:s}=await sn.from("subscriptions").select("*").eq("user_id",a.id).order("current_period_end",{ascending:!1}).limit(1);!s&&e&&e.length>0&&t({type:"SET_SUBSCRIPTION",payload:e[0]})}catch(s){console.error("Error fetching subscription data:",s)}}else console.log("No authenticated user found in session")}catch(s){console.error("Error checking session:",s),N("Failed to verify your session. Please try again later.")}finally{w(!1)}})()},[C,t]),s.useEffect(()=>{C||y?A():(n([]),o(!1))},[C,y]);const A=async()=>{try{if(!(C||y))return n([]),void o(!1);o(!0),c(null);const{data:e,error:s}=await sn.from("saved_settings").select("*").order("updated_at",{ascending:!1});if(s){if(401===s.status)throw console.error("Session expired when loading settings"),N("Your session has expired. Please log in again."),b(null),t({type:"SET_USER",payload:null}),new Error("Session expired");throw console.error("Error loading settings:",s),s}console.log("Loaded settings:",(null==e?void 0:e.length)||0),n(e||[])}catch(e){c("Failed to load saved settings. Please try again or refresh the page."),console.error(e)}finally{o(!1)}},I=async e=>{try{if(!e.data)throw new Error("Saved setting data is missing or corrupted");e.data.tables&&(e.data.tables=e.data.tables.map(e=>e.hasOwnProperty("seats")?e:{...e,seats:8})),e.data.hasOwnProperty("userSetTables")||(e.data.userSetTables=!0),localStorage.setItem("seatyr_current_setting_name",e.name),t({type:"IMPORT_STATE",payload:e.data}),t({type:"SET_LOADED_SAVED_SETTING",payload:!0}),await sn.from("saved_settings").update({updated_at:(new Date).toISOString()}).eq("id",e.id),T("/seating")}catch(s){console.error("Failed to load settings:",s),k("Failed to load settings: "+(s.message||"Unknown error"))}},D=async()=>{var e;try{w(!0),N(null);const{data:s,error:r}=await sn.auth.getSession();if(r)return console.error("Error retrying session check:",r),void N("Failed to verify authentication. Please log in again.");const n=null==(e=null==s?void 0:s.session)?void 0:e.user;n?(console.log("Found authenticated user in session:",n.id),b(n),t({type:"SET_USER",payload:n}),A()):N("No active session found. Please log in.")}catch(s){console.error("Error in retry session:",s),N("An unexpected error occurred. Please try again.")}finally{w(!1)}},O=on(P),$=cn(O?{status:"active"}:null),R=C||y,U=localStorage.getItem("seatyr_current_setting_name")||null,L=e.loadedSavedSetting&&0===e.seatingPlans.length;return R||v?v?j.jsxs("div",{className:"space-y-6",children:[j.jsxs("h1",{className:"text-2xl font-bold text-[#586D78] flex items-center",children:[j.jsx(J,{className:"mr-2"}),"Saved Settings"]}),j.jsx(Wn,{children:j.jsxs("div",{className:"text-center py-8",children:[j.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-[#586D78] mx-auto mb-4"}),j.jsx("p",{className:"text-gray-600",children:"Verifying your account..."})]})})]}):j.jsxs("div",{className:"space-y-6",children:[j.jsxs("h1",{className:"text-2xl font-bold text-[#586D78] flex items-center",children:[j.jsx(J,{className:"mr-2"}),"Saved Settings"]}),j.jsx(Wn,{children:j.jsxs("div",{className:"space-y-4",children:[j.jsx("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-2",children:j.jsxs("p",{className:"text-gray-700",children:["Save and manage your seating arrangements.",O?" Premium users can save up to 50 configurations.":` Free users can save up to ${$} configurations. Premium users can save up to 50.`]})}),j.jsxs("button",{className:"danstyle1c-btn",onClick:()=>u(!0),disabled:O?r.length>=50:r.length>=$,children:[j.jsx(oe,{className:"w-4 h-4 mr-2"}),"Save Current Settings"]}),l&&j.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-md p-3 flex items-start",children:[j.jsx(E,{className:"w-5 h-5 text-red-500 mr-2 flex-shrink-0 mt-0.5"}),j.jsx("p",{className:"text-red-700",children:l})]}),!O&&r.length>=$&&j.jsx("div",{className:"bg-indigo-50 border border-indigo-200 rounded-md p-3",children:j.jsxs("p",{className:"text-indigo-700",children:["You've reached your limit of ",$," saved settings.",j.jsx("span",{className:"font-bold",children:" Upgrade to Premium for more saved settings!"})]})})]})}),j.jsx(Wn,{title:"Saved Configurations",children:a?j.jsxs("div",{className:"text-center py-4",children:[j.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-500 mx-auto"}),j.jsx("p",{className:"mt-2 text-gray-600",children:"Loading saved settings..."})]}):0===r.length?j.jsx("div",{className:"text-center py-4 text-gray-500",children:'No saved settings yet. Click "Save Current Settings" to create your first configuration.'}):j.jsxs("div",{className:"space-y-4",children:[S&&j.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-md p-3 flex items-start",children:[j.jsx(E,{className:"w-5 h-5 text-red-500 mr-2 flex-shrink-0 mt-0.5"}),j.jsx("p",{className:"text-red-700",children:S})]}),r.map(e=>{var s,n;let a="border border-gray-200";return e.name===U&&(a=L?"border-2 border-[#d1d5db]":"border-2 border-[#06b6d4]"),j.jsx("div",{className:`${a} rounded-lg p-4 hover:bg-gray-50 transition-colors cursor-pointer`,onClick:()=>I(e),children:j.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[j.jsxs("div",{children:[j.jsx("h3",{className:"font-medium text-[#586D78]",children:e.name}),j.jsxs("p",{className:"text-sm text-gray-500",children:["Last modified: ",new Date(e.updated_at).toLocaleDateString()]}),(null==(s=e.data)?void 0:s.guests)&&j.jsxs("p",{className:"text-sm text-gray-600",children:[e.data.guests.length," guests • ",(null==(n=e.data.tables)?void 0:n.length)||0," tables"]})]}),j.jsxs("div",{className:"flex flex-wrap gap-2",children:[j.jsxs("button",{className:"danstyle1c-btn bg-[#586D78] text-white",onClick:t=>{t.stopPropagation(),I(e)},children:[j.jsx(J,{className:"w-4 h-4 mr-2"}),"Load"]}),j.jsxs("button",{className:"danstyle1c-btn",onClick:t=>{t.stopPropagation(),(async(e,t)=>{k(null);const s=prompt("Enter new name:",t);if(s&&s!==t)try{const{error:r}=await sn.from("saved_settings").update({name:s}).eq("id",e);if(r)throw 401===r.status?new Error("Your session has expired. Please log in again."):r;localStorage.getItem("seatyr_current_setting_name")===t&&localStorage.setItem("seatyr_current_setting_name",s),await A()}catch(r){console.error("Failed to rename settings:",r),k("Failed to rename settings: "+(r.message||"Unknown error"))}})(e.id,e.name)},children:[j.jsx(te,{className:"w-4 h-4 mr-2"}),"Rename"]}),j.jsxs("button",{className:"danstyle1c-btn",onClick:t=>{t.stopPropagation(),(async e=>{k(null);try{const t=C||y;if(!t)return void g(!0);const s=on(P),n=cn(s?{status:"active"}:null);if(r.length>=n&&!s)return void k(`Free users can only save up to ${n} settings. Upgrade to Premium for more settings.`);const{error:a}=await sn.from("saved_settings").insert({name:`${e.name} (Copy)`,data:e.data,user_id:t.id});if(a)throw a.message.includes("enforce_save_rate_limit")?new Error("You're duplicating too quickly. Please wait a moment and try again."):a.message.includes("check_settings_limit")?new Error("You've reached your limit of saved settings. Upgrade to Premium for more."):a.message.includes("duplicate key")||a.message.includes("unique constraint")?new Error("A setting with this name already exists. Please choose a different name."):a;await A()}catch(t){console.error("Failed to duplicate settings:",t),k("Failed to duplicate settings: "+(t.message||"Unknown error"))}})(e)},disabled:!O&&r.length>=$,children:[j.jsx(W,{className:"w-4 h-4 mr-2"}),"Duplicate"]}),j.jsxs("button",{className:"danstyle1c-btn danstyle1c-remove",onClick:s=>{s.stopPropagation(),(async e=>{if(k(null),window.confirm("Are you sure you want to delete these settings?"))try{const{error:s}=await sn.from("saved_settings").delete().eq("id",e);if(s)throw 401===s.status?new Error("Your session has expired. Please log in again."):s;const n=localStorage.getItem("seatyr_current_setting_name"),a=r.find(t=>t.id===e);a&&n===a.name&&(localStorage.setItem("seatyr_current_setting_name","Unsaved"),t({type:"SET_LOADED_SAVED_SETTING",payload:!1})),await A()}catch(s){console.error("Failed to delete settings:",s),k("Failed to delete settings: "+(s.message||"Unknown error"))}})(e.id)},children:[j.jsx(ue,{className:"w-4 h-4 mr-2"}),"Delete"]})]})]})},e.id)})]})}),d&&j.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:j.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full shadow-2xl",children:[j.jsx("h3",{className:"text-xl font-bold mb-4",children:"Save Current Settings"}),j.jsxs("div",{className:"mb-4",children:[j.jsx("label",{htmlFor:"settingName",className:"block text-sm font-medium text-gray-700 mb-1",children:"Configuration Name"}),j.jsx("input",{id:"settingName",type:"text",value:h,onChange:e=>m(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#586D78]",placeholder:"Enter a name for these settings"})]}),l&&j.jsx("div",{className:"mb-4 bg-red-50 border border-red-200 rounded-md p-3",children:j.jsx("p",{className:"text-sm text-red-700",children:l})}),j.jsxs("div",{className:"flex justify-end space-x-2",children:[j.jsx("button",{className:"danstyle1c-btn",onClick:()=>{u(!1),c(null)},disabled:f,children:"Cancel"}),j.jsxs("button",{className:"danstyle1c-btn bg-[#586D78] text-white",onClick:async()=>{c(null);const s=C||y;if(s)if(h.trim())try{x(!0);const n=on(P),a=cn(n?{status:"active"}:null);if(r.length>=a&&!n)return void c(`Free users can only save up to ${a} settings. Upgrade to Premium for unlimited settings.`);const i={version:"1.0",guests:e.guests,tables:e.tables.map(e=>({id:e.id,seats:e.seats,name:e.name})),constraints:e.constraints,adjacents:e.adjacents,assignments:e.assignments,seatingPlans:e.seatingPlans,currentPlanIndex:e.currentPlanIndex,userSetTables:e.userSetTables},{error:o}=await sn.from("saved_settings").insert({name:h,data:i,user_id:s.id});if(o)throw console.error("Error saving settings:",o),o.message.includes("violates row-level security policy")?new Error("You don't have permission to save settings. Please make sure you're logged in."):o.message.includes("enforce_save_rate_limit")?new Error("You're saving too quickly. Please wait a moment and try again."):o.message.includes("check_settings_limit")?new Error("You've reached your limit of saved settings. Upgrade to Premium for more."):o;u(!1),m(""),localStorage.setItem("seatyr_current_setting_name",h),t({type:"SET_LOADED_SAVED_SETTING",payload:!0}),await A()}catch(n){console.error("Failed to save settings:",n),c(n.message||"Failed to save settings")}finally{x(!1)}else c("Please enter a name for your settings");else g(!0)},disabled:!h.trim()||f,children:[j.jsx(oe,{className:"w-4 h-4 mr-2"}),f?"Saving...":"Save Settings"]})]})]})}),p&&j.jsx(_n,{onClose:()=>g(!1)})]}):j.jsxs("div",{className:"space-y-6",children:[j.jsxs("h1",{className:"text-2xl font-bold text-[#586D78] flex items-center",children:[j.jsx(J,{className:"mr-2"}),"Saved Settings"]}),j.jsx(Wn,{children:j.jsxs("div",{className:"text-center py-8",children:[_&&j.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-md p-3 mb-4 text-red-700",children:[j.jsx("p",{children:_}),j.jsxs("button",{onClick:D,className:"danstyle1c-btn mt-2 text-sm",disabled:v,children:[v?j.jsx(ie,{className:"w-4 h-4 mr-2 animate-spin"}):j.jsx(ie,{className:"w-4 h-4 mr-2"}),v?"Checking...":"Try Again"]})]}),j.jsx("p",{className:"text-gray-600 mb-4",children:"You need to be logged in to access saved settings."}),j.jsx(Nn,{onClick:()=>g(!0),children:"Log In or Sign Up"})]})}),p&&j.jsx(_n,{onClose:()=>g(!1)})]})},ka=()=>j.jsxs("div",{className:"space-y-6 pb-8",children:[j.jsxs("h1",{className:"text-2xl font-bold text-gray-800 flex items-center",children:[j.jsx(ce,{className:"mr-2"}),"Privacy Policy"]}),j.jsx(Wn,{children:j.jsxs("div",{className:"prose max-w-none",children:[j.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Effective Date: May 9, 2025"}),j.jsx("p",{className:"mb-6",children:'This Privacy Policy explains how Exabyte LLC ("we," "us," "our") collects, uses, shares, and protects information about users of Seatyr.com (the "Service").'}),j.jsx("p",{className:"mb-6",children:"By using Seatyr.com, you agree to the terms of this policy."}),j.jsx("h3",{className:"text-lg font-semibold mt-8 mb-4",children:"1. Information We Collect"}),j.jsx("p",{children:"We collect the following types of information:"}),j.jsx("h4",{className:"font-semibold mt-4 mb-2",children:"a. Information You Provide"}),j.jsxs("ul",{className:"list-disc pl-6 mb-4",children:[j.jsx("li",{children:"Guest lists and event data (names, seating preferences, constraints)"}),j.jsx("li",{children:"Your email address or name (if provided via contact form or optional account registration)"})]}),j.jsx("h4",{className:"font-semibold mt-4 mb-2",children:"b. Automatically Collected Information"}),j.jsxs("ul",{className:"list-disc pl-6 mb-4",children:[j.jsx("li",{children:"Device and browser type"}),j.jsx("li",{children:"IP address and usage data"}),j.jsx("li",{children:"Cookies and similar technologies (see Section 6)"})]}),j.jsx("h3",{className:"text-lg font-semibold mt-8 mb-4",children:"2. How We Use Your Information"}),j.jsx("p",{children:"We use the information we collect to:"}),j.jsxs("ul",{className:"list-disc pl-6 mb-4",children:[j.jsx("li",{children:"Provide and maintain the Service"}),j.jsx("li",{children:"Improve functionality and performance"}),j.jsx("li",{children:"Respond to user inquiries and support requests"}),j.jsx("li",{children:"Protect against misuse or unauthorized access"}),j.jsx("li",{children:"Analyze aggregate usage trends (non-personally identifiable)"})]}),j.jsx("p",{className:"mb-4",children:"We do not sell or rent your personal data."}),j.jsx("h3",{className:"text-lg font-semibold mt-8 mb-4",children:"3. Data Storage & Security"}),j.jsx("p",{className:"mb-4",children:"We use industry-standard measures to protect your data, including encryption, secure servers, and access controls."}),j.jsx("p",{className:"mb-4",children:"However, no internet-based service is 100% secure. You use the Service at your own risk and are responsible for safeguarding any personal data you choose to upload."}),j.jsx("h3",{className:"text-lg font-semibold mt-8 mb-4",children:"4. Data Retention"}),j.jsx("p",{className:"mb-4",children:"Event and guest data is retained only as long as needed to operate the Service or as requested by you."}),j.jsx("p",{className:"mb-4",children:"You may request deletion of your data at any time by contacting us at info@seatyr.com."}),j.jsx("h3",{className:"text-lg font-semibold mt-8 mb-4",children:"5. Sharing of Information"}),j.jsx("p",{className:"mb-4",children:"We do not share personal information with third parties except:"}),j.jsxs("ul",{className:"list-disc pl-6 mb-4",children:[j.jsx("li",{children:"As required by law or court order"}),j.jsx("li",{children:"To third-party service providers who support site functionality (e.g., hosting)"}),j.jsx("li",{children:"In the event of a merger, acquisition, or asset sale"})]}),j.jsx("h3",{className:"text-lg font-semibold mt-8 mb-4",children:"6. Cookies and Analytics"}),j.jsx("p",{className:"mb-4",children:"Seatyr.com may use cookies and third-party analytics (such as Google Analytics) to enhance user experience and gather usage data. You can disable cookies in your browser settings, though this may affect site performance."}),j.jsx("h3",{className:"text-lg font-semibold mt-8 mb-4",children:"7. Children's Privacy"}),j.jsx("p",{className:"mb-4",children:"Seatyr.com is not intended for use by children under 13. We do not knowingly collect personal information from children."}),j.jsx("h3",{className:"text-lg font-semibold mt-8 mb-4",children:"8. Your Rights"}),j.jsx("p",{className:"mb-4",children:"Depending on your location, you may have the right to:"}),j.jsxs("ul",{className:"list-disc pl-6 mb-4",children:[j.jsx("li",{children:"Access or correct your personal data"}),j.jsx("li",{children:"Request deletion of your data"}),j.jsx("li",{children:"Object to certain types of data processing"})]}),j.jsx("p",{className:"mb-4",children:"To make such a request, email us at info@seatyr.com."}),j.jsx("h3",{className:"text-lg font-semibold mt-8 mb-4",children:"9. International Users"}),j.jsx("p",{className:"mb-4",children:"If you are accessing Seatyr.com from outside the United States, be aware that your data may be processed and stored in the U.S. By using the Service, you consent to this transfer."}),j.jsx("h3",{className:"text-lg font-semibold mt-8 mb-4",children:"10. Changes to This Policy"}),j.jsx("p",{className:"mb-4",children:"We may update this Privacy Policy periodically. Changes will be posted on this page with the updated effective date. Continued use of the Service after changes constitutes acceptance."}),j.jsx("h3",{className:"text-lg font-semibold mt-8 mb-4",children:"11. Contact Us"}),j.jsx("p",{className:"mb-4",children:"If you have questions about this Privacy Policy or how your data is handled, contact:"}),j.jsxs("p",{className:"mb-4",children:["Exabyte LLC",j.jsx("br",{}),"Email: info@seatyr.com",j.jsx("br",{}),"Website: https://seatyr.com"]})]})})]}),Ea=()=>j.jsxs("div",{className:"space-y-6 pb-8",children:[j.jsxs("h1",{className:"text-2xl font-bold text-gray-800 flex items-center",children:[j.jsx(le,{className:"mr-2"}),"Terms of Service"]}),j.jsx(Wn,{children:j.jsxs("div",{className:"prose max-w-none",children:[j.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Effective Date: May 9, 2025"}),j.jsx("p",{className:"mb-6",children:'Welcome to Seatyr.com. These Terms of Service ("Terms") govern your access to and use of our website, applications, and related services (collectively, the "Service") provided by Exabyte LLC ("we," "us," or "our"). By using Seatyr.com, you agree to be bound by these Terms.'}),j.jsx("p",{className:"mb-6",children:"Please read them carefully."}),j.jsx("h3",{className:"text-lg font-semibold mt-8 mb-4",children:"1. Service Overview"}),j.jsx("p",{className:"mb-4",children:"Seatyr.com is a web-based application that helps users organize and optimize seating arrangements for events such as weddings, banquets, and conferences. Features include guest list management, table assignments, seating permutations, and constraint-based arrangement tools."}),j.jsx("h3",{className:"text-lg font-semibold mt-8 mb-4",children:"2. Eligibility"}),j.jsx("p",{className:"mb-4",children:"To use Seatyr.com, you must be at least 13 years old. By using the Service, you represent and warrant that you have the legal capacity to enter into these Terms."}),j.jsx("h3",{className:"text-lg font-semibold mt-8 mb-4",children:"3. User Accounts"}),j.jsx("p",{className:"mb-4",children:"You may use Seatyr.com without an account, but some features may require registration."}),j.jsx("p",{className:"mb-4",children:"You are responsible for maintaining the confidentiality of any account credentials and for all activities that occur under your account."}),j.jsx("p",{className:"mb-4",children:"You agree to provide accurate and current information."}),j.jsx("h3",{className:"text-lg font-semibold mt-8 mb-4",children:"4. Acceptable Use"}),j.jsx("p",{className:"mb-4",children:"You agree not to:"}),j.jsxs("ul",{className:"list-disc pl-6 mb-4",children:[j.jsx("li",{children:"Use the Service for any unlawful purpose;"}),j.jsx("li",{children:"Reverse-engineer, copy, or resell any part of the Service;"}),j.jsx("li",{children:"Attempt to interfere with the operation or security of Seatyr.com;"}),j.jsx("li",{children:"Upload or share content that is offensive, harmful, or infringing."})]}),j.jsx("h3",{className:"text-lg font-semibold mt-8 mb-4",children:"5. Intellectual Property"}),j.jsx("p",{className:"mb-4",children:"All content on Seatyr.com, including design, code, and trademarks, is owned by Exabyte LLC or its licensors. You may not reproduce, distribute, or modify any portion of the Service without explicit permission."}),j.jsx("h3",{className:"text-lg font-semibold mt-8 mb-4",children:"6. User Content"}),j.jsx("p",{className:"mb-4",children:"You retain ownership of content (e.g., guest lists) you upload to the Service."}),j.jsx("p",{className:"mb-4",children:"By using the Service, you grant us a limited license to store, display, and process your content to provide the functionality of the Service."}),j.jsx("p",{className:"mb-4",children:"We do not claim ownership over your event data."}),j.jsx("h3",{className:"text-lg font-semibold mt-8 mb-4",children:"7. Data & Privacy"}),j.jsx("p",{className:"mb-4",children:"Our Privacy Policy explains how we collect, use, and protect your personal data. By using Seatyr.com, you consent to our data practices as outlined there."}),j.jsx("h3",{className:"text-lg font-semibold mt-8 mb-4",children:"8. Availability & Modifications"}),j.jsx("p",{className:"mb-4",children:"We strive to maintain uptime but do not guarantee uninterrupted access."}),j.jsx("p",{className:"mb-4",children:"We may modify or discontinue any part of the Service at any time, with or without notice."}),j.jsx("h3",{className:"text-lg font-semibold mt-8 mb-4",children:"9. Third-Party Services"}),j.jsx("p",{className:"mb-4",children:"The Service may integrate with third-party platforms or APIs. We are not responsible for the content, functionality, or policies of those third parties."}),j.jsx("h3",{className:"text-lg font-semibold mt-8 mb-4",children:"10. Disclaimers"}),j.jsx("p",{className:"mb-4",children:'The Service is provided "as is" and "as available." We make no warranties regarding reliability, accuracy, or suitability for your specific needs.'}),j.jsx("h3",{className:"text-lg font-semibold mt-8 mb-4",children:"11. Limitation of Liability"}),j.jsx("p",{className:"mb-4",children:"To the fullest extent permitted by law, Seatyr.com and Exabyte LLC shall not be liable for any indirect, incidental, special, or consequential damages arising from your use of the Service."}),j.jsx("h3",{className:"text-lg font-semibold mt-8 mb-4",children:"12. Indemnification"}),j.jsx("p",{className:"mb-4",children:"You agree to indemnify and hold harmless Exabyte LLC from any claims, liabilities, or expenses arising from your use of the Service or violation of these Terms."}),j.jsx("h3",{className:"text-lg font-semibold mt-8 mb-4",children:"13. Governing Law"}),j.jsx("p",{className:"mb-4",children:"These Terms are governed by the laws of the State of New York, without regard to its conflict of law principles."}),j.jsx("h3",{className:"text-lg font-semibold mt-8 mb-4",children:"14. Changes to These Terms"}),j.jsx("p",{className:"mb-4",children:"We may update these Terms at any time. Continued use of the Service after changes are posted constitutes your acceptance of the revised Terms."}),j.jsx("h3",{className:"text-lg font-semibold mt-8 mb-4",children:"15. Contact Us"}),j.jsxs("p",{className:"mb-4",children:["If you have questions about these Terms, please contact us at:",j.jsx("br",{}),"info@seatyr.com"]})]})})]}),Ta=()=>{const e=i(),t=c();return s.useEffect(()=>{(async()=>{try{const{error:t}=await sn.auth.getSession();if(t)throw t;const s=new URL(window.location.href).searchParams.get("type");"recovery"===s?(console.log("Password reset detected, redirecting to account page"),sessionStorage.setItem("password_reset_redirect","true"),e("/account",{replace:!0})):e("/",{replace:!0})}catch(t){console.error("Error during auth callback:",t),e("/",{replace:!0})}})()},[e,t]),j.jsx("div",{className:"flex items-center justify-center min-h-[50vh]",children:j.jsxs("div",{className:"text-center",children:[j.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-500 mx-auto mb-4"}),j.jsx("p",{className:"text-gray-600",children:"Completing authentication..."})]})})},Ca=()=>{const e=i(),{dispatch:t}=jn();return s.useEffect(()=>{(async()=>{try{const{data:e}=await sn.auth.getUser(),s=null==e?void 0:e.user;if(s){console.log("Refreshing subscription data after payment");const{data:e,error:r}=await sn.from("subscriptions").select("*").eq("user_id",s.id).order("current_period_end",{ascending:!1}).limit(1);if(r)console.error("Error fetching subscription after payment:",r);else if(e&&e.length>0)console.log("Updated subscription data:",e[0]),t({type:"SET_SUBSCRIPTION",payload:e[0]});else if(s.email&&("danabrams999@yahoo.com"===s.email.toLowerCase()||"dan@corpania.com"===s.email.toLowerCase()||"immortality.bytes.book@gmail.com"===s.email.toLowerCase())){console.log("Special user detected, creating fallback premium subscription");const e={id:"special-user",user_id:s.id,status:"active",current_period_end:new Date(Date.now()+2592e6).toISOString(),created:(new Date).toISOString()};t({type:"SET_SUBSCRIPTION",payload:e})}}}catch(e){console.error("Error syncing subscription after payment:",e)}})();const s=setTimeout(()=>{e("/")},5e3);return()=>clearTimeout(s)},[e,t]),j.jsxs("div",{className:"space-y-6",children:[j.jsxs("h1",{className:"text-2xl font-bold text-gray-800 flex items-center",children:[j.jsx(V,{className:"mr-2"}),"Welcome to Premium!"]}),j.jsx(Wn,{children:j.jsxs("div",{className:"text-center py-8",children:[j.jsx(V,{className:"w-16 h-16 text-yellow-500 mx-auto mb-4"}),j.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-4",children:"Thank you for upgrading to Premium!"}),j.jsx("p",{className:"text-gray-600 mb-4",children:"Your premium features are now active. You can now:"}),j.jsxs("ul",{className:"text-left max-w-md mx-auto space-y-2 mb-8",children:[j.jsxs("li",{className:"flex items-center",children:[j.jsx("span",{className:"w-2 h-2 bg-green-500 rounded-full mr-2"}),"Create seating plans with unlimited guests"]}),j.jsxs("li",{className:"flex items-center",children:[j.jsx("span",{className:"w-2 h-2 bg-green-500 rounded-full mr-2"}),"Save multiple seating configurations"]}),j.jsxs("li",{className:"flex items-center",children:[j.jsx("span",{className:"w-2 h-2 bg-green-500 rounded-full mr-2"}),"Access premium support"]})]}),j.jsx("p",{className:"text-sm text-gray-500",children:"Redirecting you to the home page in a few seconds..."})]})})]})},Pa=()=>{const e=i();return j.jsxs("div",{className:"space-y-6",children:[j.jsxs("h1",{className:"text-2xl font-bold text-gray-800 flex items-center",children:[j.jsx(pe,{className:"mr-2"}),"Premium Upgrade Cancelled"]}),j.jsx(Wn,{children:j.jsxs("div",{className:"text-center py-8",children:[j.jsx(pe,{className:"w-16 h-16 text-red-500 mx-auto mb-4"}),j.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-4",children:"Premium upgrade cancelled"}),j.jsx("p",{className:"text-gray-600 mb-8",children:"No worries! You can still use all the free features of Seatyr. If you change your mind, you can upgrade to Premium at any time."}),j.jsx(Nn,{onClick:()=>e("/"),className:"mx-auto",children:"Return to Home"})]})})]})},Aa=({onSuccess:e})=>{var t;const{state:r}=jn(),{user:n,subscription:a}=r,[i,o]=s.useState(!1),[l,c]=s.useState(!1);if(!n)return j.jsx("div",{className:"bg-white rounded-lg shadow-md p-6",children:j.jsx("div",{className:"text-center p-4",children:j.jsx("p",{children:"You need to be logged in to view subscription details."})})});const d=on(a),u=a&&"special-user"===a.id,h=null==(t=null==a?void 0:a.id)?void 0:t.toString().startsWith("trial-"),m=(()=>{const e=new Date;e.setFullYear(2025);const t=e.getMonth();return e.setMonth((t+1)%12),11===t&&e.setFullYear(2025),e})().toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}),p=async()=>{o(!0);try{await Mn(n.id)}catch(e){console.error("Error opening billing portal:",e),alert("Failed to open billing portal. Please try again.")}finally{o(!1)}};return j.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[j.jsx("div",{className:"flex items-center mb-4",children:j.jsxs("h2",{className:"text-xl font-bold flex items-center",children:[j.jsx(V,{className:"mr-2 text-yellow-500"}),"Subscription Status"]})}),d?j.jsxs(j.Fragment,{children:[j.jsxs("div",{className:"bg-green-50 p-4 rounded-md mb-4 flex items-start",children:[j.jsx(V,{className:"mr-2 text-green-600 flex-shrink-0 mt-1"}),j.jsxs("div",{children:[j.jsx("p",{className:"font-medium text-green-700",children:"Premium Subscription Active"}),!u&&!h&&j.jsxs("p",{className:"text-green-600 text-sm",children:["Your subscription ",a.cancel_at_period_end?"expires":"renews"," on ",m,".",j.jsx("span",{children:" (Billed monthly)"})]}),h&&j.jsxs("p",{className:"text-green-600 text-sm",children:["Your trial subscription expires on ",m,"."]})]})]}),!u&&!h&&j.jsxs("div",{className:"space-y-4",children:[a.cancel_at_period_end?j.jsxs("div",{children:[j.jsxs("p",{className:"text-amber-700 mb-2",children:["Your subscription will end on ",m,". You'll continue to have premium access until then."]}),j.jsx(Nn,{onClick:async()=>{o(!0);try{await Ln(n.id,"reactivate"),e&&e()}catch(t){console.error("Error reactivating subscription:",t),alert("Failed to reactivate subscription. Please try again.")}finally{o(!1)}},disabled:i,className:"bg-green-600 hover:bg-green-700",children:"Reactivate Subscription"})]}):j.jsxs("div",{className:"flex flex-wrap gap-3",children:[j.jsx(Nn,{variant:"secondary",onClick:p,disabled:i,icon:j.jsx(K,{className:"w-4 h-4"}),children:"Manage Billing"}),j.jsx(Nn,{variant:"danger",onClick:()=>c(!0),disabled:i,children:"Cancel Subscription"})]}),"past_due"===a.status&&j.jsxs("div",{className:"bg-amber-50 p-4 rounded-md mt-4 flex items-start",children:[j.jsx(T,{className:"mr-2 text-amber-500 flex-shrink-0 mt-1"}),j.jsxs("div",{children:[j.jsx("p",{className:"font-medium text-amber-700",children:"Payment Issue Detected"}),j.jsx("p",{className:"text-amber-600 text-sm",children:"We were unable to process your last payment. Please update your payment method to avoid losing premium access."}),j.jsx(Nn,{variant:"warning",onClick:p,className:"mt-2",children:"Update Payment Method"})]})]})]})]}):j.jsx("div",{className:"bg-gray-50 p-4 rounded-md mb-4",children:j.jsx("p",{className:"text-gray-700",children:a?"Your premium subscription has ended.":"You do not have an active subscription."})}),l&&j.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:j.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full shadow-2xl",children:[j.jsx("h3",{className:"text-xl font-bold mb-4",children:"Cancel Premium Subscription?"}),j.jsxs("p",{className:"text-gray-700 mb-6",children:["Are you sure you want to cancel your Premium subscription? You will still have access until ",m,"."]}),j.jsxs("div",{className:"flex justify-end space-x-2",children:[j.jsx(Nn,{variant:"secondary",onClick:()=>c(!1),disabled:i,children:"Keep Subscription"}),j.jsx(Nn,{variant:"danger",onClick:async()=>{o(!0);try{await Ln(n.id,"cancel"),e&&e(),c(!1)}catch(t){console.error("Error cancelling subscription:",t),alert("Failed to cancel subscription. Please try again.")}finally{o(!1)}},disabled:i,children:"Yes, Cancel"})]})]})})]})},Ia=({userId:e})=>{const[t,r]=s.useState([]),[n,a]=s.useState(!0),[i,o]=s.useState(null);s.useEffect(()=>{(async()=>{try{a(!0);const t=await(async e=>{try{const{data:t,error:s}=await sn.from("payment_history").select("*").eq("user_id",e).order("payment_date",{ascending:!1});if(s)throw s;return t||[]}catch(i){throw console.error("Error fetching payment history:",i),i}})(e);r(t),o(null)}catch(t){o("Unable to load payment history"),console.error("Error loading payment history:",t)}finally{a(!1)}})()},[e]);const l=e=>{const t={paid:"bg-green-100 text-green-800",pending:"bg-yellow-100 text-yellow-800",failed:"bg-red-100 text-red-800",refunded:"bg-blue-100 text-blue-800"}[e.toLowerCase()]||"bg-gray-100 text-gray-800";return j.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${t}`,children:e.charAt(0).toUpperCase()+e.slice(1)})};return n?j.jsx("div",{className:"flex justify-center py-6",children:j.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-[#7973BB]"})}):i?j.jsxs("div",{className:"p-4 bg-red-50 border border-red-200 rounded-md text-red-700",children:[j.jsx("p",{className:"font-medium",children:"Failed to load payment history"}),j.jsx("p",{className:"text-sm",children:"Please try again later or contact support."})]}):0===t.length?j.jsxs("div",{className:"p-6 text-center text-gray-500 bg-gray-50 border border-gray-200 rounded-md",children:[j.jsx(G,{className:"w-8 h-8 mx-auto text-gray-400 mb-2"}),j.jsx("p",{className:"font-medium",children:"No payment history yet"}),j.jsx("p",{className:"text-sm",children:"Your payment records will show up here once available."})]}):j.jsx("div",{className:"overflow-x-auto",children:j.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[j.jsx("thead",{children:j.jsxs("tr",{className:"bg-gray-50",children:[j.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),j.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Amount"}),j.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),j.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Invoice"})]})}),j.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:t.map(e=>{return j.jsxs("tr",{className:"hover:bg-gray-50",children:[j.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:(r=e.payment_date,new Date(r).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}))}),j.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:(t=e.amount,s=e.currency,new Intl.NumberFormat("en-US",{style:"currency",currency:s.toUpperCase()}).format(t))}),j.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:l(e.status)}),j.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-[#7973BB]",children:e.stripe_invoice_id?j.jsxs("a",{href:"#",className:"flex items-center text-[#7973BB] hover:text-[#5d59a5]",onClick:e=>{e.preventDefault()},children:[j.jsx(K,{className:"w-4 h-4 mr-1"}),"View Receipt"]}):"N/A"})]},e.id);var t,s,r})})]})})},Da=()=>{var e,t;const{state:r,dispatch:n}=jn();i();const[a,o]=s.useState(null),[l,c]=s.useState(!1),[d,u]=s.useState(!1),[h,m]=s.useState(!1),[p,g]=s.useState(!1),[f,x]=s.useState(null),[y,b]=s.useState(!0),[v,w]=s.useState(""),[_,N]=s.useState(""),[S,k]=s.useState(null),[T,C]=s.useState(null),[P,A]=s.useState(!1),[I,D]=s.useState(!1),[O,$]=s.useState(!1),[L,M]=s.useState(!1),[q,z]=s.useState(0);s.useEffect(()=>{r.user?o(r.user):(async()=>{var e,t;try{g(!0),x(null);const{data:s,error:a}=await sn.auth.getSession();if(a)return console.error("Error getting session:",a),void x("Failed to verify your session. Please log in again.");o((null==(e=s.session)?void 0:e.user)??null),(null==(t=s.session)?void 0:t.user)&&!r.user&&n({type:"SET_USER",payload:s.session.user})}catch(s){console.error("Error checking session:",s),x("An error occurred while checking your session.")}finally{g(!1)}})();const{data:{subscription:e}}=sn.auth.onAuthStateChange((e,t)=>{o((null==t?void 0:t.user)??null)});return()=>e.unsubscribe()},[r.user,n]),s.useEffect(()=>{if("true"===sessionStorage.getItem("password_reset_redirect")){sessionStorage.removeItem("password_reset_redirect"),M(!0),b(!0);const e=document.getElementById("password-change-section");e&&e.scrollIntoView({behavior:"smooth"}),z(0)}},[]),s.useEffect(()=>{let e;return L&&(e=setTimeout(()=>{z(e=>e+1),q>=1&&M(!1)},5e3)),()=>{e&&clearTimeout(e)}},[L,q]);const G=async()=>{const e=a||r.user;if(e)try{u(!0),console.log("Refreshing subscription data for user:",e.id);const{data:t,error:s}=await sn.from("subscriptions").select("*").eq("user_id",e.id).order("current_period_end",{ascending:!1}).limit(1);if(!s&&(null==t?void 0:t.length)>0)return console.log("Found subscription:",t[0]),void n({type:"SET_SUBSCRIPTION",payload:t[0]});s&&console.error("Error fetching subscription:",s);const{data:r,error:a}=await sn.from("trial_subscriptions").select("*").eq("user_id",e.id).gt("expires_on",(new Date).toISOString()).order("expires_on",{ascending:!1}).limit(1);if(!a&&(null==r?void 0:r.length)>0){console.log("Found trial subscription:",r[0]);const t={id:`trial-${r[0].id}`,user_id:e.id,status:"active",current_period_start:r[0].start_date,current_period_end:r[0].expires_on,cancel_at_period_end:!0,trial_end:r[0].expires_on};n({type:"SET_SUBSCRIPTION",payload:t})}else a&&console.error("Error fetching trial subscription:",a)}catch(t){console.error("Error refreshing subscription:",t)}finally{u(!1)}},W=async()=>{var e;try{g(!0),x(null);const{data:t,error:s}=await sn.auth.getSession();if(s)return console.error("Error retrying session check:",s),void x("Failed to verify authentication. Please log in again.");const r=null==(e=null==t?void 0:t.session)?void 0:e.user;r?(console.log("Found authenticated user in session:",r.id),o(r),n({type:"SET_USER",payload:r}),G()):x("No active session found. Please log in.")}catch(t){console.error("Error in retry session:",t),x("An unexpected error occurred. Please try again.")}finally{g(!1)}},J=a||r.user;on(r.subscription);if(p)return j.jsxs("div",{className:"space-y-6",children:[j.jsxs("h1",{className:"text-2xl font-bold text-[#586D78] flex items-center",children:[j.jsx(B,{className:"mr-2"}),"Account"]}),j.jsx(Wn,{children:j.jsxs("div",{className:"text-center py-8",children:[j.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-[#586D78] mx-auto mb-4"}),j.jsx("p",{className:"text-gray-600",children:"Verifying your account..."})]})})]});if(!J)return j.jsxs("div",{className:"space-y-6",children:[j.jsxs("h1",{className:"text-2xl font-bold text-[#586D78] flex items-center",children:[j.jsx(B,{className:"mr-2"}),"Account"]}),j.jsx(Wn,{children:j.jsxs("div",{className:"text-center py-8",children:[f&&j.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-md p-3 mb-4 text-red-700",children:[j.jsx("p",{children:f}),j.jsx(Nn,{onClick:W,className:"mt-2",disabled:p,size:"sm",icon:p?j.jsx(ie,{className:"w-4 h-4 animate-spin"}):j.jsx(ie,{className:"w-4 h-4"}),children:p?"Checking...":"Try Again"})]}),j.jsx("p",{className:"text-gray-600 text-lg",children:"Please log in to view your account details."})]})})]});return j.jsxs("div",{className:"space-y-6",children:[j.jsxs("h1",{className:"text-2xl font-bold text-[#586D78] flex items-center",children:[j.jsx(B,{className:"mr-2"}),"Account"]}),j.jsxs("div",{children:[j.jsxs("div",{className:"flex justify-between items-center p-3 rounded-md bg-[#D7E5E5] cursor-pointer",onClick:()=>{b(!y)},children:[j.jsxs("h2",{className:"text-lg font-semibold text-[#586D78] flex items-center",children:[j.jsx(B,{className:"mr-2 h-5 w-5"}),"Account Info"]}),y?j.jsx(F,{className:"h-5 w-5 text-[#586D78]"}):j.jsx(U,{className:"h-5 w-5 text-[#586D78]"})]}),y&&j.jsxs("div",{className:"mt-4 space-y-6",children:[j.jsx(Wn,{children:j.jsxs("div",{className:"space-y-4",children:[j.jsxs("div",{children:[j.jsx("h2",{className:"text-lg font-semibold text-[#586D78]",children:"Account Details"}),j.jsx("p",{className:"text-gray-600 text-lg",children:J.email})]}),j.jsxs("div",{className:"border-t pt-4",children:[j.jsx("h3",{className:"font-medium text-[#586D78] mb-2",children:"Account Type"}),j.jsx("p",{className:"text-gray-600 text-lg",children:"active"===(null==(e=r.subscription)?void 0:e.status)?r.subscription.id.toString().startsWith("trial-")?"Beta Tester (Premium Trial)":"Premium Member":"Free Member"})]})]})}),j.jsx(Wn,{title:"Change Password",id:"password-change-section",children:j.jsx("div",{className:"space-y-4 "+(L?"password-reset-highlight":""),style:L?{animation:"highlight-password-section 5s ease-in-out 2",padding:"1rem",borderRadius:"0.5rem"}:{},children:j.jsxs("form",{onSubmit:async e=>{e.preventDefault(),k(null),C(null),A(!0);try{if(v.length<6)return void k("Password must be at least 6 characters long");if(v!==_)return void k("Passwords do not match");const e=/[a-zA-Z]/.test(v),t=/[0-9]/.test(v);if(!e||!t)return void k("Password must contain at least one letter and one number");const{error:s}=await sn.auth.updateUser({password:v});if(s)throw s;C("Password successfully changed"),w(""),N("")}catch(t){console.error("Error changing password:",t),k(t.message||"Failed to change password. Please try again.")}finally{A(!1)}},className:"space-y-4",children:[j.jsxs("div",{children:[j.jsx("label",{htmlFor:"newPassword",className:"block text-sm font-medium text-gray-700 mb-1",children:"New Password"}),j.jsxs("div",{className:"relative",children:[j.jsx("input",{id:"newPassword",type:I?"text":"password",value:v,onChange:e=>w(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#586D78]",placeholder:"Enter new password",required:!0}),j.jsx("button",{type:"button",onClick:()=>D(!I),className:"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600",children:I?j.jsx(H,{size:18}):j.jsx(Y,{size:18})})]})]}),j.jsxs("div",{children:[j.jsx("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-gray-700 mb-1",children:"Confirm New Password"}),j.jsxs("div",{className:"relative",children:[j.jsx("input",{id:"confirmPassword",type:O?"text":"password",value:_,onChange:e=>N(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#586D78]",placeholder:"Confirm new password",required:!0}),j.jsx("button",{type:"button",onClick:()=>$(!O),className:"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600",children:O?j.jsx(H,{size:18}):j.jsx(Y,{size:18})})]})]}),j.jsxs("div",{className:"bg-blue-50 p-3 rounded-md",children:[j.jsx("p",{className:"text-sm text-blue-700",children:"Password requirements:"}),j.jsxs("ul",{className:"text-xs text-blue-700 list-disc list-inside mt-1",children:[j.jsx("li",{children:"At least 6 characters long"}),j.jsx("li",{children:"Contains at least one letter"}),j.jsx("li",{children:"Contains at least one number"})]})]}),S&&j.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-md p-3 flex items-start",children:[j.jsx(E,{className:"w-4 h-4 text-red-500 mr-2 flex-shrink-0 mt-0.5"}),j.jsx("p",{className:"text-red-700 text-sm",children:S})]}),T&&j.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-md p-3 flex items-start",children:[j.jsx(R,{className:"w-4 h-4 text-green-500 mr-2 flex-shrink-0 mt-0.5"}),j.jsx("p",{className:"text-green-700 text-sm",children:T})]}),j.jsx("div",{children:j.jsx(Nn,{type:"submit",disabled:P||!v&&!_,icon:P?j.jsx(ie,{className:"w-4 h-4 animate-spin"}):j.jsx(Q,{className:"w-4 h-4"}),children:P?"Changing Password...":"Change Password"})})]})})}),j.jsx(Wn,{children:j.jsxs("div",{className:"space-y-4",children:[j.jsxs("h2",{className:"text-lg font-semibold text-[#586D78] flex items-center",children:[j.jsx(V,{className:"mr-2 text-yellow-500"}),"Subscription Status",d&&j.jsx(ie,{className:"w-4 h-4 ml-2 animate-spin text-[#586D78]"})]}),j.jsx(Aa,{onSuccess:G})]})}),j.jsx(Wn,{title:"Payment & Billing",actions:j.jsx(Nn,{variant:"secondary",size:"sm",icon:l?void 0:j.jsx(ae,{className:"w-4 h-4"}),onClick:()=>c(!l),children:l?"Hide History":"View Payment History"}),children:j.jsxs("div",{className:"space-y-4",children:[j.jsx("p",{className:"text-gray-700",children:"Manage your payment methods and view your billing history."}),"active"===(null==(t=r.subscription)?void 0:t.status)&&!r.subscription.id.toString().startsWith("trial-")&&j.jsx(Nn,{variant:"secondary",onClick:()=>Mn(J.id),icon:j.jsx(K,{className:"w-4 h-4"}),disabled:d,children:d?"Processing...":"Manage Payment Methods"}),l&&j.jsxs("div",{className:"mt-6",children:[j.jsx("h3",{className:"text-lg font-medium text-[#586D78] mb-4",children:"Payment History"}),j.jsx(Ia,{userId:J.id})]})]})})]})]}),j.jsx(fa,{isDefaultOpen:!1})]})},Oa=()=>{const{state:e}=jn(),{user:t}=e,[r,n]=s.useState([]),[a,i]=s.useState(!0),[o,l]=s.useState(null),[c,d]=s.useState(!1),[u,h]=s.useState(null),[m,p]=s.useState({code:"",maxUses:"10",expirationDays:"30"});s.useEffect(()=>{g()},[]);const g=async()=>{try{i(!0),l(null);const{data:e,error:t}=await sn.from("beta_codes").select("*").order("code");if(t)throw t;n(e||[])}catch(e){console.error("Error fetching beta codes:",e),l("Failed to load beta codes")}finally{i(!1)}};return(null==t?void 0:t.email)&&["your-admin-email@example.com","danabrams999@yahoo.com","dan@corpania.com"].includes(t.email.toLowerCase())?j.jsxs("div",{className:"space-y-6",children:[j.jsxs("h1",{className:"text-2xl font-bold text-[#586D78] flex items-center",children:[j.jsx(Q,{className:"mr-2"}),"Beta Code Management"]}),j.jsxs(Wn,{children:[j.jsxs("div",{className:"flex justify-between items-center mb-4",children:[j.jsx("p",{className:"text-gray-700",children:"Create and manage beta codes for premium trial access."}),j.jsx(Nn,{onClick:()=>d(!0),icon:j.jsx(re,{className:"w-4 h-4"}),children:"Create New Code"})]}),o&&j.jsx("div",{className:"bg-red-50 border border-red-200 rounded p-3 mb-4 text-red-600",children:o})]}),j.jsx(Wn,{title:"Beta Codes",children:a?j.jsxs("div",{className:"text-center py-4",children:[j.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-500 mx-auto"}),j.jsx("p",{className:"mt-2 text-gray-600",children:"Loading codes..."})]}):0===r.length?j.jsx("div",{className:"text-center py-4",children:j.jsx("p",{className:"text-gray-500",children:"No beta codes found. Create one to get started."})}):j.jsx("div",{className:"overflow-x-auto",children:j.jsxs("table",{className:"min-w-full border-collapse",children:[j.jsx("thead",{children:j.jsxs("tr",{className:"bg-indigo-50",children:[j.jsx("th",{className:"px-4 py-2 text-left text-[#586D78] font-medium",children:"Code"}),j.jsx("th",{className:"px-4 py-2 text-left text-[#586D78] font-medium",children:"Usage"}),j.jsx("th",{className:"px-4 py-2 text-left text-[#586D78] font-medium",children:"Expires On"}),j.jsx("th",{className:"px-4 py-2 text-left text-[#586D78] font-medium",children:"Status"}),j.jsx("th",{className:"px-4 py-2 text-right text-[#586D78] font-medium",children:"Actions"})]})}),j.jsx("tbody",{children:r.map(e=>{const t=e.expires_on&&new Date(e.expires_on)<new Date,s=e.max_uses&&e.uses>=e.max_uses,r=t?"Expired":s?"Maxed Out":"Active";return j.jsxs("tr",{className:"border-b",children:[j.jsx("td",{className:"px-4 py-3 font-medium",children:j.jsxs("div",{className:"flex items-center",children:[e.code,j.jsxs("button",{onClick:()=>(async e=>{try{await navigator.clipboard.writeText(e),h(e),setTimeout(()=>h(null),2e3)}catch(t){console.error("Could not copy text: ",t)}})(e.code),className:"ml-2 text-gray-500 hover:text-[#586D78]",title:"Copy code",children:[j.jsx(q,{size:16}),u===e.code&&j.jsx("span",{className:"ml-1 text-xs text-green-600",children:"Copied!"})]})]})}),j.jsxs("td",{className:"px-4 py-3",children:[e.uses,e.max_uses?`/${e.max_uses}`:""]}),j.jsx("td",{className:"px-4 py-3",children:e.expires_on?new Date(e.expires_on).toLocaleDateString():"Never"}),j.jsx("td",{className:"px-4 py-3",children:j.jsx("span",{className:"inline-block px-2 py-1 rounded-full text-xs font-medium "+("Active"===r?"bg-green-100 text-green-700":"bg-red-100 text-red-700"),children:r})}),j.jsx("td",{className:"px-4 py-3 text-right",children:j.jsx(Nn,{variant:"danger",size:"sm",onClick:()=>(async e=>{try{if(!confirm("Are you sure you want to delete this beta code?"))return;const{error:t}=await sn.from("beta_codes").delete().eq("code",e);if(t)throw t;g()}catch(t){console.error("Error deleting beta code:",t),l("Failed to delete beta code")}})(e.code),icon:j.jsx(ue,{className:"w-4 h-4"}),children:"Delete"})})]},e.code)})})]})})}),c&&j.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:j.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full shadow-2xl",children:[j.jsx("h3",{className:"text-xl font-bold mb-4",children:"Create New Beta Code"}),j.jsxs("div",{className:"space-y-4",children:[j.jsxs("div",{children:[j.jsx("label",{htmlFor:"code",className:"block text-sm font-medium text-gray-700 mb-1",children:"Code"}),j.jsx("input",{id:"code",type:"text",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#586D78]",placeholder:"e.g., BETA2025",value:m.code,onChange:e=>p(t=>({...t,code:e.target.value}))})]}),j.jsxs("div",{children:[j.jsx("label",{htmlFor:"maxUses",className:"block text-sm font-medium text-gray-700 mb-1",children:"Maximum Uses (leave empty for unlimited)"}),j.jsx("input",{id:"maxUses",type:"number",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#586D78]",placeholder:"e.g., 10",value:m.maxUses,onChange:e=>p(t=>({...t,maxUses:e.target.value}))})]}),j.jsxs("div",{children:[j.jsx("label",{htmlFor:"expirationDays",className:"block text-sm font-medium text-gray-700 mb-1",children:"Expires After Days (leave empty for no expiration)"}),j.jsx("input",{id:"expirationDays",type:"number",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#586D78]",placeholder:"e.g., 30",value:m.expirationDays,onChange:e=>p(t=>({...t,expirationDays:e.target.value}))})]}),j.jsxs("div",{className:"flex justify-end space-x-2 pt-2",children:[j.jsx(Nn,{variant:"secondary",onClick:()=>d(!1),children:"Cancel"}),j.jsx(Nn,{onClick:async()=>{try{if(!m.code.trim())return void l("Please enter a code");const e=parseInt(m.maxUses),t=parseInt(m.expirationDays),s=new Date;s.setDate(s.getDate()+t),await(async(e,t,s)=>{try{const{data:{user:r}}=await sn.auth.getUser();if(!r)throw new Error("You must be logged in to create beta codes");const{data:n,error:a}=await sn.from("beta_codes").insert({code:e,max_uses:t,expires_on:null==s?void 0:s.toISOString(),uses:0}).select().single();if(a)throw a;return await sn.from("valid_beta_codes_ui").insert({code:e}).select(),n}catch(o){throw console.error("Error creating beta code:",o),o}})(m.code.trim(),isNaN(e)?void 0:e,isNaN(t)?void 0:s),g(),d(!1),p({code:"",maxUses:"10",expirationDays:"30"})}catch(e){console.error("Error creating beta code:",e),l("Failed to create beta code")}},children:"Create Code"})]})]})]})})]}):j.jsxs("div",{className:"space-y-6",children:[j.jsxs("h1",{className:"text-2xl font-bold text-[#586D78] flex items-center",children:[j.jsx(Q,{className:"mr-2"}),"Beta Code Management"]}),j.jsx(Wn,{children:j.jsx("div",{className:"text-center py-8",children:j.jsx("p",{className:"text-red-600 text-lg",children:"Unauthorized access. Admin privileges required."})})})]})},$a=()=>{var e;const t=i(),{state:r}=jn(),[n,a]=s.useState(!0),[o,l]=s.useState(null),[c,d]=s.useState(null),[u,h]=s.useState([]),[m,p]=s.useState([]),[g,f]=s.useState("30days"),x=(null==(e=r.user)?void 0:e.email)&&("danabrams999@yahoo.com"===r.user.email.toLowerCase()||"dan@corpania.com"===r.user.email.toLowerCase()||"immortality.bytes.book@gmail.com"===r.user.email.toLowerCase());s.useEffect(()=>{x?y():t("/")},[x,g]);const y=async()=>{try{a(!0),l(null);const{data:e,error:t}=await sn.from("daily_metrics_summary").select("*").single();if(t)throw console.error("Error fetching metrics summary:",t),new Error("Failed to load dashboard metrics");d(e);const s=b(),{data:r,error:n}=await sn.from("subscription_analytics").select("*").gte("date",s).order("date",{ascending:!1});if(n)throw console.error("Error fetching subscription metrics:",n),new Error("Failed to load subscription metrics");h(r||[]);const{data:i,error:o}=await sn.from("beta_code_performance").select("*").order("uses",{ascending:!1});if(o)throw console.error("Error fetching beta code performance:",o),new Error("Failed to load beta code performance data");p(i||[])}catch(e){console.error("Error fetching dashboard data:",e),l(e.message||"An unexpected error occurred")}finally{a(!1)}},b=()=>{const e=new Date;switch(g){case"7days":e.setDate(e.getDate()-7);break;case"30days":e.setDate(e.getDate()-30);break;case"90days":e.setDate(e.getDate()-90)}return e.toISOString().split("T")[0]},v=e=>null==e?"-":e.toLocaleString(),w=e=>null==e?"-":`${e}%`;return x?n?j.jsxs("div",{className:"space-y-6",children:[j.jsxs("h1",{className:"text-2xl font-bold text-[#586D78] flex items-center",children:[j.jsx(O,{className:"mr-2"}),"Admin Dashboard"]}),j.jsx(Wn,{children:j.jsxs("div",{className:"flex justify-center items-center py-12",children:[j.jsx(ie,{className:"w-8 h-8 animate-spin text-[#586D78]"}),j.jsx("span",{className:"ml-2 text-gray-600",children:"Loading dashboard data..."})]})})]}):o?j.jsxs("div",{className:"space-y-6",children:[j.jsxs("h1",{className:"text-2xl font-bold text-[#586D78] flex items-center",children:[j.jsx(O,{className:"mr-2"}),"Admin Dashboard"]}),j.jsx(Wn,{children:j.jsxs("div",{className:"p-6 text-center",children:[j.jsx("p",{className:"text-red-600 mb-4",children:o}),j.jsx(Nn,{onClick:y,icon:j.jsx(ie,{className:"w-4 h-4"}),children:"Retry"})]})})]}):j.jsxs("div",{className:"space-y-6",children:[j.jsxs("div",{className:"flex justify-between items-center",children:[j.jsxs("h1",{className:"text-2xl font-bold text-[#586D78] flex items-center",children:[j.jsx(O,{className:"mr-2"}),"Admin Dashboard"]}),j.jsxs("div",{className:"flex space-x-2",children:[j.jsx(Nn,{variant:"7days"===g?"primary":"secondary",size:"sm",onClick:()=>f("7days"),children:"7 Days"}),j.jsx(Nn,{variant:"30days"===g?"primary":"secondary",size:"sm",onClick:()=>f("30days"),children:"30 Days"}),j.jsx(Nn,{variant:"90days"===g?"primary":"secondary",size:"sm",onClick:()=>f("90days"),children:"90 Days"}),j.jsx(Nn,{variant:"secondary",size:"sm",onClick:y,icon:j.jsx(ie,{className:"w-4 h-4"}),children:"Refresh"})]})]}),j.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[j.jsx(Wn,{className:"bg-gradient-to-br from-indigo-50 to-blue-50",children:j.jsxs("div",{className:"p-4",children:[j.jsxs("div",{className:"flex justify-between",children:[j.jsx("h3",{className:"text-[#586D78] font-medium",children:"Total Users"}),j.jsx(me,{className:"w-5 h-5 text-[#586D78]"})]}),j.jsx("p",{className:"text-3xl font-bold mt-2",children:v(null==c?void 0:c.total_users)}),j.jsxs("div",{className:"mt-2 text-sm text-green-600 flex items-center",children:[j.jsx(D,{className:"w-4 h-4 mr-1"}),j.jsx("span",{children:"Active Growth"})]})]})}),j.jsx(Wn,{className:"bg-gradient-to-br from-amber-50 to-yellow-50",children:j.jsxs("div",{className:"p-4",children:[j.jsxs("div",{className:"flex justify-between",children:[j.jsx("h3",{className:"text-[#586D78] font-medium",children:"Premium Users"}),j.jsx(V,{className:"w-5 h-5 text-[#586D78]"})]}),j.jsx("p",{className:"text-3xl font-bold mt-2",children:v(null==c?void 0:c.active_subscriptions)}),j.jsx("div",{className:"mt-2 text-sm text-gray-600 flex items-center",children:j.jsxs("span",{children:["+",(null==c?void 0:c.active_trials)||0," active trials"]})})]})}),j.jsx(Wn,{className:"bg-gradient-to-br from-green-50 to-emerald-50",children:j.jsxs("div",{className:"p-4",children:[j.jsxs("div",{className:"flex justify-between",children:[j.jsx("h3",{className:"text-[#586D78] font-medium",children:"Saved Settings"}),j.jsx($,{className:"w-5 h-5 text-[#586D78]"})]}),j.jsx("p",{className:"text-3xl font-bold mt-2",children:v(null==c?void 0:c.total_saved_settings)}),j.jsx("div",{className:"mt-2 text-sm text-green-600 flex items-center",children:j.jsxs("span",{children:["Average ",Math.round(((null==c?void 0:c.total_saved_settings)||0)/((null==c?void 0:c.total_users)||1))," per user"]})})]})})]}),j.jsx(Wn,{title:"Subscription Metrics",children:j.jsx("div",{className:"overflow-x-auto",children:j.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[j.jsx("thead",{children:j.jsxs("tr",{children:[j.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"}),j.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"New Subs"}),j.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Active"}),j.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Cancellations"}),j.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Past Due"}),j.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Non-Renewing"}),j.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Retention"})]})}),j.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:u.length>0?u.map(e=>j.jsxs("tr",{className:"hover:bg-gray-50",children:[j.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:new Date(e.date).toLocaleDateString()}),j.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 font-medium",children:v(e.new_subscriptions)}),j.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-green-600 font-medium",children:v(e.active_subscriptions)}),j.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-red-600 font-medium",children:v(e.cancellations)}),j.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-amber-600 font-medium",children:v(e.past_due_subscriptions)}),j.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-600 font-medium",children:v(e.non_renewing_subscriptions)}),j.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-[#586D78] font-medium",children:w(e.retention_rate)})]},e.date)):j.jsx("tr",{children:j.jsx("td",{colSpan:7,className:"px-6 py-4 text-center text-sm text-gray-500",children:"No subscription data available for the selected time period"})})})]})})}),j.jsx(Wn,{title:"Beta Code Performance",children:j.jsx("div",{className:"overflow-x-auto",children:j.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[j.jsx("thead",{children:j.jsxs("tr",{children:[j.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Code"}),j.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Uses"}),j.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Max Uses"}),j.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total Trials"}),j.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Converted"}),j.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Conversion Rate"}),j.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Expires"}),j.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"})]})}),j.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:m.length>0?m.map(e=>j.jsxs("tr",{className:"hover:bg-gray-50",children:[j.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-[#586D78]",children:e.code}),j.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.uses}),j.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.max_uses||"Unlimited"}),j.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.total_trials}),j.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-green-600",children:e.converted_to_paid}),j.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:w(e.conversion_rate)}),j.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.expires_on?new Date(e.expires_on).toLocaleDateString():"Never"}),j.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:j.jsx("span",{className:"px-2 py-1 text-xs font-medium rounded-full "+(e.is_expired?"bg-red-100 text-red-800":"bg-green-100 text-green-800"),children:e.is_expired?"Expired":"Active"})})]},e.code)):j.jsx("tr",{children:j.jsx("td",{colSpan:8,className:"px-6 py-4 text-center text-sm text-gray-500",children:"No beta code data available"})})})]})})}),j.jsx(Wn,{title:"Recent User Activity",children:j.jsx("div",{className:"flex items-center justify-center py-8",children:j.jsxs("div",{className:"flex flex-col items-center",children:[j.jsx("p",{className:"text-2xl font-bold text-[#586D78]",children:(null==c?void 0:c.active_users_last_7_days)||0}),j.jsx("p",{className:"text-sm text-gray-600",children:"Active Users (Last 7 Days)"})]})})}),j.jsx("div",{className:"flex justify-end",children:j.jsx(Nn,{onClick:()=>t("/admin/beta-codes"),variant:"secondary",children:"Manage Beta Codes"})})]}):null},Ra=()=>j.jsx("footer",{className:"bg-[#586D78] text-white py-4 mt-auto",children:j.jsx("div",{className:"container mx-auto px-4",children:j.jsxs("div",{className:"flex flex-col md:flex-row items-center justify-between",children:[j.jsxs("div",{className:"text-sm mb-2 md:mb-0 flex items-center",children:["© 2025",j.jsx("img",{src:"https://i.imgur.com/5AikU0W.png",alt:"Seatyr Icon",className:"w-4 h-4 mx-2"}),"Seatyr — Efficient Seating for Slightly Fewer Headaches"]}),j.jsxs("div",{className:"flex items-center space-x-4",children:[j.jsx("a",{href:"https://github.com",target:"_blank",rel:"noopener noreferrer",className:"text-white hover:text-white/80 transition-colors","aria-label":"GitHub",children:j.jsx(X,{className:"w-5 h-5"})}),j.jsx("a",{href:"/privacy",className:"text-white hover:text-white/80 transition-colors text-sm",children:"Privacy Policy"}),j.jsx("a",{href:"/terms",className:"text-white hover:text-white/80 transition-colors text-sm",children:"Terms of Service"}),j.jsx("a",{href:"https://www.corpania.com",target:"_blank",rel:"noopener noreferrer",className:"ml-2",children:j.jsx("img",{src:"https://i.imgur.com/2xCPeEE.png",alt:"Corpania Logo",className:"w-6 h-6 hover:opacity-80 transition-opacity"})})]})]})})}),Ua=()=>{const{state:e,dispatch:t}=jn(),[r,n]=s.useState(!0),[a,i]=s.useState("checking"),[o,l]=s.useState("checking");return s.useEffect(()=>{(async()=>{n(!0),l("error");try{const e=await(async()=>!1)();i(e?"success":"error"),t({type:"SET_SUPABASE_CONNECTED",payload:e})}catch(e){console.error("Error checking Supabase connection:",e),i("error"),t({type:"SET_SUPABASE_CONNECTED",payload:!1})}n(!1)})()},[t]),r||"success"!==o||"success"!==a?j.jsxs("div",{className:"fixed bottom-4 right-4 bg-white rounded-lg shadow-md p-4 max-w-md z-50",children:[j.jsx("h3",{className:"font-bold text-lg mb-2",children:"Supabase Connection Status"}),j.jsxs("div",{className:"space-y-2",children:[j.jsxs("div",{className:"flex items-center",children:[j.jsx("span",{className:"mr-2",children:"Configuration:"}),"checking"===o&&j.jsx("span",{className:"text-blue-500",children:"Checking..."}),"success"===o&&j.jsx("span",{className:"text-green-600",children:"✓ Valid"}),"error"===o&&j.jsx("span",{className:"text-red-600",children:"✗ Missing or invalid"})]}),j.jsxs("div",{className:"flex items-center",children:[j.jsx("span",{className:"mr-2",children:"Connection:"}),"checking"===a&&j.jsx("span",{className:"text-blue-500",children:"Checking..."}),"success"===a&&j.jsx("span",{className:"text-green-600",children:"✓ Connected"}),"error"===a&&j.jsx("span",{className:"text-red-600",children:"✗ Failed"})]})]}),("error"===o||"error"===a)&&j.jsxs("div",{className:"mt-3 bg-red-50 p-3 rounded-md text-sm",children:[j.jsx("p",{className:"font-semibold text-red-700 mb-1",children:"Troubleshooting:"}),j.jsxs("ul",{className:"list-disc pl-5 text-red-700",children:["error"===o&&j.jsx("li",{children:"Check your .env file has valid VITE_SUPABASE_URL and VITE_SUPABASE_ANON_KEY values"}),"error"===a&&j.jsxs(j.Fragment,{children:[j.jsx("li",{children:"Verify your Supabase project is online"}),j.jsx("li",{children:"Check your network connection"}),j.jsx("li",{children:"Verify the anon key has necessary permissions"})]})]}),j.jsxs("pre",{className:"bg-red-100 p-2 mt-2 rounded overflow-auto text-xs",children:["VITE_SUPABASE_URL=https://your-project-id.supabase.co",j.jsx("br",{}),"VITE_SUPABASE_ANON_KEY=your-supabase-anon-key"]})]})]}):null};class La extends s.Component{constructor(e){super(e),this.state={hasError:!1,error:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){console.error("Error caught by ErrorBoundary:",e,t)}render(){return this.state.hasError?this.props.fallback?this.props.fallback:j.jsx("div",{className:"min-h-screen bg-[#dde1e3] flex items-center justify-center p-4",children:j.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 max-w-lg w-full",children:[j.jsx("h2",{className:"text-xl font-bold text-red-600 mb-4",children:"Something went wrong"}),j.jsx("p",{className:"text-gray-700 mb-4",children:"There was an error loading the application. Please try refreshing the page."}),this.state.error&&j.jsx("div",{className:"bg-red-50 p-4 rounded-md mb-4 overflow-auto",children:j.jsx("p",{className:"text-red-700 font-mono text-sm whitespace-pre-wrap",children:this.state.error.toString()})}),j.jsx("button",{onClick:()=>window.location.reload(),className:"w-28 h-12 text-white font-semibold bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500 rounded-lg shadow-lg hover:scale-105 duration-200 hover:drop-shadow-2xl hover:shadow-[#7dd3fc] hover:cursor-pointer",children:"Refresh Page"})]})}):this.props.children}}const Ma=()=>j.jsx("div",{className:"min-h-screen bg-[#dde1e3] flex items-center justify-center p-4",children:j.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 max-w-lg w-full",children:[j.jsx("h1",{className:"text-2xl font-bold text-[#7973BB] mb-4",children:"Seatyr - Configuration Needed"}),j.jsxs("div",{className:"bg-[#88abc6] border border-[#88abc6] rounded-md p-4 mb-6",children:[j.jsx("h2",{className:"text-lg font-semibold text-white mb-2",children:"Missing Environment Configuration"}),j.jsx("p",{className:"text-white",children:"The application is missing required environment variables. This is typically needed for the first setup."})]}),j.jsxs("div",{className:"bg-gray-50 p-4 rounded-md border border-gray-200",children:[j.jsx("h3",{className:"font-medium mb-2",children:"Required Environment Variables:"}),j.jsx("pre",{className:"bg-gray-100 p-3 rounded text-sm overflow-auto",children:"VITE_SUPABASE_URL=https://your-project-id.supabase.co VITE_SUPABASE_ANON_KEY=your-anon-key-here"})]}),j.jsxs("div",{className:"mt-6 space-y-4",children:[j.jsx("p",{className:"text-gray-600",children:"These variables need to be configured in your Netlify Environment Variables settings or in your local .env file for local development."}),j.jsx("div",{className:"flex justify-center",children:j.jsx("button",{onClick:()=>window.location.reload(),className:"w-28 h-12 text-white font-semibold bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500 rounded-lg shadow-lg hover:scale-105 duration-200 hover:drop-shadow-2xl hover:shadow-[#7dd3fc] hover:cursor-pointer",children:"Refresh Page"})})]})]})});function Fa(){const[e,t]=s.useState(!1);return s.useEffect(()=>{t(!1)},[]),e?j.jsx(La,{children:j.jsx(d,{children:j.jsx(wn,{children:j.jsxs("div",{className:"min-h-screen bg-[#dde1e3] flex flex-col",children:[j.jsx(zn,{}),j.jsx("main",{className:"flex-grow container mx-auto px-4 py-6",children:j.jsxs(u,{children:[j.jsx(h,{path:"/",element:j.jsx(Hn,{})}),j.jsx(h,{path:"/constraints",element:j.jsx(ba,{})}),j.jsx(h,{path:"/tables",element:j.jsx(wa,{})}),j.jsx(h,{path:"/seating",element:j.jsx(Na,{})}),j.jsx(h,{path:"/saved-settings",element:j.jsx(Sa,{})}),j.jsx(h,{path:"/privacy",element:j.jsx(ka,{})}),j.jsx(h,{path:"/terms",element:j.jsx(Ea,{})}),j.jsx(h,{path:"/auth/callback",element:j.jsx(Ta,{})}),j.jsx(h,{path:"/premium/success",element:j.jsx(Ca,{})}),j.jsx(h,{path:"/premium/cancel",element:j.jsx(Pa,{})}),j.jsx(h,{path:"/account",element:j.jsx(Da,{})}),j.jsx(h,{path:"/admin/beta-codes",element:j.jsx(Oa,{})}),j.jsx(h,{path:"/admin/dashboard",element:j.jsx($a,{})})]})}),j.jsx(Ra,{}),j.jsx(Ua,{})]})})})}):j.jsx(Ma,{})}const Ba=()=>{try{const e=document.getElementById("root");if(!e)return void console.error("Root element not found");_.createRoot(e).render(j.jsx(l.StrictMode,{children:j.jsx(Fa,{})}))}catch(e){console.error("Error rendering app:",e),document.body.innerHTML=`\n      <div style="display: flex; justify-content: center; align-items: center; height: 100vh; background: #f0f4ff; padding: 20px;">\n        <div style="background: white; border-radius: 8px; padding: 20px; max-width: 500px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">\n          <h2 style="color: #ff4040; margin-top: 0;">Application Error</h2>\n          <p>There was an error loading the application. This may be due to a configuration issue.</p>\n          <div style="background: #fff8f8; padding: 10px; border-radius: 4px; margin: 10px 0; overflow: auto;">\n            <pre style="margin: 0; color: #d00; font-size: 12px;">${e.toString()}</pre>\n          </div>\n          <button \n            onclick="window.location.reload()" \n            style="background: #7973BB; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer;"\n          >\n            Refresh Page\n          </button>\n        </div>\n      </div>\n    `}};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",Ba):Ba();
//# sourceMappingURL=index-7_EUSZjo.js.map
